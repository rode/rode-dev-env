var Fs=Object.defineProperty,Ms=Object.defineProperties;var $s=Object.getOwnPropertyDescriptors;var Hr=Object.getOwnPropertySymbols;var Us=Object.prototype.hasOwnProperty,js=Object.prototype.propertyIsEnumerable;var zr=(e,t,r)=>t in e?Fs(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ee=(e,t)=>{for(var r in t||(t={}))Us.call(t,r)&&zr(e,r,t[r]);if(Hr)for(var r of Hr(t))js.call(t,r)&&zr(e,r,t[r]);return e},nt=(e,t)=>Ms(e,$s(t));var zu=typeof require!="undefined"?require:e=>{throw new Error('Dynamic require of "'+e+'" is not supported')};var y=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var it=y(Ae=>{"use strict";Object.defineProperty(Ae,"__esModule",{value:!0});Ae.toCommandProperties=Ae.toCommandValue=void 0;function Ls(e){return e==null?"":typeof e=="string"||e instanceof String?e:JSON.stringify(e)}Ae.toCommandValue=Ls;function xs(e){return Object.keys(e).length?{title:e.title,line:e.startLine,endLine:e.endLine,col:e.startColumn,endColumn:e.endColumn}:{}}Ae.toCommandProperties=xs});var Xr=y(j=>{"use strict";var Gs=j&&j.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),Bs=j&&j.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Hs=j&&j.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.hasOwnProperty.call(e,r)&&Gs(t,e,r);return Bs(t,e),t};Object.defineProperty(j,"__esModule",{value:!0});j.issue=j.issueCommand=void 0;var zs=Hs(require("os")),Wr=it();function Vr(e,t,r){let n=new Kr(e,t,r);process.stdout.write(n.toString()+zs.EOL)}j.issueCommand=Vr;function Ws(e,t=""){Vr(e,{},t)}j.issue=Ws;var Jr="::",Kr=class{constructor(t,r,n){t||(t="missing.command"),this.command=t,this.properties=r,this.message=n}toString(){let t=Jr+this.command;if(this.properties&&Object.keys(this.properties).length>0){t+=" ";let r=!0;for(let n in this.properties)if(this.properties.hasOwnProperty(n)){let i=this.properties[n];i&&(r?r=!1:t+=",",t+=`${n}=${Js(i)}`)}}return t+=`${Jr}${Vs(this.message)}`,t}};function Vs(e){return Wr.toCommandValue(e).replace(/%/g,"%25").replace(/\r/g,"%0D").replace(/\n/g,"%0A")}function Js(e){return Wr.toCommandValue(e).replace(/%/g,"%25").replace(/\r/g,"%0D").replace(/\n/g,"%0A").replace(/:/g,"%3A").replace(/,/g,"%2C")}});var Zr=y(W=>{"use strict";var Ks=W&&W.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),Xs=W&&W.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Yr=W&&W.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.hasOwnProperty.call(e,r)&&Ks(t,e,r);return Xs(t,e),t};Object.defineProperty(W,"__esModule",{value:!0});W.issueCommand=void 0;var Qr=Yr(require("fs")),Ys=Yr(require("os")),Qs=it();function Zs(e,t){let r=process.env[`GITHUB_${e}`];if(!r)throw new Error(`Unable to find environment variable for file command ${e}`);if(!Qr.existsSync(r))throw new Error(`Missing file at path: ${r}`);Qr.appendFileSync(r,`${Qs.toCommandValue(t)}${Ys.EOL}`,{encoding:"utf8"})}W.issueCommand=Zs});var F=y(v=>{"use strict";var eo=v&&v.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),to=v&&v.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),en=v&&v.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.hasOwnProperty.call(e,r)&&eo(t,e,r);return to(t,e),t},ro=v&&v.__awaiter||function(e,t,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(l){try{u(n.next(l))}catch(h){o(h)}}function c(l){try{u(n.throw(l))}catch(h){o(h)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((n=n.apply(e,t||[])).next())})};Object.defineProperty(v,"__esModule",{value:!0});v.getState=v.saveState=v.group=v.endGroup=v.startGroup=v.info=v.notice=v.warning=v.error=v.debug=v.isDebug=v.setFailed=v.setCommandEcho=v.setOutput=v.getBooleanInput=v.getMultilineInput=v.getInput=v.addPath=v.setSecret=v.exportVariable=v.ExitCode=void 0;var L=Xr(),tn=Zr(),st=it(),ot=en(require("os")),no=en(require("path")),rn;(function(e){e[e.Success=0]="Success",e[e.Failure=1]="Failure"})(rn=v.ExitCode||(v.ExitCode={}));function io(e,t){let r=st.toCommandValue(t);if(process.env[e]=r,process.env.GITHUB_ENV||""){let i="_GitHubActionsFileCommandDelimeter_",s=`${e}<<${i}${ot.EOL}${r}${ot.EOL}${i}`;tn.issueCommand("ENV",s)}else L.issueCommand("set-env",{name:e},r)}v.exportVariable=io;function so(e){L.issueCommand("add-mask",{},e)}v.setSecret=so;function oo(e){process.env.GITHUB_PATH||""?tn.issueCommand("PATH",e):L.issueCommand("add-path",{},e),process.env.PATH=`${e}${no.delimiter}${process.env.PATH}`}v.addPath=oo;function Ut(e,t){let r=process.env[`INPUT_${e.replace(/ /g,"_").toUpperCase()}`]||"";if(t&&t.required&&!r)throw new Error(`Input required and not supplied: ${e}`);return t&&t.trimWhitespace===!1?r:r.trim()}v.getInput=Ut;function ao(e,t){return Ut(e,t).split(`
`).filter(n=>n!=="")}v.getMultilineInput=ao;function co(e,t){let r=["true","True","TRUE"],n=["false","False","FALSE"],i=Ut(e,t);if(r.includes(i))return!0;if(n.includes(i))return!1;throw new TypeError(`Input does not meet YAML 1.2 "Core Schema" specification: ${e}
Support boolean input list: \`true | True | TRUE | false | False | FALSE\``)}v.getBooleanInput=co;function uo(e,t){process.stdout.write(ot.EOL),L.issueCommand("set-output",{name:e},t)}v.setOutput=uo;function lo(e){L.issue("echo",e?"on":"off")}v.setCommandEcho=lo;function fo(e){process.exitCode=rn.Failure,nn(e)}v.setFailed=fo;function ho(){return process.env.RUNNER_DEBUG==="1"}v.isDebug=ho;function po(e){L.issueCommand("debug",{},e)}v.debug=po;function nn(e,t={}){L.issueCommand("error",st.toCommandProperties(t),e instanceof Error?e.toString():e)}v.error=nn;function go(e,t={}){L.issueCommand("warning",st.toCommandProperties(t),e instanceof Error?e.toString():e)}v.warning=go;function vo(e,t={}){L.issueCommand("notice",st.toCommandProperties(t),e instanceof Error?e.toString():e)}v.notice=vo;function mo(e){process.stdout.write(e+ot.EOL)}v.info=mo;function sn(e){L.issue("group",e)}v.startGroup=sn;function on(){L.issue("endgroup")}v.endGroup=on;function yo(e,t){return ro(this,void 0,void 0,function*(){sn(e);let r;try{r=yield t()}finally{on()}return r})}v.group=yo;function wo(e,t){L.issueCommand("save-state",{name:e},t)}v.saveState=wo;function _o(e){return process.env[`STATE_${e}`]||""}v.getState=_o});var at=y((Yu,un)=>{var an=F(),So=["grafeas","elasticsearch","opa"],bo=()=>{let e=[...So];return jt()&&e.push("oidc-provider"),cn()||e.push(jt()?"rode-with-auth":"rode"),e},cn=()=>an.getInput("rodeVersion")==="local",jt=()=>an.getInput("authEnabled")==="true";un.exports={getServices:bo,isLocalRode:cn,isAuthEnabled:jt}});var ut=y((Qu,fn)=>{var de=F(),{execFileSync:Eo}=require("child_process"),{isLocalRode:Ro,isAuthEnabled:Ao}=at(),Lt,Oo=e=>{Lt=e},Co=e=>ct({cmd:"up",args:["--detach",...e],extraEnv:ln()}),To=()=>ct({cmd:"down",extraEnv:ln()}),ko=()=>ct({cmd:"ps"}),qo=e=>ct({cmd:"logs",log:!1,args:["--no-color","--no-log-prefix",e]}),ln=()=>({ISSUER_URL:Ro()&&Ao()?"http://localhost:3000":"",RODE_VERSION:`v${de.getInput("rodeVersion")}`,ELASTICSEARCH_VERSION:de.getInput("elasticsearchVersion"),GRAFEAS_VERSION:`v${de.getInput("grafeasVersion")}`,OPA_VERSION:de.getInput("opaVersion")}),ct=({cmd:e,args:t=[],extraEnv:r,log:n=!0})=>{let i={shell:!1},s=[];Lt&&s.push("-f",Lt),s.push(e,...t),r&&(i.env=ee(ee({},process.env),r));try{let o=Eo("docker-compose",s,i);return n&&(de.startGroup(`docker-compose ${e}`),de.info(o)),o}finally{n&&de.endGroup()}};fn.exports={configure:Oo,up:Co,down:To,ps:ko,logs:qo}});var dn=y(lt=>{"use strict";Object.defineProperty(lt,"__esModule",{value:!0});function Io(e){let t=e.protocol==="https:",r;if(hn(e))return r;let n;return t?n=process.env.https_proxy||process.env.HTTPS_PROXY:n=process.env.http_proxy||process.env.HTTP_PROXY,n&&(r=new URL(n)),r}lt.getProxyUrl=Io;function hn(e){if(!e.hostname)return!1;let t=process.env.no_proxy||process.env.NO_PROXY||"";if(!t)return!1;let r;e.port?r=Number(e.port):e.protocol==="http:"?r=80:e.protocol==="https:"&&(r=443);let n=[e.hostname.toUpperCase()];typeof r=="number"&&n.push(`${n[0]}:${r}`);for(let i of t.split(",").map(s=>s.trim().toUpperCase()).filter(s=>s))if(n.some(s=>s===i))return!0;return!1}lt.checkBypass=hn});var mn=y(Oe=>{"use strict";var el=require("net"),No=require("tls"),xt=require("http"),pn=require("https"),Do=require("events"),tl=require("assert"),Po=require("util");Oe.httpOverHttp=Fo;Oe.httpsOverHttp=Mo;Oe.httpOverHttps=$o;Oe.httpsOverHttps=Uo;function Fo(e){var t=new Y(e);return t.request=xt.request,t}function Mo(e){var t=new Y(e);return t.request=xt.request,t.createSocket=gn,t.defaultPort=443,t}function $o(e){var t=new Y(e);return t.request=pn.request,t}function Uo(e){var t=new Y(e);return t.request=pn.request,t.createSocket=gn,t.defaultPort=443,t}function Y(e){var t=this;t.options=e||{},t.proxyOptions=t.options.proxy||{},t.maxSockets=t.options.maxSockets||xt.Agent.defaultMaxSockets,t.requests=[],t.sockets=[],t.on("free",function(n,i,s,o){for(var a=vn(i,s,o),c=0,u=t.requests.length;c<u;++c){var l=t.requests[c];if(l.host===a.host&&l.port===a.port){t.requests.splice(c,1),l.request.onSocket(n);return}}n.destroy(),t.removeSocket(n)})}Po.inherits(Y,Do.EventEmitter);Y.prototype.addRequest=function(t,r,n,i){var s=this,o=Gt({request:t},s.options,vn(r,n,i));if(s.sockets.length>=this.maxSockets){s.requests.push(o);return}s.createSocket(o,function(a){a.on("free",c),a.on("close",u),a.on("agentRemove",u),t.onSocket(a);function c(){s.emit("free",a,o)}function u(l){s.removeSocket(a),a.removeListener("free",c),a.removeListener("close",u),a.removeListener("agentRemove",u)}})};Y.prototype.createSocket=function(t,r){var n=this,i={};n.sockets.push(i);var s=Gt({},n.proxyOptions,{method:"CONNECT",path:t.host+":"+t.port,agent:!1,headers:{host:t.host+":"+t.port}});t.localAddress&&(s.localAddress=t.localAddress),s.proxyAuth&&(s.headers=s.headers||{},s.headers["Proxy-Authorization"]="Basic "+new Buffer(s.proxyAuth).toString("base64")),te("making CONNECT request");var o=n.request(s);o.useChunkedEncodingByDefault=!1,o.once("response",a),o.once("upgrade",c),o.once("connect",u),o.once("error",l),o.end();function a(h){h.upgrade=!0}function c(h,d,f){process.nextTick(function(){u(h,d,f)})}function u(h,d,f){if(o.removeAllListeners(),d.removeAllListeners(),h.statusCode!==200){te("tunneling socket could not be established, statusCode=%d",h.statusCode),d.destroy();var p=new Error("tunneling socket could not be established, statusCode="+h.statusCode);p.code="ECONNRESET",t.request.emit("error",p),n.removeSocket(i);return}if(f.length>0){te("got illegal response body from proxy"),d.destroy();var p=new Error("got illegal response body from proxy");p.code="ECONNRESET",t.request.emit("error",p),n.removeSocket(i);return}return te("tunneling connection has established"),n.sockets[n.sockets.indexOf(i)]=d,r(d)}function l(h){o.removeAllListeners(),te(`tunneling socket could not be established, cause=%s
`,h.message,h.stack);var d=new Error("tunneling socket could not be established, cause="+h.message);d.code="ECONNRESET",t.request.emit("error",d),n.removeSocket(i)}};Y.prototype.removeSocket=function(t){var r=this.sockets.indexOf(t);if(r!==-1){this.sockets.splice(r,1);var n=this.requests.shift();n&&this.createSocket(n,function(i){n.request.onSocket(i)})}};function gn(e,t){var r=this;Y.prototype.createSocket.call(r,e,function(n){var i=e.request.getHeader("host"),s=Gt({},r.options,{socket:n,servername:i?i.replace(/:.*$/,""):e.host}),o=No.connect(0,s);r.sockets[r.sockets.indexOf(n)]=o,t(o)})}function vn(e,t,r){return typeof e=="string"?{host:e,port:t,localAddress:r}:e}function Gt(e){for(var t=1,r=arguments.length;t<r;++t){var n=arguments[t];if(typeof n=="object")for(var i=Object.keys(n),s=0,o=i.length;s<o;++s){var a=i[s];n[a]!==void 0&&(e[a]=n[a])}}return e}var te;process.env.NODE_DEBUG&&/\btunnel\b/.test(process.env.NODE_DEBUG)?te=function(){var e=Array.prototype.slice.call(arguments);typeof e[0]=="string"?e[0]="TUNNEL: "+e[0]:e.unshift("TUNNEL:"),console.error.apply(console,e)}:te=function(){};Oe.debug=te});var wn=y((nl,yn)=>{yn.exports=mn()});var dt=y(M=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0});var ft=require("http"),Bt=require("https"),_n=dn(),Ce,H;(function(e){e[e.OK=200]="OK",e[e.MultipleChoices=300]="MultipleChoices",e[e.MovedPermanently=301]="MovedPermanently",e[e.ResourceMoved=302]="ResourceMoved",e[e.SeeOther=303]="SeeOther",e[e.NotModified=304]="NotModified",e[e.UseProxy=305]="UseProxy",e[e.SwitchProxy=306]="SwitchProxy",e[e.TemporaryRedirect=307]="TemporaryRedirect",e[e.PermanentRedirect=308]="PermanentRedirect",e[e.BadRequest=400]="BadRequest",e[e.Unauthorized=401]="Unauthorized",e[e.PaymentRequired=402]="PaymentRequired",e[e.Forbidden=403]="Forbidden",e[e.NotFound=404]="NotFound",e[e.MethodNotAllowed=405]="MethodNotAllowed",e[e.NotAcceptable=406]="NotAcceptable",e[e.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",e[e.RequestTimeout=408]="RequestTimeout",e[e.Conflict=409]="Conflict",e[e.Gone=410]="Gone",e[e.TooManyRequests=429]="TooManyRequests",e[e.InternalServerError=500]="InternalServerError",e[e.NotImplemented=501]="NotImplemented",e[e.BadGateway=502]="BadGateway",e[e.ServiceUnavailable=503]="ServiceUnavailable",e[e.GatewayTimeout=504]="GatewayTimeout"})(H=M.HttpCodes||(M.HttpCodes={}));var D;(function(e){e.Accept="accept",e.ContentType="content-type"})(D=M.Headers||(M.Headers={}));var re;(function(e){e.ApplicationJson="application/json"})(re=M.MediaTypes||(M.MediaTypes={}));function jo(e){let t=_n.getProxyUrl(new URL(e));return t?t.href:""}M.getProxyUrl=jo;var Lo=[H.MovedPermanently,H.ResourceMoved,H.SeeOther,H.TemporaryRedirect,H.PermanentRedirect],xo=[H.BadGateway,H.ServiceUnavailable,H.GatewayTimeout],Go=["OPTIONS","GET","DELETE","HEAD"],Bo=10,Ho=5,je=class extends Error{constructor(t,r){super(t);this.name="HttpClientError",this.statusCode=r,Object.setPrototypeOf(this,je.prototype)}};M.HttpClientError=je;var Ht=class{constructor(t){this.message=t}readBody(){return new Promise(async(t,r)=>{let n=Buffer.alloc(0);this.message.on("data",i=>{n=Buffer.concat([n,i])}),this.message.on("end",()=>{t(n.toString())})})}};M.HttpClientResponse=Ht;function zo(e){return new URL(e).protocol==="https:"}M.isHttps=zo;var ht=class{constructor(t,r,n){this._ignoreSslError=!1,this._allowRedirects=!0,this._allowRedirectDowngrade=!1,this._maxRedirects=50,this._allowRetries=!1,this._maxRetries=1,this._keepAlive=!1,this._disposed=!1,this.userAgent=t,this.handlers=r||[],this.requestOptions=n,n&&(n.ignoreSslError!=null&&(this._ignoreSslError=n.ignoreSslError),this._socketTimeout=n.socketTimeout,n.allowRedirects!=null&&(this._allowRedirects=n.allowRedirects),n.allowRedirectDowngrade!=null&&(this._allowRedirectDowngrade=n.allowRedirectDowngrade),n.maxRedirects!=null&&(this._maxRedirects=Math.max(n.maxRedirects,0)),n.keepAlive!=null&&(this._keepAlive=n.keepAlive),n.allowRetries!=null&&(this._allowRetries=n.allowRetries),n.maxRetries!=null&&(this._maxRetries=n.maxRetries))}options(t,r){return this.request("OPTIONS",t,null,r||{})}get(t,r){return this.request("GET",t,null,r||{})}del(t,r){return this.request("DELETE",t,null,r||{})}post(t,r,n){return this.request("POST",t,r,n||{})}patch(t,r,n){return this.request("PATCH",t,r,n||{})}put(t,r,n){return this.request("PUT",t,r,n||{})}head(t,r){return this.request("HEAD",t,null,r||{})}sendStream(t,r,n,i){return this.request(t,r,n,i)}async getJson(t,r={}){r[D.Accept]=this._getExistingOrDefaultHeader(r,D.Accept,re.ApplicationJson);let n=await this.get(t,r);return this._processResponse(n,this.requestOptions)}async postJson(t,r,n={}){let i=JSON.stringify(r,null,2);n[D.Accept]=this._getExistingOrDefaultHeader(n,D.Accept,re.ApplicationJson),n[D.ContentType]=this._getExistingOrDefaultHeader(n,D.ContentType,re.ApplicationJson);let s=await this.post(t,i,n);return this._processResponse(s,this.requestOptions)}async putJson(t,r,n={}){let i=JSON.stringify(r,null,2);n[D.Accept]=this._getExistingOrDefaultHeader(n,D.Accept,re.ApplicationJson),n[D.ContentType]=this._getExistingOrDefaultHeader(n,D.ContentType,re.ApplicationJson);let s=await this.put(t,i,n);return this._processResponse(s,this.requestOptions)}async patchJson(t,r,n={}){let i=JSON.stringify(r,null,2);n[D.Accept]=this._getExistingOrDefaultHeader(n,D.Accept,re.ApplicationJson),n[D.ContentType]=this._getExistingOrDefaultHeader(n,D.ContentType,re.ApplicationJson);let s=await this.patch(t,i,n);return this._processResponse(s,this.requestOptions)}async request(t,r,n,i){if(this._disposed)throw new Error("Client has already been disposed.");let s=new URL(r),o=this._prepareRequest(t,s,i),a=this._allowRetries&&Go.indexOf(t)!=-1?this._maxRetries+1:1,c=0,u;for(;c<a;){if(u=await this.requestRaw(o,n),u&&u.message&&u.message.statusCode===H.Unauthorized){let h;for(let d=0;d<this.handlers.length;d++)if(this.handlers[d].canHandleAuthentication(u)){h=this.handlers[d];break}return h?h.handleAuthentication(this,o,n):u}let l=this._maxRedirects;for(;Lo.indexOf(u.message.statusCode)!=-1&&this._allowRedirects&&l>0;){let h=u.message.headers.location;if(!h)break;let d=new URL(h);if(s.protocol=="https:"&&s.protocol!=d.protocol&&!this._allowRedirectDowngrade)throw new Error("Redirect from HTTPS to HTTP protocol. This downgrade is not allowed for security reasons. If you want to allow this behavior, set the allowRedirectDowngrade option to true.");if(await u.readBody(),d.hostname!==s.hostname)for(let f in i)f.toLowerCase()==="authorization"&&delete i[f];o=this._prepareRequest(t,d,i),u=await this.requestRaw(o,n),l--}if(xo.indexOf(u.message.statusCode)==-1)return u;c+=1,c<a&&(await u.readBody(),await this._performExponentialBackoff(c))}return u}dispose(){this._agent&&this._agent.destroy(),this._disposed=!0}requestRaw(t,r){return new Promise((n,i)=>{let s=function(o,a){o&&i(o),n(a)};this.requestRawWithCallback(t,r,s)})}requestRawWithCallback(t,r,n){let i;typeof r=="string"&&(t.options.headers["Content-Length"]=Buffer.byteLength(r,"utf8"));let s=!1,o=(c,u)=>{s||(s=!0,n(c,u))},a=t.httpModule.request(t.options,c=>{let u=new Ht(c);o(null,u)});a.on("socket",c=>{i=c}),a.setTimeout(this._socketTimeout||3*6e4,()=>{i&&i.end(),o(new Error("Request timeout: "+t.options.path),null)}),a.on("error",function(c){o(c,null)}),r&&typeof r=="string"&&a.write(r,"utf8"),r&&typeof r!="string"?(r.on("close",function(){a.end()}),r.pipe(a)):a.end()}getAgent(t){let r=new URL(t);return this._getAgent(r)}_prepareRequest(t,r,n){let i={};i.parsedUrl=r;let s=i.parsedUrl.protocol==="https:";i.httpModule=s?Bt:ft;let o=s?443:80;return i.options={},i.options.host=i.parsedUrl.hostname,i.options.port=i.parsedUrl.port?parseInt(i.parsedUrl.port):o,i.options.path=(i.parsedUrl.pathname||"")+(i.parsedUrl.search||""),i.options.method=t,i.options.headers=this._mergeHeaders(n),this.userAgent!=null&&(i.options.headers["user-agent"]=this.userAgent),i.options.agent=this._getAgent(i.parsedUrl),this.handlers&&this.handlers.forEach(a=>{a.prepareRequest(i.options)}),i}_mergeHeaders(t){let r=n=>Object.keys(n).reduce((i,s)=>(i[s.toLowerCase()]=n[s],i),{});return this.requestOptions&&this.requestOptions.headers?Object.assign({},r(this.requestOptions.headers),r(t)):r(t||{})}_getExistingOrDefaultHeader(t,r,n){let i=o=>Object.keys(o).reduce((a,c)=>(a[c.toLowerCase()]=o[c],a),{}),s;return this.requestOptions&&this.requestOptions.headers&&(s=i(this.requestOptions.headers)[r]),t[r]||s||n}_getAgent(t){let r,n=_n.getProxyUrl(t),i=n&&n.hostname;if(this._keepAlive&&i&&(r=this._proxyAgent),this._keepAlive&&!i&&(r=this._agent),r)return r;let s=t.protocol==="https:",o=100;if(this.requestOptions&&(o=this.requestOptions.maxSockets||ft.globalAgent.maxSockets),i){Ce||(Ce=wn());let a={maxSockets:o,keepAlive:this._keepAlive,proxy:nt(ee({},(n.username||n.password)&&{proxyAuth:`${n.username}:${n.password}`}),{host:n.hostname,port:n.port})},c,u=n.protocol==="https:";s?c=u?Ce.httpsOverHttps:Ce.httpsOverHttp:c=u?Ce.httpOverHttps:Ce.httpOverHttp,r=c(a),this._proxyAgent=r}if(this._keepAlive&&!r){let a={keepAlive:this._keepAlive,maxSockets:o};r=s?new Bt.Agent(a):new ft.Agent(a),this._agent=r}return r||(r=s?Bt.globalAgent:ft.globalAgent),s&&this._ignoreSslError&&(r.options=Object.assign(r.options||{},{rejectUnauthorized:!1})),r}_performExponentialBackoff(t){t=Math.min(Bo,t);let r=Ho*Math.pow(2,t);return new Promise(n=>setTimeout(()=>n(),r))}static dateTimeDeserializer(t,r){if(typeof r=="string"){let n=new Date(r);if(!isNaN(n.valueOf()))return n}return r}async _processResponse(t,r){return new Promise(async(n,i)=>{let s=t.message.statusCode,o={statusCode:s,result:null,headers:{}};s==H.NotFound&&n(o);let a,c;try{c=await t.readBody(),c&&c.length>0&&(r&&r.deserializeDates?a=JSON.parse(c,ht.dateTimeDeserializer):a=JSON.parse(c),o.result=a),o.headers=t.message.headers}catch(u){}if(s>299){let u;a&&a.message?u=a.message:c&&c.length>0?u=c:u="Failed request: ("+s+")";let l=new je(u,s);l.result=o.result,i(l)}else n(o)})}};M.HttpClient=ht});var An=y((sl,Rn)=>{var Sn=require("fs"),zt=require("path"),Wo=require("os"),Vo=dt(),{spawn:Jo}=require("child_process"),k=F(),bn=ut(),{getServices:Ko,isLocalRode:Xo,isAuthEnabled:Yo}=at(),En=5,Qo=5e3,Te={rodeHost:"localhost:50051",opaUrl:"http://localhost:8181",elasticsearchUrl:"http://localhost:9200",grafeasHost:"localhost:8080",oidcProviderUrl:"http://localhost:3000"},Zo=()=>{Object.entries(Te).forEach(([e,t])=>{k.setOutput(e,t)})},ea=async e=>{if(!Xo())return Promise.resolve();k.info("Starting local Rode");let t=zt.join(e,"rode.log"),r=Sn.createWriteStream(t,{flags:"a"});return new Promise(n=>{r.once("open",()=>{let i=process.env.GITHUB_WORKSPACE||".";k.info(`Spawning Rode process, sending logs to ${t}`);let s={OIDC_ISSUER:Te.oidcProviderUrl,OIDC_REQUIRED_AUDIENCE:"rode",OIDC_TLS_INSECURE_SKIP_VERIFY:"true"},o=Jo(zt.join(i,"rode"),{detached:!0,cwd:i,env:ee(nt(ee({},process.env),{GRAFEAS_HOST:Te.grafeasHost,ELASTICSEARCH_HOST:Te.elasticsearchUrl,OPA_HOST:Te.opaUrl}),Yo()?s:{}),stdio:["ignore",r,r]});k.saveState("localRodePid",o.pid),k.info(`Spawned rode with pid ${o.pid}`),o.unref(),n()})})},ta=e=>new Promise(t=>setTimeout(t,e)),ra=async()=>{let e=new Vo.HttpClient;k.info("Waiting for Rode to start");for(let t=0;t<En;t++){try{if(k.info("Checking if Rode is ready..."),(await e.get(`http://${Te.rodeHost}/v1alpha1/policy-groups`)).message.statusCode===200){k.info("Rode has started");return}}catch(r){k.info(`Error waiting for Rode to start (attempt ${t+1}/${En}): ${r.stack}`)}await ta(Qo)}throw k.saveState("localRodePid",""),new Error("Timed out waiting for Rode to start")},na=()=>{k.info("Creating logs directory");let e=Sn.mkdtempSync(zt.join(Wo.tmpdir(),"rode-dev-env-services-"));return k.info(`Logs will be sent to ${e}`),k.saveState("logsDir",e),e};Rn.exports=async()=>{k.info("Running rode-dev-env main");let e=na(),t=Ko();k.info("Starting services"),bn.up(t),bn.ps(),await ea(e),await ra(),k.info("Setting outputs"),Zo()}});var kn=y(Le=>{"use strict";Object.defineProperty(Le,"__esModule",{value:!0});var On=class{constructor(t,r){this.username=t,this.password=r}prepareRequest(t){t.headers.Authorization="Basic "+Buffer.from(this.username+":"+this.password).toString("base64")}canHandleAuthentication(t){return!1}handleAuthentication(t,r,n){return null}};Le.BasicCredentialHandler=On;var Cn=class{constructor(t){this.token=t}prepareRequest(t){t.headers.Authorization="Bearer "+this.token}canHandleAuthentication(t){return!1}handleAuthentication(t,r,n){return null}};Le.BearerCredentialHandler=Cn;var Tn=class{constructor(t){this.token=t}prepareRequest(t){t.headers.Authorization="Basic "+Buffer.from("PAT:"+this.token).toString("base64")}canHandleAuthentication(t){return!1}handleAuthentication(t,r,n){return null}};Le.PersonalAccessTokenCredentialHandler=Tn});var ke=y($=>{"use strict";Object.defineProperty($,"__esModule",{value:!0});function ia(){return 2}$.getUploadFileConcurrency=ia;function sa(){return 8*1024*1024}$.getUploadChunkSize=sa;function oa(){return 5}$.getRetryLimit=oa;function aa(){return 1.5}$.getRetryMultiplier=aa;function ca(){return 3e3}$.getInitialRetryIntervalInMilliseconds=ca;function ua(){return 2}$.getDownloadFileConcurrency=ua;function la(){let e=process.env.ACTIONS_RUNTIME_TOKEN;if(!e)throw new Error("Unable to get ACTIONS_RUNTIME_TOKEN env variable");return e}$.getRuntimeToken=la;function fa(){let e=process.env.ACTIONS_RUNTIME_URL;if(!e)throw new Error("Unable to get ACTIONS_RUNTIME_URL env variable");return e}$.getRuntimeUrl=fa;function ha(){let e=process.env.GITHUB_RUN_ID;if(!e)throw new Error("Unable to get GITHUB_RUN_ID env variable");return e}$.getWorkFlowRunId=ha;function da(){let e=process.env.GITHUB_WORKSPACE;if(!e)throw new Error("Unable to get GITHUB_WORKSPACE env variable");return e}$.getWorkSpaceDirectory=da;function pa(){return process.env.GITHUB_RETENTION_DAYS}$.getRetentionDays=pa});var ve=y(E=>{"use strict";var xe=E&&E.__awaiter||function(e,t,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(l){try{u(n.next(l))}catch(h){o(h)}}function c(l){try{u(n.throw(l))}catch(h){o(h)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((n=n.apply(e,t||[])).next())})};Object.defineProperty(E,"__esModule",{value:!0});var pe=F(),pt=require("fs"),ne=dt(),ga=kn(),ge=ke();function va(e){if(e<0)throw new Error("RetryCount should not be negative");if(e===0)return ge.getInitialRetryIntervalInMilliseconds();let t=ge.getInitialRetryIntervalInMilliseconds()*ge.getRetryMultiplier()*e,r=t*ge.getRetryMultiplier();return Math.random()*(r-t)+t}E.getExponentialRetryTimeInMilliseconds=va;function ma(e){let t=Number(process.env[e]);if(!(Number.isNaN(t)||t<0))return t}E.parseEnvNumber=ma;function Ge(){return"6.0-preview"}E.getApiVersion=Ge;function ya(e){return e?e>=200&&e<300:!1}E.isSuccessStatusCode=ya;function wa(e){return e?e===ne.HttpCodes.Forbidden:!1}E.isForbiddenStatusCode=wa;function _a(e){return e?[ne.HttpCodes.BadGateway,ne.HttpCodes.GatewayTimeout,ne.HttpCodes.InternalServerError,ne.HttpCodes.ServiceUnavailable,ne.HttpCodes.TooManyRequests,413].includes(e):!1}E.isRetryableStatusCode=_a;function Sa(e){return e?e===ne.HttpCodes.TooManyRequests:!1}E.isThrottledStatusCode=Sa;function ba(e){if(e["retry-after"]){let t=Number(e["retry-after"]);if(!isNaN(t))return pe.info(`Retry-After header is present with a value of ${t}`),t*1e3;pe.info(`Returned retry-after header value: ${t} is non-numeric and cannot be used`);return}pe.info("No retry-after header was found. Dumping all headers for diagnostic purposes"),console.log(e)}E.tryGetRetryAfterValueTimeInMilliseconds=ba;function Ea(e,t,r){return`bytes ${e}-${t}/${r}`}E.getContentRange=Ea;function Ra(e,t,r){let n={};return e&&(n["Content-Type"]=e),t&&(n.Connection="Keep-Alive",n["Keep-Alive"]="10"),r?(n["Accept-Encoding"]="gzip",n.Accept=`application/octet-stream;api-version=${Ge()}`):n.Accept=`application/json;api-version=${Ge()}`,n}E.getDownloadHeaders=Ra;function Aa(e,t,r,n,i,s){let o={};return o.Accept=`application/json;api-version=${Ge()}`,e&&(o["Content-Type"]=e),t&&(o.Connection="Keep-Alive",o["Keep-Alive"]="10"),r&&(o["Content-Encoding"]="gzip",o["x-tfs-filelength"]=n),i&&(o["Content-Length"]=i),s&&(o["Content-Range"]=s),o}E.getUploadHeaders=Aa;function Oa(e){return new ne.HttpClient(e,[new ga.BearerCredentialHandler(ge.getRuntimeToken())])}E.createHttpClient=Oa;function Ca(){let e=`${ge.getRuntimeUrl()}_apis/pipelines/workflows/${ge.getWorkFlowRunId()}/artifacts?api-version=${Ge()}`;return pe.debug(`Artifact Url: ${e}`),e}E.getArtifactUrl=Ca;function Ta(e){pe.info(`##### Begin Diagnostic HTTP information #####
Status Code: ${e.message.statusCode}
Status Message: ${e.message.statusMessage}
Header Information: ${JSON.stringify(e.message.headers,void 0,2)}
###### End Diagnostic HTTP information ######`)}E.displayHttpDiagnostics=Ta;var Wt=['"',":","<",">","|","*","?"],qn=[...Wt,"\\","/"];function ka(e){if(!e)throw new Error(`Artifact name: ${e}, is incorrectly provided`);for(let t of qn)if(e.includes(t))throw new Error(`Artifact name is not valid: ${e}. Contains character: "${t}". Invalid artifact name characters include: ${qn.toString()}.`)}E.checkArtifactName=ka;function qa(e){if(!e)throw new Error(`Artifact path: ${e}, is incorrectly provided`);for(let t of Wt)if(e.includes(t))throw new Error(`Artifact path is not valid: ${e}. Contains character: "${t}". Invalid characters include: ${Wt.toString()}.`)}E.checkArtifactFilePath=qa;function Ia(e){return xe(this,void 0,void 0,function*(){for(let t of e)yield pt.promises.mkdir(t,{recursive:!0})})}E.createDirectoriesForArtifact=Ia;function Na(e){return xe(this,void 0,void 0,function*(){for(let t of e)yield(yield pt.promises.open(t,"w")).close()})}E.createEmptyFilesForArtifact=Na;function Da(e){return xe(this,void 0,void 0,function*(){let t=yield pt.promises.stat(e);return pe.debug(`${e} size:(${t.size}) blksize:(${t.blksize}) blocks:(${t.blocks})`),t.size})}E.getFileSize=Da;function Pa(e){return xe(this,void 0,void 0,function*(){yield pt.promises.unlink(e)})}E.rmFile=Pa;function Fa(e,t){if(e<0)throw new Error("Invalid retention, minimum value is 1.");let r=e;if(t){let n=parseInt(t);!isNaN(n)&&n<r&&(pe.warning(`Retention days is greater than the max value allowed by the repository setting, reduce retention to ${n} days`),r=n)}return r}E.getProperRetention=Fa;function Ma(e){return xe(this,void 0,void 0,function*(){return new Promise(t=>setTimeout(t,e))})}E.sleep=Ma});var Nn=y(He=>{"use strict";var $a=He&&He.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(He,"__esModule",{value:!0});var gt=$a(require("fs")),Ua=F(),Be=require("path"),In=ve();function ja(e,t,r){In.checkArtifactName(e);let n=[];if(!gt.existsSync(t))throw new Error(`Provided rootDirectory ${t} does not exist`);if(!gt.lstatSync(t).isDirectory())throw new Error(`Provided rootDirectory ${t} is not a valid directory`);t=Be.normalize(t),t=Be.resolve(t);for(let i of r){if(!gt.existsSync(i))throw new Error(`File ${i} does not exist`);if(gt.lstatSync(i).isDirectory())Ua.debug(`Removing ${i} from rawSearchResults because it is a directory`);else{if(i=Be.normalize(i),i=Be.resolve(i),!i.startsWith(t))throw new Error(`The rootDirectory: ${t} is not a parent directory of the file: ${i}`);let s=i.replace(t,"");In.checkArtifactFilePath(s),n.push({absoluteFilePath:i,uploadFilePath:Be.join(e,s)})}}return n}He.getUploadSpecification=ja});var Dn=y(Vt=>{var me=require("path"),ie=process.platform==="win32",se=require("fs"),La=process.env.NODE_DEBUG&&/fs/.test(process.env.NODE_DEBUG);function xa(){var e;if(La){var t=new Error;e=r}else e=n;return e;function r(i){i&&(t.message=i.message,i=t,n(i))}function n(i){if(i){if(process.throwDeprecation)throw i;if(!process.noDeprecation){var s="fs: missing callback "+(i.stack||i.message);process.traceDeprecation?console.trace(s):console.error(s)}}}}function Ga(e){return typeof e=="function"?e:xa()}var ll=me.normalize;ie?Q=/(.*?)(?:[\/\\]+|$)/g:Q=/(.*?)(?:[\/]+|$)/g;var Q;ie?ze=/^(?:[a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/][^\\\/]+)?[\\\/]*/:ze=/^[\/]*/;var ze;Vt.realpathSync=function(t,r){if(t=me.resolve(t),r&&Object.prototype.hasOwnProperty.call(r,t))return r[t];var n=t,i={},s={},o,a,c,u;l();function l(){var m=ze.exec(t);o=m[0].length,a=m[0],c=m[0],u="",ie&&!s[c]&&(se.lstatSync(c),s[c]=!0)}for(;o<t.length;){Q.lastIndex=o;var h=Q.exec(t);if(u=a,a+=h[0],c=u+h[1],o=Q.lastIndex,!(s[c]||r&&r[c]===c)){var d;if(r&&Object.prototype.hasOwnProperty.call(r,c))d=r[c];else{var f=se.lstatSync(c);if(!f.isSymbolicLink()){s[c]=!0,r&&(r[c]=c);continue}var p=null;if(!ie){var g=f.dev.toString(32)+":"+f.ino.toString(32);i.hasOwnProperty(g)&&(p=i[g])}p===null&&(se.statSync(c),p=se.readlinkSync(c)),d=me.resolve(u,p),r&&(r[c]=d),ie||(i[g]=p)}t=me.resolve(d,t.slice(o)),l()}}return r&&(r[n]=t),t};Vt.realpath=function(t,r,n){if(typeof n!="function"&&(n=Ga(r),r=null),t=me.resolve(t),r&&Object.prototype.hasOwnProperty.call(r,t))return process.nextTick(n.bind(null,null,r[t]));var i=t,s={},o={},a,c,u,l;h();function h(){var m=ze.exec(t);a=m[0].length,c=m[0],u=m[0],l="",ie&&!o[u]?se.lstat(u,function(w){if(w)return n(w);o[u]=!0,d()}):process.nextTick(d)}function d(){if(a>=t.length)return r&&(r[i]=t),n(null,t);Q.lastIndex=a;var m=Q.exec(t);return l=c,c+=m[0],u=l+m[1],a=Q.lastIndex,o[u]||r&&r[u]===u?process.nextTick(d):r&&Object.prototype.hasOwnProperty.call(r,u)?g(r[u]):se.lstat(u,f)}function f(m,w){if(m)return n(m);if(!w.isSymbolicLink())return o[u]=!0,r&&(r[u]=u),process.nextTick(d);if(!ie){var b=w.dev.toString(32)+":"+w.ino.toString(32);if(s.hasOwnProperty(b))return p(null,s[b],u)}se.stat(u,function(T){if(T)return n(T);se.readlink(u,function(O,B){ie||(s[b]=B),p(O,B)})})}function p(m,w,b){if(m)return n(m);var T=me.resolve(l,w);r&&(r[b]=T),g(T)}function g(m){t=me.resolve(m,t.slice(a)),h()}}});var Yt=y((hl,$n)=>{$n.exports=oe;oe.realpath=oe;oe.sync=Xt;oe.realpathSync=Xt;oe.monkeypatch=Ha;oe.unmonkeypatch=za;var qe=require("fs"),Jt=qe.realpath,Kt=qe.realpathSync,Ba=process.version,Pn=/^v[0-5]\./.test(Ba),Fn=Dn();function Mn(e){return e&&e.syscall==="realpath"&&(e.code==="ELOOP"||e.code==="ENOMEM"||e.code==="ENAMETOOLONG")}function oe(e,t,r){if(Pn)return Jt(e,t,r);typeof t=="function"&&(r=t,t=null),Jt(e,t,function(n,i){Mn(n)?Fn.realpath(e,t,r):r(n,i)})}function Xt(e,t){if(Pn)return Kt(e,t);try{return Kt(e,t)}catch(r){if(Mn(r))return Fn.realpathSync(e,t);throw r}}function Ha(){qe.realpath=oe,qe.realpathSync=Xt}function za(){qe.realpath=Jt,qe.realpathSync=Kt}});var jn=y((dl,Un)=>{Un.exports=function(e,t){for(var r=[],n=0;n<e.length;n++){var i=t(e[n],n);Wa(i)?r.push.apply(r,i):r.push(i)}return r};var Wa=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"}});var Hn=y((pl,Bn)=>{"use strict";Bn.exports=Ln;function Ln(e,t,r){e instanceof RegExp&&(e=xn(e,r)),t instanceof RegExp&&(t=xn(t,r));var n=Gn(e,t,r);return n&&{start:n[0],end:n[1],pre:r.slice(0,n[0]),body:r.slice(n[0]+e.length,n[1]),post:r.slice(n[1]+t.length)}}function xn(e,t){var r=t.match(e);return r?r[0]:null}Ln.range=Gn;function Gn(e,t,r){var n,i,s,o,a,c=r.indexOf(e),u=r.indexOf(t,c+1),l=c;if(c>=0&&u>0){if(e===t)return[c,u];for(n=[],s=r.length;l>=0&&!a;)l==c?(n.push(l),c=r.indexOf(e,l+1)):n.length==1?a=[n.pop(),u]:(i=n.pop(),i<s&&(s=i,o=u),u=r.indexOf(t,l+1)),l=c<u&&c>=0?c:u;n.length&&(a=[s,o])}return a}});var Qn=y((gl,Yn)=>{var Va=jn(),zn=Hn();Yn.exports=Xa;var Wn="\0SLASH"+Math.random()+"\0",Vn="\0OPEN"+Math.random()+"\0",Qt="\0CLOSE"+Math.random()+"\0",Jn="\0COMMA"+Math.random()+"\0",Kn="\0PERIOD"+Math.random()+"\0";function Zt(e){return parseInt(e,10)==e?parseInt(e,10):e.charCodeAt(0)}function Ja(e){return e.split("\\\\").join(Wn).split("\\{").join(Vn).split("\\}").join(Qt).split("\\,").join(Jn).split("\\.").join(Kn)}function Ka(e){return e.split(Wn).join("\\").split(Vn).join("{").split(Qt).join("}").split(Jn).join(",").split(Kn).join(".")}function Xn(e){if(!e)return[""];var t=[],r=zn("{","}",e);if(!r)return e.split(",");var n=r.pre,i=r.body,s=r.post,o=n.split(",");o[o.length-1]+="{"+i+"}";var a=Xn(s);return s.length&&(o[o.length-1]+=a.shift(),o.push.apply(o,a)),t.push.apply(t,o),t}function Xa(e){return e?(e.substr(0,2)==="{}"&&(e="\\{\\}"+e.substr(2)),Ie(Ja(e),!0).map(Ka)):[]}function Ya(e){return"{"+e+"}"}function Qa(e){return/^-?0\d/.test(e)}function Za(e,t){return e<=t}function ec(e,t){return e>=t}function Ie(e,t){var r=[],n=zn("{","}",e);if(!n||/\$$/.test(n.pre))return[e];var i=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(n.body),s=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(n.body),o=i||s,a=n.body.indexOf(",")>=0;if(!o&&!a)return n.post.match(/,.*\}/)?(e=n.pre+"{"+n.body+Qt+n.post,Ie(e)):[e];var c;if(o)c=n.body.split(/\.\./);else if(c=Xn(n.body),c.length===1&&(c=Ie(c[0],!1).map(Ya),c.length===1)){var l=n.post.length?Ie(n.post,!1):[""];return l.map(function(Pt){return n.pre+c[0]+Pt})}var u=n.pre,l=n.post.length?Ie(n.post,!1):[""],h;if(o){var d=Zt(c[0]),f=Zt(c[1]),p=Math.max(c[0].length,c[1].length),g=c.length==3?Math.abs(Zt(c[2])):1,m=Za,w=f<d;w&&(g*=-1,m=ec);var b=c.some(Qa);h=[];for(var T=d;m(T,f);T+=g){var O;if(s)O=String.fromCharCode(T),O==="\\"&&(O="");else if(O=String(T),b){var B=p-O.length;if(B>0){var tt=new Array(B+1).join("0");T<0?O="-"+tt+O.slice(1):O=tt+O}}h.push(O)}}else h=Va(c,function(rt){return Ie(rt,!1)});for(var Re=0;Re<h.length;Re++)for(var he=0;he<l.length;he++){var X=u+h[Re]+l[he];(!t||o||X)&&r.push(X)}return r}});var mt=y((vl,ii)=>{ii.exports=x;x.Minimatch=C;var We={sep:"/"};try{We=require("path")}catch(e){}var er=x.GLOBSTAR=C.GLOBSTAR={},tc=Qn(),Zn={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}},tr="[^/]",rr=tr+"*?",rc="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",nc="(?:(?!(?:\\/|^)\\.).)*?",ei=ic("().*{}+?[]^$\\!");function ic(e){return e.split("").reduce(function(t,r){return t[r]=!0,t},{})}var ti=/\/+/;x.filter=sc;function sc(e,t){return t=t||{},function(r,n,i){return x(r,e,t)}}function ri(e,t){e=e||{},t=t||{};var r={};return Object.keys(t).forEach(function(n){r[n]=t[n]}),Object.keys(e).forEach(function(n){r[n]=e[n]}),r}x.defaults=function(e){if(!e||!Object.keys(e).length)return x;var t=x,r=function(i,s,o){return t.minimatch(i,s,ri(e,o))};return r.Minimatch=function(i,s){return new t.Minimatch(i,ri(e,s))},r};C.defaults=function(e){return!e||!Object.keys(e).length?C:x.defaults(e).Minimatch};function x(e,t,r){if(typeof t!="string")throw new TypeError("glob pattern string required");return r||(r={}),!r.nocomment&&t.charAt(0)==="#"?!1:t.trim()===""?e==="":new C(t,r).match(e)}function C(e,t){if(!(this instanceof C))return new C(e,t);if(typeof e!="string")throw new TypeError("glob pattern string required");t||(t={}),e=e.trim(),We.sep!=="/"&&(e=e.split(We.sep).join("/")),this.options=t,this.set=[],this.pattern=e,this.regexp=null,this.negate=!1,this.comment=!1,this.empty=!1,this.make()}C.prototype.debug=function(){};C.prototype.make=oc;function oc(){if(!this._made){var e=this.pattern,t=this.options;if(!t.nocomment&&e.charAt(0)==="#"){this.comment=!0;return}if(!e){this.empty=!0;return}this.parseNegate();var r=this.globSet=this.braceExpand();t.debug&&(this.debug=console.error),this.debug(this.pattern,r),r=this.globParts=r.map(function(n){return n.split(ti)}),this.debug(this.pattern,r),r=r.map(function(n,i,s){return n.map(this.parse,this)},this),this.debug(this.pattern,r),r=r.filter(function(n){return n.indexOf(!1)===-1}),this.debug(this.pattern,r),this.set=r}}C.prototype.parseNegate=ac;function ac(){var e=this.pattern,t=!1,r=this.options,n=0;if(!r.nonegate){for(var i=0,s=e.length;i<s&&e.charAt(i)==="!";i++)t=!t,n++;n&&(this.pattern=e.substr(n)),this.negate=t}}x.braceExpand=function(e,t){return ni(e,t)};C.prototype.braceExpand=ni;function ni(e,t){if(t||(this instanceof C?t=this.options:t={}),e=typeof e=="undefined"?this.pattern:e,typeof e=="undefined")throw new TypeError("undefined pattern");return t.nobrace||!e.match(/\{.*\}/)?[e]:tc(e)}C.prototype.parse=cc;var vt={};function cc(e,t){if(e.length>1024*64)throw new TypeError("pattern is too long");var r=this.options;if(!r.noglobstar&&e==="**")return er;if(e==="")return"";var n="",i=!!r.nocase,s=!1,o=[],a=[],c,u=!1,l=-1,h=-1,d=e.charAt(0)==="."?"":r.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",f=this;function p(){if(c){switch(c){case"*":n+=rr,i=!0;break;case"?":n+=tr,i=!0;break;default:n+="\\"+c;break}f.debug("clearStateChar %j %j",c,n),c=!1}}for(var g=0,m=e.length,w;g<m&&(w=e.charAt(g));g++){if(this.debug("%s	%s %s %j",e,g,n,w),s&&ei[w]){n+="\\"+w,s=!1;continue}switch(w){case"/":return!1;case"\\":p(),s=!0;continue;case"?":case"*":case"+":case"@":case"!":if(this.debug("%s	%s %s %j <-- stateChar",e,g,n,w),u){this.debug("  in class"),w==="!"&&g===h+1&&(w="^"),n+=w;continue}f.debug("call clearStateChar %j",c),p(),c=w,r.noext&&p();continue;case"(":if(u){n+="(";continue}if(!c){n+="\\(";continue}o.push({type:c,start:g-1,reStart:n.length,open:Zn[c].open,close:Zn[c].close}),n+=c==="!"?"(?:(?!(?:":"(?:",this.debug("plType %j %j",c,n),c=!1;continue;case")":if(u||!o.length){n+="\\)";continue}p(),i=!0;var b=o.pop();n+=b.close,b.type==="!"&&a.push(b),b.reEnd=n.length;continue;case"|":if(u||!o.length||s){n+="\\|",s=!1;continue}p(),n+="|";continue;case"[":if(p(),u){n+="\\"+w;continue}u=!0,h=g,l=n.length,n+=w;continue;case"]":if(g===h+1||!u){n+="\\"+w,s=!1;continue}if(u){var T=e.substring(h+1,g);try{RegExp("["+T+"]")}catch(Gr){var O=this.parse(T,vt);n=n.substr(0,l)+"\\["+O[0]+"\\]",i=i||O[1],u=!1;continue}}i=!0,u=!1,n+=w;continue;default:p(),s?s=!1:ei[w]&&!(w==="^"&&u)&&(n+="\\"),n+=w}}for(u&&(T=e.substr(h+1),O=this.parse(T,vt),n=n.substr(0,l)+"\\["+O[0],i=i||O[1]),b=o.pop();b;b=o.pop()){var B=n.slice(b.reStart+b.open.length);this.debug("setting tail",n,b),B=B.replace(/((?:\\{2}){0,64})(\\?)\|/g,function(Gr,Br,$t){return $t||($t="\\"),Br+Br+$t+"|"}),this.debug(`tail=%j
   %s`,B,B,b,n);var tt=b.type==="*"?rr:b.type==="?"?tr:"\\"+b.type;i=!0,n=n.slice(0,b.reStart)+tt+"\\("+B}p(),s&&(n+="\\\\");var Re=!1;switch(n.charAt(0)){case".":case"[":case"(":Re=!0}for(var he=a.length-1;he>-1;he--){var X=a[he],rt=n.slice(0,X.reStart),Pt=n.slice(X.reStart,X.reEnd-8),Lr=n.slice(X.reEnd-8,X.reEnd),Ue=n.slice(X.reEnd);Lr+=Ue;var Ns=rt.split("(").length-1,Ft=Ue;for(g=0;g<Ns;g++)Ft=Ft.replace(/\)[+*?]?/,"");Ue=Ft;var xr="";Ue===""&&t!==vt&&(xr="$");var Ds=rt+Pt+Ue+xr+Lr;n=Ds}if(n!==""&&i&&(n="(?=.)"+n),Re&&(n=d+n),t===vt)return[n,i];if(!i)return fc(e);var Ps=r.nocase?"i":"";try{var Mt=new RegExp("^"+n+"$",Ps)}catch(Gr){return new RegExp("$.")}return Mt._glob=e,Mt._src=n,Mt}x.makeRe=function(e,t){return new C(e,t||{}).makeRe()};C.prototype.makeRe=uc;function uc(){if(this.regexp||this.regexp===!1)return this.regexp;var e=this.set;if(!e.length)return this.regexp=!1,this.regexp;var t=this.options,r=t.noglobstar?rr:t.dot?rc:nc,n=t.nocase?"i":"",i=e.map(function(s){return s.map(function(o){return o===er?r:typeof o=="string"?hc(o):o._src}).join("\\/")}).join("|");i="^(?:"+i+")$",this.negate&&(i="^(?!"+i+").*$");try{this.regexp=new RegExp(i,n)}catch(s){this.regexp=!1}return this.regexp}x.match=function(e,t,r){r=r||{};var n=new C(t,r);return e=e.filter(function(i){return n.match(i)}),n.options.nonull&&!e.length&&e.push(t),e};C.prototype.match=lc;function lc(e,t){if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return e==="";if(e==="/"&&t)return!0;var r=this.options;We.sep!=="/"&&(e=e.split(We.sep).join("/")),e=e.split(ti),this.debug(this.pattern,"split",e);var n=this.set;this.debug(this.pattern,"set",n);var i,s;for(s=e.length-1;s>=0&&(i=e[s],!i);s--);for(s=0;s<n.length;s++){var o=n[s],a=e;r.matchBase&&o.length===1&&(a=[i]);var c=this.matchOne(a,o,t);if(c)return r.flipNegate?!0:!this.negate}return r.flipNegate?!1:this.negate}C.prototype.matchOne=function(e,t,r){var n=this.options;this.debug("matchOne",{this:this,file:e,pattern:t}),this.debug("matchOne",e.length,t.length);for(var i=0,s=0,o=e.length,a=t.length;i<o&&s<a;i++,s++){this.debug("matchOne loop");var c=t[s],u=e[i];if(this.debug(t,c,u),c===!1)return!1;if(c===er){this.debug("GLOBSTAR",[t,c,u]);var l=i,h=s+1;if(h===a){for(this.debug("** at the end");i<o;i++)if(e[i]==="."||e[i]===".."||!n.dot&&e[i].charAt(0)===".")return!1;return!0}for(;l<o;){var d=e[l];if(this.debug(`
globstar while`,e,l,t,h,d),this.matchOne(e.slice(l),t.slice(h),r))return this.debug("globstar found match!",l,o,d),!0;if(d==="."||d===".."||!n.dot&&d.charAt(0)==="."){this.debug("dot detected!",e,l,t,h);break}this.debug("globstar swallow a segment, and continue"),l++}return!!(r&&(this.debug(`
>>> no match, partial?`,e,l,t,h),l===o))}var f;if(typeof c=="string"?(n.nocase?f=u.toLowerCase()===c.toLowerCase():f=u===c,this.debug("string match",c,u,f)):(f=u.match(c),this.debug("pattern match",c,u,f)),!f)return!1}if(i===o&&s===a)return!0;if(i===o)return r;if(s===a){var p=i===o-1&&e[i]==="";return p}throw new Error("wtf?")};function fc(e){return e.replace(/\\(.)/g,"$1")}function hc(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}});var si=y((ml,nr)=>{typeof Object.create=="function"?nr.exports=function(t,r){r&&(t.super_=r,t.prototype=Object.create(r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:nr.exports=function(t,r){if(r){t.super_=r;var n=function(){};n.prototype=r.prototype,t.prototype=new n,t.prototype.constructor=t}}});var oi=y((yl,sr)=>{try{if(ir=require("util"),typeof ir.inherits!="function")throw"";sr.exports=ir.inherits}catch(e){sr.exports=si()}var ir});var wt=y((wl,yt)=>{"use strict";function ai(e){return e.charAt(0)==="/"}function ci(e){var t=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/,r=t.exec(e),n=r[1]||"",i=Boolean(n&&n.charAt(1)!==":");return Boolean(r[2]||i)}yt.exports=process.platform==="win32"?ci:ai;yt.exports.posix=ai;yt.exports.win32=ci});var ar=y(ae=>{ae.setopts=yc;ae.ownProp=ui;ae.makeAbs=Ve;ae.finish=wc;ae.mark=_c;ae.isIgnored=fi;ae.childrenIgnored=Sc;function ui(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var dc=require("fs"),Ne=require("path"),pc=mt(),li=wt(),or=pc.Minimatch;function gc(e,t){return e.localeCompare(t,"en")}function vc(e,t){e.ignore=t.ignore||[],Array.isArray(e.ignore)||(e.ignore=[e.ignore]),e.ignore.length&&(e.ignore=e.ignore.map(mc))}function mc(e){var t=null;if(e.slice(-3)==="/**"){var r=e.replace(/(\/\*\*)+$/,"");t=new or(r,{dot:!0})}return{matcher:new or(e,{dot:!0}),gmatcher:t}}function yc(e,t,r){if(r||(r={}),r.matchBase&&t.indexOf("/")===-1){if(r.noglobstar)throw new Error("base matching requires globstar");t="**/"+t}e.silent=!!r.silent,e.pattern=t,e.strict=r.strict!==!1,e.realpath=!!r.realpath,e.realpathCache=r.realpathCache||Object.create(null),e.follow=!!r.follow,e.dot=!!r.dot,e.mark=!!r.mark,e.nodir=!!r.nodir,e.nodir&&(e.mark=!0),e.sync=!!r.sync,e.nounique=!!r.nounique,e.nonull=!!r.nonull,e.nosort=!!r.nosort,e.nocase=!!r.nocase,e.stat=!!r.stat,e.noprocess=!!r.noprocess,e.absolute=!!r.absolute,e.fs=r.fs||dc,e.maxLength=r.maxLength||1/0,e.cache=r.cache||Object.create(null),e.statCache=r.statCache||Object.create(null),e.symlinks=r.symlinks||Object.create(null),vc(e,r),e.changedCwd=!1;var n=process.cwd();ui(r,"cwd")?(e.cwd=Ne.resolve(r.cwd),e.changedCwd=e.cwd!==n):e.cwd=n,e.root=r.root||Ne.resolve(e.cwd,"/"),e.root=Ne.resolve(e.root),process.platform==="win32"&&(e.root=e.root.replace(/\\/g,"/")),e.cwdAbs=li(e.cwd)?e.cwd:Ve(e,e.cwd),process.platform==="win32"&&(e.cwdAbs=e.cwdAbs.replace(/\\/g,"/")),e.nomount=!!r.nomount,r.nonegate=!0,r.nocomment=!0,e.minimatch=new or(t,r),e.options=e.minimatch.options}function wc(e){for(var t=e.nounique,r=t?[]:Object.create(null),n=0,i=e.matches.length;n<i;n++){var s=e.matches[n];if(!s||Object.keys(s).length===0){if(e.nonull){var o=e.minimatch.globSet[n];t?r.push(o):r[o]=!0}}else{var a=Object.keys(s);t?r.push.apply(r,a):a.forEach(function(c){r[c]=!0})}}if(t||(r=Object.keys(r)),e.nosort||(r=r.sort(gc)),e.mark){for(var n=0;n<r.length;n++)r[n]=e._mark(r[n]);e.nodir&&(r=r.filter(function(c){var u=!/\/$/.test(c),l=e.cache[c]||e.cache[Ve(e,c)];return u&&l&&(u=l!=="DIR"&&!Array.isArray(l)),u}))}e.ignore.length&&(r=r.filter(function(c){return!fi(e,c)})),e.found=r}function _c(e,t){var r=Ve(e,t),n=e.cache[r],i=t;if(n){var s=n==="DIR"||Array.isArray(n),o=t.slice(-1)==="/";if(s&&!o?i+="/":!s&&o&&(i=i.slice(0,-1)),i!==t){var a=Ve(e,i);e.statCache[a]=e.statCache[r],e.cache[a]=e.cache[r]}}return i}function Ve(e,t){var r=t;return t.charAt(0)==="/"?r=Ne.join(e.root,t):li(t)||t===""?r=t:e.changedCwd?r=Ne.resolve(e.cwd,t):r=Ne.resolve(t),process.platform==="win32"&&(r=r.replace(/\\/g,"/")),r}function fi(e,t){return e.ignore.length?e.ignore.some(function(r){return r.matcher.match(t)||!!(r.gmatcher&&r.gmatcher.match(t))}):!1}function Sc(e,t){return e.ignore.length?e.ignore.some(function(r){return!!(r.gmatcher&&r.gmatcher.match(t))}):!1}});var vi=y((Rl,gi)=>{gi.exports=pi;pi.GlobSync=A;var bc=Yt(),hi=mt(),Sl=hi.Minimatch,bl=lr().Glob,El=require("util"),cr=require("path"),di=require("assert"),_t=wt(),ye=ar(),Ec=ye.setopts,ur=ye.ownProp,Rc=ye.childrenIgnored,Ac=ye.isIgnored;function pi(e,t){if(typeof t=="function"||arguments.length===3)throw new TypeError(`callback provided to sync glob
See: https://github.com/isaacs/node-glob/issues/167`);return new A(e,t).found}function A(e,t){if(!e)throw new Error("must provide pattern");if(typeof t=="function"||arguments.length===3)throw new TypeError(`callback provided to sync glob
See: https://github.com/isaacs/node-glob/issues/167`);if(!(this instanceof A))return new A(e,t);if(Ec(this,e,t),this.noprocess)return this;var r=this.minimatch.set.length;this.matches=new Array(r);for(var n=0;n<r;n++)this._process(this.minimatch.set[n],n,!1);this._finish()}A.prototype._finish=function(){if(di(this instanceof A),this.realpath){var e=this;this.matches.forEach(function(t,r){var n=e.matches[r]=Object.create(null);for(var i in t)try{i=e._makeAbs(i);var s=bc.realpathSync(i,e.realpathCache);n[s]=!0}catch(o){if(o.syscall==="stat")n[e._makeAbs(i)]=!0;else throw o}})}ye.finish(this)};A.prototype._process=function(e,t,r){di(this instanceof A);for(var n=0;typeof e[n]=="string";)n++;var i;switch(n){case e.length:this._processSimple(e.join("/"),t);return;case 0:i=null;break;default:i=e.slice(0,n).join("/");break}var s=e.slice(n),o;i===null?o=".":((_t(i)||_t(e.join("/")))&&(!i||!_t(i))&&(i="/"+i),o=i);var a=this._makeAbs(o);if(!Rc(this,o)){var c=s[0]===hi.GLOBSTAR;c?this._processGlobStar(i,o,a,s,t,r):this._processReaddir(i,o,a,s,t,r)}};A.prototype._processReaddir=function(e,t,r,n,i,s){var o=this._readdir(r,s);if(!!o){for(var a=n[0],c=!!this.minimatch.negate,u=a._glob,l=this.dot||u.charAt(0)===".",h=[],d=0;d<o.length;d++){var f=o[d];if(f.charAt(0)!=="."||l){var p;c&&!e?p=!f.match(a):p=f.match(a),p&&h.push(f)}}var g=h.length;if(g!==0){if(n.length===1&&!this.mark&&!this.stat){this.matches[i]||(this.matches[i]=Object.create(null));for(var d=0;d<g;d++){var f=h[d];e&&(e.slice(-1)!=="/"?f=e+"/"+f:f=e+f),f.charAt(0)==="/"&&!this.nomount&&(f=cr.join(this.root,f)),this._emitMatch(i,f)}return}n.shift();for(var d=0;d<g;d++){var f=h[d],m;e?m=[e,f]:m=[f],this._process(m.concat(n),i,s)}}}};A.prototype._emitMatch=function(e,t){if(!Ac(this,t)){var r=this._makeAbs(t);if(this.mark&&(t=this._mark(t)),this.absolute&&(t=r),!this.matches[e][t]){if(this.nodir){var n=this.cache[r];if(n==="DIR"||Array.isArray(n))return}this.matches[e][t]=!0,this.stat&&this._stat(t)}}};A.prototype._readdirInGlobStar=function(e){if(this.follow)return this._readdir(e,!1);var t,r,n;try{r=this.fs.lstatSync(e)}catch(s){if(s.code==="ENOENT")return null}var i=r&&r.isSymbolicLink();return this.symlinks[e]=i,!i&&r&&!r.isDirectory()?this.cache[e]="FILE":t=this._readdir(e,!1),t};A.prototype._readdir=function(e,t){var r;if(t&&!ur(this.symlinks,e))return this._readdirInGlobStar(e);if(ur(this.cache,e)){var n=this.cache[e];if(!n||n==="FILE")return null;if(Array.isArray(n))return n}try{return this._readdirEntries(e,this.fs.readdirSync(e))}catch(i){return this._readdirError(e,i),null}};A.prototype._readdirEntries=function(e,t){if(!this.mark&&!this.stat)for(var r=0;r<t.length;r++){var n=t[r];e==="/"?n=e+n:n=e+"/"+n,this.cache[n]=!0}return this.cache[e]=t,t};A.prototype._readdirError=function(e,t){switch(t.code){case"ENOTSUP":case"ENOTDIR":var r=this._makeAbs(e);if(this.cache[r]="FILE",r===this.cwdAbs){var n=new Error(t.code+" invalid cwd "+this.cwd);throw n.path=this.cwd,n.code=t.code,n}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(e)]=!1;break;default:if(this.cache[this._makeAbs(e)]=!1,this.strict)throw t;this.silent||console.error("glob error",t);break}};A.prototype._processGlobStar=function(e,t,r,n,i,s){var o=this._readdir(r,s);if(!!o){var a=n.slice(1),c=e?[e]:[],u=c.concat(a);this._process(u,i,!1);var l=o.length,h=this.symlinks[r];if(!(h&&s))for(var d=0;d<l;d++){var f=o[d];if(!(f.charAt(0)==="."&&!this.dot)){var p=c.concat(o[d],a);this._process(p,i,!0);var g=c.concat(o[d],n);this._process(g,i,!0)}}}};A.prototype._processSimple=function(e,t){var r=this._stat(e);if(this.matches[t]||(this.matches[t]=Object.create(null)),!!r){if(e&&_t(e)&&!this.nomount){var n=/[\/\\]$/.test(e);e.charAt(0)==="/"?e=cr.join(this.root,e):(e=cr.resolve(this.root,e),n&&(e+="/"))}process.platform==="win32"&&(e=e.replace(/\\/g,"/")),this._emitMatch(t,e)}};A.prototype._stat=function(e){var t=this._makeAbs(e),r=e.slice(-1)==="/";if(e.length>this.maxLength)return!1;if(!this.stat&&ur(this.cache,t)){var o=this.cache[t];if(Array.isArray(o)&&(o="DIR"),!r||o==="DIR")return o;if(r&&o==="FILE")return!1}var n,i=this.statCache[t];if(!i){var s;try{s=this.fs.lstatSync(t)}catch(a){if(a&&(a.code==="ENOENT"||a.code==="ENOTDIR"))return this.statCache[t]=!1,!1}if(s&&s.isSymbolicLink())try{i=this.fs.statSync(t)}catch(a){i=s}else i=s}this.statCache[t]=i;var o=!0;return i&&(o=i.isDirectory()?"DIR":"FILE"),this.cache[t]=this.cache[t]||o,r&&o==="FILE"?!1:o};A.prototype._mark=function(e){return ye.mark(this,e)};A.prototype._makeAbs=function(e){return ye.makeAbs(this,e)}});var fr=y((Al,yi)=>{yi.exports=mi;function mi(e,t){if(e&&t)return mi(e)(t);if(typeof e!="function")throw new TypeError("need wrapper function");return Object.keys(e).forEach(function(n){r[n]=e[n]}),r;function r(){for(var n=new Array(arguments.length),i=0;i<n.length;i++)n[i]=arguments[i];var s=e.apply(this,n),o=n[n.length-1];return typeof s=="function"&&s!==o&&Object.keys(o).forEach(function(a){s[a]=o[a]}),s}}});var dr=y((Ol,hr)=>{var wi=fr();hr.exports=wi(St);hr.exports.strict=wi(_i);St.proto=St(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return St(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return _i(this)},configurable:!0})});function St(e){var t=function(){return t.called?t.value:(t.called=!0,t.value=e.apply(this,arguments))};return t.called=!1,t}function _i(e){var t=function(){if(t.called)throw new Error(t.onceError);return t.called=!0,t.value=e.apply(this,arguments)},r=e.name||"Function wrapped with `once`";return t.onceError=r+" shouldn't be called more than once",t.called=!1,t}});var bi=y((Cl,Si)=>{var Oc=fr(),Je=Object.create(null),Cc=dr();Si.exports=Oc(Tc);function Tc(e,t){return Je[e]?(Je[e].push(t),null):(Je[e]=[t],kc(e))}function kc(e){return Cc(function t(){var r=Je[e],n=r.length,i=qc(arguments);try{for(var s=0;s<n;s++)r[s].apply(null,i)}finally{r.length>n?(r.splice(0,n),process.nextTick(function(){t.apply(null,i)})):delete Je[e]}})}function qc(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n]=e[n];return r}});var lr=y((ql,Ri)=>{Ri.exports=_e;var Ic=Yt(),Ei=mt(),Tl=Ei.Minimatch,Nc=oi(),Dc=require("events").EventEmitter,pr=require("path"),gr=require("assert"),Ke=wt(),vr=vi(),we=ar(),Pc=we.setopts,mr=we.ownProp,yr=bi(),kl=require("util"),Fc=we.childrenIgnored,Mc=we.isIgnored,$c=dr();function _e(e,t,r){if(typeof t=="function"&&(r=t,t={}),t||(t={}),t.sync){if(r)throw new TypeError("callback provided to sync glob");return vr(e,t)}return new S(e,t,r)}_e.sync=vr;var Uc=_e.GlobSync=vr.GlobSync;_e.glob=_e;function jc(e,t){if(t===null||typeof t!="object")return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}_e.hasMagic=function(e,t){var r=jc({},t);r.noprocess=!0;var n=new S(e,r),i=n.minimatch.set;if(!e)return!1;if(i.length>1)return!0;for(var s=0;s<i[0].length;s++)if(typeof i[0][s]!="string")return!0;return!1};_e.Glob=S;Nc(S,Dc);function S(e,t,r){if(typeof t=="function"&&(r=t,t=null),t&&t.sync){if(r)throw new TypeError("callback provided to sync glob");return new Uc(e,t)}if(!(this instanceof S))return new S(e,t,r);Pc(this,e,t),this._didRealPath=!1;var n=this.minimatch.set.length;this.matches=new Array(n),typeof r=="function"&&(r=$c(r),this.on("error",r),this.on("end",function(c){r(null,c)}));var i=this;if(this._processing=0,this._emitQueue=[],this._processQueue=[],this.paused=!1,this.noprocess)return this;if(n===0)return a();for(var s=!0,o=0;o<n;o++)this._process(this.minimatch.set[o],o,!1,a);s=!1;function a(){--i._processing,i._processing<=0&&(s?process.nextTick(function(){i._finish()}):i._finish())}}S.prototype._finish=function(){if(gr(this instanceof S),!this.aborted){if(this.realpath&&!this._didRealpath)return this._realpath();we.finish(this),this.emit("end",this.found)}};S.prototype._realpath=function(){if(this._didRealpath)return;this._didRealpath=!0;var e=this.matches.length;if(e===0)return this._finish();for(var t=this,r=0;r<this.matches.length;r++)this._realpathSet(r,n);function n(){--e==0&&t._finish()}};S.prototype._realpathSet=function(e,t){var r=this.matches[e];if(!r)return t();var n=Object.keys(r),i=this,s=n.length;if(s===0)return t();var o=this.matches[e]=Object.create(null);n.forEach(function(a,c){a=i._makeAbs(a),Ic.realpath(a,i.realpathCache,function(u,l){u?u.syscall==="stat"?o[a]=!0:i.emit("error",u):o[l]=!0,--s==0&&(i.matches[e]=o,t())})})};S.prototype._mark=function(e){return we.mark(this,e)};S.prototype._makeAbs=function(e){return we.makeAbs(this,e)};S.prototype.abort=function(){this.aborted=!0,this.emit("abort")};S.prototype.pause=function(){this.paused||(this.paused=!0,this.emit("pause"))};S.prototype.resume=function(){if(this.paused){if(this.emit("resume"),this.paused=!1,this._emitQueue.length){var e=this._emitQueue.slice(0);this._emitQueue.length=0;for(var t=0;t<e.length;t++){var r=e[t];this._emitMatch(r[0],r[1])}}if(this._processQueue.length){var n=this._processQueue.slice(0);this._processQueue.length=0;for(var t=0;t<n.length;t++){var i=n[t];this._processing--,this._process(i[0],i[1],i[2],i[3])}}}};S.prototype._process=function(e,t,r,n){if(gr(this instanceof S),gr(typeof n=="function"),!this.aborted){if(this._processing++,this.paused){this._processQueue.push([e,t,r,n]);return}for(var i=0;typeof e[i]=="string";)i++;var s;switch(i){case e.length:this._processSimple(e.join("/"),t,n);return;case 0:s=null;break;default:s=e.slice(0,i).join("/");break}var o=e.slice(i),a;s===null?a=".":((Ke(s)||Ke(e.join("/")))&&(!s||!Ke(s))&&(s="/"+s),a=s);var c=this._makeAbs(a);if(Fc(this,a))return n();var u=o[0]===Ei.GLOBSTAR;u?this._processGlobStar(s,a,c,o,t,r,n):this._processReaddir(s,a,c,o,t,r,n)}};S.prototype._processReaddir=function(e,t,r,n,i,s,o){var a=this;this._readdir(r,s,function(c,u){return a._processReaddir2(e,t,r,n,i,s,u,o)})};S.prototype._processReaddir2=function(e,t,r,n,i,s,o,a){if(!o)return a();for(var c=n[0],u=!!this.minimatch.negate,l=c._glob,h=this.dot||l.charAt(0)===".",d=[],f=0;f<o.length;f++){var p=o[f];if(p.charAt(0)!=="."||h){var g;u&&!e?g=!p.match(c):g=p.match(c),g&&d.push(p)}}var m=d.length;if(m===0)return a();if(n.length===1&&!this.mark&&!this.stat){this.matches[i]||(this.matches[i]=Object.create(null));for(var f=0;f<m;f++){var p=d[f];e&&(e!=="/"?p=e+"/"+p:p=e+p),p.charAt(0)==="/"&&!this.nomount&&(p=pr.join(this.root,p)),this._emitMatch(i,p)}return a()}n.shift();for(var f=0;f<m;f++){var p=d[f],w;e&&(e!=="/"?p=e+"/"+p:p=e+p),this._process([p].concat(n),i,s,a)}a()};S.prototype._emitMatch=function(e,t){if(!this.aborted&&!Mc(this,t)){if(this.paused){this._emitQueue.push([e,t]);return}var r=Ke(t)?t:this._makeAbs(t);if(this.mark&&(t=this._mark(t)),this.absolute&&(t=r),!this.matches[e][t]){if(this.nodir){var n=this.cache[r];if(n==="DIR"||Array.isArray(n))return}this.matches[e][t]=!0;var i=this.statCache[r];i&&this.emit("stat",t,i),this.emit("match",t)}}};S.prototype._readdirInGlobStar=function(e,t){if(this.aborted)return;if(this.follow)return this._readdir(e,!1,t);var r="lstat\0"+e,n=this,i=yr(r,s);i&&n.fs.lstat(e,i);function s(o,a){if(o&&o.code==="ENOENT")return t();var c=a&&a.isSymbolicLink();n.symlinks[e]=c,!c&&a&&!a.isDirectory()?(n.cache[e]="FILE",t()):n._readdir(e,!1,t)}};S.prototype._readdir=function(e,t,r){if(!this.aborted&&(r=yr("readdir\0"+e+"\0"+t,r),!!r)){if(t&&!mr(this.symlinks,e))return this._readdirInGlobStar(e,r);if(mr(this.cache,e)){var n=this.cache[e];if(!n||n==="FILE")return r();if(Array.isArray(n))return r(null,n)}var i=this;i.fs.readdir(e,Lc(this,e,r))}};function Lc(e,t,r){return function(n,i){n?e._readdirError(t,n,r):e._readdirEntries(t,i,r)}}S.prototype._readdirEntries=function(e,t,r){if(!this.aborted){if(!this.mark&&!this.stat)for(var n=0;n<t.length;n++){var i=t[n];e==="/"?i=e+i:i=e+"/"+i,this.cache[i]=!0}return this.cache[e]=t,r(null,t)}};S.prototype._readdirError=function(e,t,r){if(!this.aborted){switch(t.code){case"ENOTSUP":case"ENOTDIR":var n=this._makeAbs(e);if(this.cache[n]="FILE",n===this.cwdAbs){var i=new Error(t.code+" invalid cwd "+this.cwd);i.path=this.cwd,i.code=t.code,this.emit("error",i),this.abort()}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(e)]=!1;break;default:this.cache[this._makeAbs(e)]=!1,this.strict&&(this.emit("error",t),this.abort()),this.silent||console.error("glob error",t);break}return r()}};S.prototype._processGlobStar=function(e,t,r,n,i,s,o){var a=this;this._readdir(r,s,function(c,u){a._processGlobStar2(e,t,r,n,i,s,u,o)})};S.prototype._processGlobStar2=function(e,t,r,n,i,s,o,a){if(!o)return a();var c=n.slice(1),u=e?[e]:[],l=u.concat(c);this._process(l,i,!1,a);var h=this.symlinks[r],d=o.length;if(h&&s)return a();for(var f=0;f<d;f++){var p=o[f];if(!(p.charAt(0)==="."&&!this.dot)){var g=u.concat(o[f],c);this._process(g,i,!0,a);var m=u.concat(o[f],n);this._process(m,i,!0,a)}}a()};S.prototype._processSimple=function(e,t,r){var n=this;this._stat(e,function(i,s){n._processSimple2(e,t,i,s,r)})};S.prototype._processSimple2=function(e,t,r,n,i){if(this.matches[t]||(this.matches[t]=Object.create(null)),!n)return i();if(e&&Ke(e)&&!this.nomount){var s=/[\/\\]$/.test(e);e.charAt(0)==="/"?e=pr.join(this.root,e):(e=pr.resolve(this.root,e),s&&(e+="/"))}process.platform==="win32"&&(e=e.replace(/\\/g,"/")),this._emitMatch(t,e),i()};S.prototype._stat=function(e,t){var r=this._makeAbs(e),n=e.slice(-1)==="/";if(e.length>this.maxLength)return t();if(!this.stat&&mr(this.cache,r)){var i=this.cache[r];if(Array.isArray(i)&&(i="DIR"),!n||i==="DIR")return t(null,i);if(n&&i==="FILE")return t()}var s,o=this.statCache[r];if(o!==void 0){if(o===!1)return t(null,o);var a=o.isDirectory()?"DIR":"FILE";return n&&a==="FILE"?t():t(null,a,o)}var c=this,u=yr("stat\0"+r,l);u&&c.fs.lstat(r,u);function l(h,d){if(d&&d.isSymbolicLink())return c.fs.stat(r,function(f,p){f?c._stat2(e,r,null,d,t):c._stat2(e,r,f,p,t)});c._stat2(e,r,h,d,t)}};S.prototype._stat2=function(e,t,r,n,i){if(r&&(r.code==="ENOENT"||r.code==="ENOTDIR"))return this.statCache[t]=!1,i();var s=e.slice(-1)==="/";if(this.statCache[t]=n,t.slice(-1)==="/"&&n&&!n.isDirectory())return i(null,!1,n);var o=!0;return n&&(o=n.isDirectory()?"DIR":"FILE"),this.cache[t]=this.cache[t]||o,s&&o==="FILE"?i():i(null,o,n)}});var Di=y((Il,Ni)=>{Ni.exports=_r;_r.sync=Ii;var _=require("assert"),Ai=require("path"),Oi=require("fs"),De=void 0;try{De=lr()}catch(e){}var Ci=parseInt("666",8),xc={nosort:!0,silent:!0},wr=0,Xe=process.platform==="win32";function Ti(e){var t=["unlink","chmod","stat","lstat","rmdir","readdir"];if(t.forEach(function(r){e[r]=e[r]||Oi[r],r=r+"Sync",e[r]=e[r]||Oi[r]}),e.maxBusyTries=e.maxBusyTries||3,e.emfileWait=e.emfileWait||1e3,e.glob===!1&&(e.disableGlob=!0),e.disableGlob!==!0&&De===void 0)throw Error("glob dependency not found, set `options.disableGlob = true` if intentional");e.disableGlob=e.disableGlob||!1,e.glob=e.glob||xc}function _r(e,t,r){typeof t=="function"&&(r=t,t={}),_(e,"rimraf: missing path"),_.equal(typeof e,"string","rimraf: path should be a string"),_.equal(typeof r,"function","rimraf: callback function required"),_(t,"rimraf: invalid options argument provided"),_.equal(typeof t,"object","rimraf: options should be object"),Ti(t);var n=0,i=null,s=0;if(t.disableGlob||!De.hasMagic(e))return a(null,[e]);t.lstat(e,function(c,u){if(!c)return a(null,[e]);De(e,t.glob,a)});function o(c){i=i||c,--s==0&&r(i)}function a(c,u){if(c)return r(c);if(s=u.length,s===0)return r();u.forEach(function(l){Sr(l,t,function h(d){if(d){if((d.code==="EBUSY"||d.code==="ENOTEMPTY"||d.code==="EPERM")&&n<t.maxBusyTries){n++;var f=n*100;return setTimeout(function(){Sr(l,t,h)},f)}if(d.code==="EMFILE"&&wr<t.emfileWait)return setTimeout(function(){Sr(l,t,h)},wr++);d.code==="ENOENT"&&(d=null)}wr=0,o(d)})})}}function Sr(e,t,r){_(e),_(t),_(typeof r=="function"),t.lstat(e,function(n,i){if(n&&n.code==="ENOENT")return r(null);if(n&&n.code==="EPERM"&&Xe&&ki(e,t,n,r),i&&i.isDirectory())return bt(e,t,n,r);t.unlink(e,function(s){if(s){if(s.code==="ENOENT")return r(null);if(s.code==="EPERM")return Xe?ki(e,t,s,r):bt(e,t,s,r);if(s.code==="EISDIR")return bt(e,t,s,r)}return r(s)})})}function ki(e,t,r,n){_(e),_(t),_(typeof n=="function"),r&&_(r instanceof Error),t.chmod(e,Ci,function(i){i?n(i.code==="ENOENT"?null:r):t.stat(e,function(s,o){s?n(s.code==="ENOENT"?null:r):o.isDirectory()?bt(e,t,r,n):t.unlink(e,n)})})}function qi(e,t,r){_(e),_(t),r&&_(r instanceof Error);try{t.chmodSync(e,Ci)}catch(i){if(i.code==="ENOENT")return;throw r}try{var n=t.statSync(e)}catch(i){if(i.code==="ENOENT")return;throw r}n.isDirectory()?Et(e,t,r):t.unlinkSync(e)}function bt(e,t,r,n){_(e),_(t),r&&_(r instanceof Error),_(typeof n=="function"),t.rmdir(e,function(i){i&&(i.code==="ENOTEMPTY"||i.code==="EEXIST"||i.code==="EPERM")?Gc(e,t,n):i&&i.code==="ENOTDIR"?n(r):n(i)})}function Gc(e,t,r){_(e),_(t),_(typeof r=="function"),t.readdir(e,function(n,i){if(n)return r(n);var s=i.length;if(s===0)return t.rmdir(e,r);var o;i.forEach(function(a){_r(Ai.join(e,a),t,function(c){if(!o){if(c)return r(o=c);--s==0&&t.rmdir(e,r)}})})})}function Ii(e,t){t=t||{},Ti(t),_(e,"rimraf: missing path"),_.equal(typeof e,"string","rimraf: path should be a string"),_(t,"rimraf: missing options"),_.equal(typeof t,"object","rimraf: options should be object");var r;if(t.disableGlob||!De.hasMagic(e))r=[e];else try{t.lstatSync(e),r=[e]}catch(s){r=De.sync(e,t.glob)}if(!!r.length)for(var n=0;n<r.length;n++){var e=r[n];try{var i=t.lstatSync(e)}catch(o){if(o.code==="ENOENT")return;o.code==="EPERM"&&Xe&&qi(e,t,o)}try{i&&i.isDirectory()?Et(e,t,null):t.unlinkSync(e)}catch(o){if(o.code==="ENOENT")return;if(o.code==="EPERM")return Xe?qi(e,t,o):Et(e,t,o);if(o.code!=="EISDIR")throw o;Et(e,t,o)}}}function Et(e,t,r){_(e),_(t),r&&_(r instanceof Error);try{t.rmdirSync(e)}catch(n){if(n.code==="ENOENT")return;if(n.code==="ENOTDIR")throw r;(n.code==="ENOTEMPTY"||n.code==="EEXIST"||n.code==="EPERM")&&Bc(e,t)}}function Bc(e,t){_(e),_(t),t.readdirSync(e).forEach(function(o){Ii(Ai.join(e,o),t)});var r=Xe?100:1,n=0;do{var i=!0;try{var s=t.rmdirSync(e,t);return i=!1,s}finally{if(++n<r&&i)continue}}while(!0)}});var Ji=y((Nl,Z)=>{var R=require("fs"),br=require("os"),Rt=require("path"),Pi=require("crypto"),V=R.constants&&br.constants?{fs:R.constants,os:br.constants}:process.binding("constants"),Fi=Di(),Mi="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",Er=/XXXXXX/,$i=3,Ui=(V.O_CREAT||V.fs.O_CREAT)|(V.O_EXCL||V.fs.O_EXCL)|(V.O_RDWR||V.fs.O_RDWR),Hc=V.EBADF||V.os.errno.EBADF,zc=V.ENOENT||V.os.errno.ENOENT,ji=448,Li=384,Rr="exit",Ar="SIGINT",Pe=[],xi=!1;function Gi(e){var t=[],r=null;try{r=Pi.randomBytes(e)}catch(i){r=Pi.pseudoRandomBytes(e)}for(var n=0;n<e;n++)t.push(Mi[r[n]%Mi.length]);return t.join("")}function Wc(e){return typeof e=="undefined"}function Fe(e,t){return typeof e=="function"?[{},e]:Wc(e)?[{},t]:[e,t]}function Bi(e){let t=Vi();if(Me(e.dir)&&Me(t))throw new Error("No tmp dir specified");if(!Me(e.name))return Rt.join(e.dir||t,e.name);if(e.template){var r=e.template;return Rt.basename(r)===r&&(r=Rt.join(e.dir||t,r)),r.replace(Er,Gi(6))}let n=[Me(e.prefix)?"tmp-":e.prefix,process.pid,Gi(12),e.postfix?e.postfix:""].join("");return Rt.join(e.dir||t,n)}function Or(e,t){var r=Fe(e,t),n=r[0],i=r[1],s=Me(n.name)?n.tries||$i:1;if(isNaN(s)||s<0)return i(new Error("Invalid tries"));if(n.template&&!n.template.match(Er))return i(new Error("Invalid template provided"));(function o(){try{let a=Bi(n);R.stat(a,function(c){if(!c)return s-- >0?o():i(new Error("Could not get a unique tmp filename, max tries reached "+a));i(null,a)})}catch(a){i(a)}})()}function Cr(e){var t=Fe(e),r=t[0],n=Me(r.name)?r.tries||$i:1;if(isNaN(n)||n<0)throw new Error("Invalid tries");if(r.template&&!r.template.match(Er))throw new Error("Invalid template provided");do{let i=Bi(r);try{R.statSync(i)}catch(s){return i}}while(n-- >0);throw new Error("Could not get a unique tmp filename, max tries reached")}function Vc(e,t){var r=Fe(e,t),n=r[0],i=r[1];Or(n,function(o,a){if(o)return i(o);R.open(a,Ui,n.mode||Li,function(u,l){if(u)return i(u);if(n.discardDescriptor)return R.close(l,function(d){if(d){try{R.unlinkSync(a)}catch(f){Ct(f)||(d=f)}return i(d)}i(null,a,void 0,At(a,-1,n))});if(n.detachDescriptor)return i(null,a,l,At(a,-1,n));i(null,a,l,At(a,l,n))})})}function Jc(e){var t=Fe(e),r=t[0];let n=r.discardDescriptor||r.detachDescriptor,i=Cr(r);var s=R.openSync(i,Ui,r.mode||Li);return r.discardDescriptor&&(R.closeSync(s),s=void 0),{name:i,fd:s,removeCallback:At(i,n?-1:s,r)}}function Kc(e,t){var r=Fe(e,t),n=r[0],i=r[1];Or(n,function(o,a){if(o)return i(o);R.mkdir(a,n.mode||ji,function(u){if(u)return i(u);i(null,a,Hi(a,n))})})}function Xc(e){var t=Fe(e),r=t[0];let n=Cr(r);return R.mkdirSync(n,r.mode||ji),{name:n,removeCallback:Hi(n,r)}}function Yc(e,t){let r=function(n){if(n&&!Ct(n))return t(n);t()};0<=e[0]?R.close(e[0],function(n){R.unlink(e[1],r)}):R.unlink(e[1],r)}function Qc(e){try{0<=e[0]&&R.closeSync(e[0])}catch(t){if(!tu(t)&&!Ct(t))throw t}finally{try{R.unlinkSync(e[1])}catch(t){if(!Ct(t))throw t}}}function At(e,t,r){let n=Ot(Qc,[t,e]),i=Ot(Yc,[t,e],n);return r.keep||Pe.unshift(n),i}function Zc(e,t){Fi(e,t)}function eu(e,t){try{return t(null,Fi.sync(e))}catch(r){return t(r)}}function Hi(e,t){let r=t.unsafeCleanup?Zc:R.rmdir.bind(R),n=t.unsafeCleanup?eu:R.rmdirSync.bind(R),i=Ot(n,e),s=Ot(r,e,i);return t.keep||Pe.unshift(i),s}function Ot(e,t,r){var n=!1;return function i(s){if(s=s||function(){},n)return s(new Error("cleanup callback has already been called"));{let o=r||i,a=Pe.indexOf(o);if(a>=0&&Pe.splice(a,1),n=!0,e.length===1)try{return e(t),s(null)}catch(c){return s(c)}else return e(t,s)}}}function zi(){if(!!xi)for(;Pe.length;)try{Pe[0]()}catch(e){}}function tu(e){return Wi(e,-Hc,"EBADF")}function Ct(e){return Wi(e,-zc,"ENOENT")}function Wi(e,t,r){return e.code===t||e.code===r}function Me(e){return e==null||!e.trim()}function ru(){xi=!0}function Vi(){return br.tmpdir()}function nu(e){return(e.name==="_exit"||e.name==="_uncaughtExceptionThrown")&&e.toString().indexOf("_garbageCollector();")>-1}function iu(){let e=process.listeners(Ar),t=[];for(let r=0,n=e.length;r<n;r++){let i=e[r];i.name==="_tmp$sigint_listener"&&(t.push(i),process.removeListener(Ar,i))}process.on(Ar,function(n){for(let i=0,s=t.length;i<s;i++)try{t[i](!1)}catch(o){}try{zi()}finally{n&&process.exit(0)}})}function su(){let e=process.listeners(Rr),t=[];for(let r=0,n=e.length;r<n;r++){let i=e[r];(i.name==="_tmp$safe_listener"||nu(i))&&(i.name!=="_uncaughtExceptionThrown"&&t.push(i),process.removeListener(Rr,i))}process.addListener(Rr,function(n){for(let i=0,s=t.length;i<s;i++)try{t[i](n)}catch(o){}zi()})}su();iu();Object.defineProperty(Z.exports,"tmpdir",{enumerable:!0,configurable:!1,get:function(){return Vi()}});Z.exports.dir=Kc;Z.exports.dirSync=Xc;Z.exports.file=Vc;Z.exports.fileSync=Jc;Z.exports.tmpName=Or;Z.exports.tmpNameSync=Cr;Z.exports.setGracefulCleanup=ru});var Ki=y((Dl,U)=>{var{promisify:Ye}=require("util"),ce=Ji();U.exports.fileSync=ce.fileSync;var ou=Ye((e,t)=>ce.file(e,(r,n,i,s)=>r?t(r):t(void 0,{path:n,fd:i,cleanup:Ye(s)})));U.exports.file=async e=>ou(e);U.exports.withFile=async function(t,r){let{path:n,fd:i,cleanup:s}=await U.exports.file(r);try{return await t({path:n,fd:i})}finally{await s()}};U.exports.dirSync=ce.dirSync;var au=Ye((e,t)=>ce.dir(e,(r,n,i)=>r?t(r):t(void 0,{path:n,cleanup:Ye(i)})));U.exports.dir=async e=>au(e);U.exports.withDir=async function(t,r){let{path:n,cleanup:i}=await U.exports.dir(r);try{return await t({path:n})}finally{await i()}};U.exports.tmpNameSync=ce.tmpNameSync;U.exports.tmpName=Ye(ce.tmpName);U.exports.tmpdir=ce.tmpdir;U.exports.setGracefulCleanup=ce.setGracefulCleanup});var kr=y(Tr=>{"use strict";Object.defineProperty(Tr,"__esModule",{value:!0});var Xi=F(),Yi=class{constructor(t){this.totalNumberOfFilesToProcess=0,this.processedCount=0,this.largeFiles=new Map,this.totalFileStatus=void 0,this.largeFileStatus=void 0,this.displayFrequencyInMilliseconds=t}setTotalNumberOfFilesToProcess(t){this.totalNumberOfFilesToProcess=t}start(){this.totalFileStatus=setInterval(()=>{let t=this.formatPercentage(this.processedCount,this.totalNumberOfFilesToProcess);Xi.info(`Total file count: ${this.totalNumberOfFilesToProcess} ---- Processed file #${this.processedCount} (${t.slice(0,t.indexOf(".")+2)}%)`)},this.displayFrequencyInMilliseconds),this.largeFileStatus=setInterval(()=>{for(let t of Array.from(this.largeFiles.values()))Xi.info(t);this.largeFiles.clear()},1e3)}updateLargeFileStatus(t,r,n){let i=this.formatPercentage(r,n),s=`Uploading ${t} (${i.slice(0,i.indexOf(".")+2)}%)`;this.largeFiles.set(t,s)}stop(){this.totalFileStatus&&clearInterval(this.totalFileStatus),this.largeFileStatus&&clearInterval(this.largeFileStatus)}incrementProcessedCount(){this.processedCount++}formatPercentage(t,r){return(t/r*100).toFixed(4).toString()}};Tr.StatusReporter=Yi});var Ir=y(qr=>{"use strict";Object.defineProperty(qr,"__esModule",{value:!0});var Qi=ve(),Zi=class{constructor(t,r){if(t<1)throw new Error("There must be at least one client");this.userAgent=r,this.clients=new Array(t).fill(Qi.createHttpClient(r))}getClient(t){return this.clients[t]}disposeAndReplaceClient(t){this.clients[t].dispose(),this.clients[t]=Qi.createHttpClient(this.userAgent)}disposeAndReplaceAllClients(){for(let[t]of this.clients.entries())this.disposeAndReplaceClient(t)}};qr.HttpManager=Zi});var rs=y(J=>{"use strict";var Tt=J&&J.__awaiter||function(e,t,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(l){try{u(n.next(l))}catch(h){o(h)}}function c(l){try{u(n.throw(l))}catch(h){o(h)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((n=n.apply(e,t||[])).next())})},cu=J&&J.__asyncValues||function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof __values=="function"?__values(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(s){r[s]=e[s]&&function(o){return new Promise(function(a,c){o=e[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(u){s({value:u,done:a})},o)}},es=J&&J.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(J,"__esModule",{value:!0});var kt=es(require("fs")),ts=es(require("zlib")),uu=require("util"),lu=uu.promisify(kt.stat);function fu(e,t){return Tt(this,void 0,void 0,function*(){return new Promise((r,n)=>{let i=kt.createReadStream(e),s=ts.createGzip(),o=kt.createWriteStream(t);i.pipe(s).pipe(o),o.on("finish",()=>Tt(this,void 0,void 0,function*(){let a=(yield lu(t)).size;r(a)})),o.on("error",a=>{console.log(a)})})})}J.createGZipFileOnDisk=fu;function hu(e){return Tt(this,void 0,void 0,function*(){return new Promise(t=>Tt(this,void 0,void 0,function*(){var r,n;let i=kt.createReadStream(e),s=ts.createGzip();i.pipe(s);let o=[];try{for(var a=cu(s),c;c=yield a.next(),!c.done;){let u=c.value;o.push(u)}}catch(u){r={error:u}}finally{try{c&&!c.done&&(n=a.return)&&(yield n.call(a))}finally{if(r)throw r.error}}t(Buffer.concat(o))}))})}J.createGZipFileInBuffer=hu});var Nr=y(ue=>{"use strict";var ns=ue&&ue.__awaiter||function(e,t,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(l){try{u(n.next(l))}catch(h){o(h)}}function c(l){try{u(n.throw(l))}catch(h){o(h)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((n=n.apply(e,t||[])).next())})},du=ue&&ue.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(ue,"__esModule",{value:!0});var $e=ve(),is=du(F()),pu=ke();function ss(e,t,r,n){return ns(this,void 0,void 0,function*(){let i,s,o=!1,a="",c,u=1;for(;u<=n;){try{if(i=yield t(),s=i.message.statusCode,$e.isSuccessStatusCode(s))return i;s&&(c=r.get(s)),o=$e.isRetryableStatusCode(s),a=`Artifact service responded with ${s}`}catch(l){o=!0,a=l.message}if(!o){is.info(`${e} - Error is not retryable`),i&&$e.displayHttpDiagnostics(i);break}is.info(`${e} - Attempt ${u} of ${n} failed with error: ${a}`),yield $e.sleep($e.getExponentialRetryTimeInMilliseconds(u)),u++}throw i&&$e.displayHttpDiagnostics(i),Error(c?`${e} failed: ${c}`:`${e} failed: ${a}`)})}ue.retry=ss;function gu(e,t,r=new Map,n=pu.getRetryLimit()){return ns(this,void 0,void 0,function*(){return yield ss(e,t,r,n)})}ue.retryHttpClientRequest=gu});var fs=y(Se=>{"use strict";var K=Se&&Se.__awaiter||function(e,t,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(l){try{u(n.next(l))}catch(h){o(h)}}function c(l){try{u(n.throw(l))}catch(h){o(h)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((n=n.apply(e,t||[])).next())})},qt=Se&&Se.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(Se,"__esModule",{value:!0});var Dr=qt(require("fs")),q=qt(F()),vu=qt(Ki()),mu=qt(require("stream")),I=ve(),Qe=ke(),yu=require("util"),os=require("url"),as=require("perf_hooks"),wu=kr(),Pr=dt(),_u=Ir(),cs=rs(),us=Nr(),Su=yu.promisify(Dr.stat),ls=class{constructor(){this.uploadHttpManager=new _u.HttpManager(Qe.getUploadFileConcurrency(),"@actions/artifact-upload"),this.statusReporter=new wu.StatusReporter(1e4)}createArtifactInFileContainer(t,r){return K(this,void 0,void 0,function*(){let n={Type:"actions_storage",Name:t};if(r&&r.retentionDays){let h=Qe.getRetentionDays();n.RetentionDays=I.getProperRetention(r.retentionDays,h)}let i=JSON.stringify(n,null,2),s=I.getArtifactUrl(),o=this.uploadHttpManager.getClient(0),a=I.getUploadHeaders("application/json",!1),c=new Map([[Pr.HttpCodes.Forbidden,"Artifact storage quota has been hit. Unable to upload any new artifacts"],[Pr.HttpCodes.BadRequest,`The artifact name ${t} is not valid. Request URL ${s}`]]),l=yield(yield us.retryHttpClientRequest("Create Artifact Container",()=>K(this,void 0,void 0,function*(){return o.post(s,i,a)}),c)).readBody();return JSON.parse(l)})}uploadArtifactToFileContainer(t,r,n){return K(this,void 0,void 0,function*(){let i=Qe.getUploadFileConcurrency(),s=Qe.getUploadChunkSize();q.debug(`File Concurrency: ${i}, and Chunk Size: ${s}`);let o=[],a=!0;n&&n.continueOnError===!1&&(a=!1);for(let g of r){let m=new os.URL(t);m.searchParams.append("itemPath",g.uploadFilePath),o.push({file:g.absoluteFilePath,resourceUrl:m.toString(),maxChunkSize:s,continueOnError:a})}let c=[...new Array(i).keys()],u=[],l=0,h=0,d=0,f=0,p=!1;return this.statusReporter.setTotalNumberOfFilesToProcess(r.length),this.statusReporter.start(),yield Promise.all(c.map(g=>K(this,void 0,void 0,function*(){for(;l<r.length;){let m=o[l];if(l+=1,p){u.push(m.file);continue}let w=as.performance.now(),b=yield this.uploadFileAsync(g,m);q.isDebug()&&q.debug(`File: ${++h}/${r.length}. ${m.file} took ${(as.performance.now()-w).toFixed(3)} milliseconds to finish upload`),d+=b.successfulUploadSize,f+=b.totalSize,b.isSuccess===!1&&(u.push(m.file),a||(q.error("aborting artifact upload"),p=!0)),this.statusReporter.incrementProcessedCount()}}))),this.statusReporter.stop(),this.uploadHttpManager.disposeAndReplaceAllClients(),q.info(`Total size of all the files uploaded is ${d} bytes`),{uploadSize:d,totalSize:f,failedItems:u}})}uploadFileAsync(t,r){return K(this,void 0,void 0,function*(){let n=(yield Su(r.file)).size,i=0,s=!0,o=0,a=0,c=!0;if(n<65536){let u=yield cs.createGZipFileInBuffer(r.file),l;return n<u.byteLength?(l=()=>Dr.createReadStream(r.file),c=!1,a=n):(l=()=>{let d=new mu.PassThrough;return d.end(u),d},a=u.byteLength),(yield this.uploadChunk(t,r.resourceUrl,l,0,a-1,a,c,n))||(s=!1,o+=a,q.warning(`Aborting upload for ${r.file} due to failure`)),{isSuccess:s,successfulUploadSize:a-o,totalSize:n}}else{let u=yield vu.file();a=yield cs.createGZipFileOnDisk(r.file,u.path);let l=u.path;n<a&&(a=n,l=r.file,c=!1);let h=!1;for(;i<a;){let d=Math.min(a-i,r.maxChunkSize);a>104857600&&this.statusReporter.updateLargeFileStatus(r.file,i,a);let f=i,p=i+d-1;if(i+=r.maxChunkSize,h){o+=d;continue}(yield this.uploadChunk(t,r.resourceUrl,()=>Dr.createReadStream(l,{start:f,end:p,autoClose:!1}),f,p,a,c,n))||(s=!1,o+=d,q.warning(`Aborting upload for ${r.file} due to failure`),h=!0)}return yield u.cleanup(),{isSuccess:s,successfulUploadSize:a-o,totalSize:n}}})}uploadChunk(t,r,n,i,s,o,a,c){return K(this,void 0,void 0,function*(){let u=I.getUploadHeaders("application/octet-stream",!0,a,c,s-i+1,I.getContentRange(i,s,o)),l=()=>K(this,void 0,void 0,function*(){return yield this.uploadHttpManager.getClient(t).sendStream("PUT",r,n(),u)}),h=0,d=Qe.getRetryLimit(),f=g=>(h++,h>d?(g&&I.displayHttpDiagnostics(g),q.info(`Retry limit has been reached for chunk at offset ${i} to ${r}`),!0):!1),p=g=>K(this,void 0,void 0,function*(){if(this.uploadHttpManager.disposeAndReplaceClient(t),g)q.info(`Backoff due to too many requests, retry #${h}. Waiting for ${g} milliseconds before continuing the upload`),yield I.sleep(g);else{let m=I.getExponentialRetryTimeInMilliseconds(h);q.info(`Exponential backoff for retry #${h}. Waiting for ${m} milliseconds before continuing the upload at offset ${i}`),yield I.sleep(m)}q.info(`Finished backoff for retry #${h}, continuing with upload`)});for(;h<=d;){let g;try{g=yield l()}catch(m){if(q.info(`An error has been caught http-client index ${t}, retrying the upload`),console.log(m),f())return!1;yield p();continue}if(yield g.readBody(),I.isSuccessStatusCode(g.message.statusCode))return!0;if(I.isRetryableStatusCode(g.message.statusCode)){if(q.info(`A ${g.message.statusCode} status code has been received, will attempt to retry the upload`),f(g))return!1;I.isThrottledStatusCode(g.message.statusCode)?yield p(I.tryGetRetryAfterValueTimeInMilliseconds(g.message.headers)):yield p()}else return q.error(`Unexpected response. Unable to upload chunk to ${r}`),I.displayHttpDiagnostics(g),!1}return!1})}patchArtifactSize(t,r){return K(this,void 0,void 0,function*(){let n=new os.URL(I.getArtifactUrl());n.searchParams.append("artifactName",r);let i={Size:t},s=JSON.stringify(i,null,2);q.debug(`URL is ${n.toString()}`);let o=this.uploadHttpManager.getClient(0),a=I.getUploadHeaders("application/json",!1),c=new Map([[Pr.HttpCodes.NotFound,`An Artifact with the name ${r} was not found`]]);yield(yield us.retryHttpClientRequest("Finalize artifact upload",()=>K(this,void 0,void 0,function*(){return o.patch(n.toString(),s,a)}),c)).readBody(),q.debug(`Artifact ${r} has been successfully uploaded, total size in bytes: ${t}`)})}};Se.UploadHttpClient=ls});var vs=y(be=>{"use strict";var z=be&&be.__awaiter||function(e,t,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(l){try{u(n.next(l))}catch(h){o(h)}}function c(l){try{u(n.throw(l))}catch(h){o(h)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((n=n.apply(e,t||[])).next())})},Fr=be&&be.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(be,"__esModule",{value:!0});var hs=Fr(require("fs")),N=Fr(F()),bu=Fr(require("zlib")),P=ve(),Eu=require("url"),Ru=kr(),ds=require("perf_hooks"),Au=Ir(),Mr=ke(),ps=Nr(),gs=class{constructor(){this.downloadHttpManager=new Au.HttpManager(Mr.getDownloadFileConcurrency(),"@actions/artifact-download"),this.statusReporter=new Ru.StatusReporter(1e3)}listArtifacts(){return z(this,void 0,void 0,function*(){let t=P.getArtifactUrl(),r=this.downloadHttpManager.getClient(0),n=P.getDownloadHeaders("application/json"),s=yield(yield ps.retryHttpClientRequest("List Artifacts",()=>z(this,void 0,void 0,function*(){return r.get(t,n)}))).readBody();return JSON.parse(s)})}getContainerItems(t,r){return z(this,void 0,void 0,function*(){let n=new Eu.URL(r);n.searchParams.append("itemPath",t);let i=this.downloadHttpManager.getClient(0),s=P.getDownloadHeaders("application/json"),a=yield(yield ps.retryHttpClientRequest("Get Container Items",()=>z(this,void 0,void 0,function*(){return i.get(n.toString(),s)}))).readBody();return JSON.parse(a)})}downloadSingleArtifact(t){return z(this,void 0,void 0,function*(){let r=Mr.getDownloadFileConcurrency();N.debug(`Download file concurrency is set to ${r}`);let n=[...new Array(r).keys()],i=0,s=0;N.info(`Total number of files that will be downloaded: ${t.length}`),this.statusReporter.setTotalNumberOfFilesToProcess(t.length),this.statusReporter.start(),yield Promise.all(n.map(o=>z(this,void 0,void 0,function*(){for(;i<t.length;){let a=t[i];i+=1;let c=ds.performance.now();yield this.downloadIndividualFile(o,a.sourceLocation,a.targetPath),N.isDebug()&&N.debug(`File: ${++s}/${t.length}. ${a.targetPath} took ${(ds.performance.now()-c).toFixed(3)} milliseconds to finish downloading`),this.statusReporter.incrementProcessedCount()}}))).catch(o=>{throw new Error(`Unable to download the artifact: ${o}`)}).finally(()=>{this.statusReporter.stop(),this.downloadHttpManager.disposeAndReplaceAllClients()})})}downloadIndividualFile(t,r,n){return z(this,void 0,void 0,function*(){let i=0,s=Mr.getRetryLimit(),o=hs.createWriteStream(n),a=P.getDownloadHeaders("application/json",!0,!0),c=()=>z(this,void 0,void 0,function*(){return yield this.downloadHttpManager.getClient(t).get(r,a)}),u=f=>"content-encoding"in f&&f["content-encoding"]==="gzip",l=f=>z(this,void 0,void 0,function*(){if(i++,i>s)return Promise.reject(new Error(`Retry limit has been reached. Unable to download ${r}`));if(this.downloadHttpManager.disposeAndReplaceClient(t),f)N.info(`Backoff due to too many requests, retry #${i}. Waiting for ${f} milliseconds before continuing the download`),yield P.sleep(f);else{let p=P.getExponentialRetryTimeInMilliseconds(i);N.info(`Exponential backoff for retry #${i}. Waiting for ${p} milliseconds before continuing the download`),yield P.sleep(p)}N.info(`Finished backoff for retry #${i}, continuing with download`)}),h=(f,p)=>!f||!p||process.env.ACTIONS_ARTIFACT_SKIP_DOWNLOAD_VALIDATION?(N.info("Skipping download validation."),!0):parseInt(f)===p,d=f=>z(this,void 0,void 0,function*(){o.close(),yield P.rmFile(f),o=hs.createWriteStream(f)});for(;i<=s;){let f;try{f=yield c(),N.isDebug()&&P.displayHttpDiagnostics(f)}catch(g){N.info("An error occurred while attempting to download a file"),console.log(g),yield l();continue}let p=!1;if(P.isSuccessStatusCode(f.message.statusCode))try{let g=u(f.message.headers);if(yield this.pipeResponseToFile(f,o,g),g||h(f.message.headers["content-length"],yield P.getFileSize(n)))return;p=!0}catch(g){p=!0}if(p||P.isRetryableStatusCode(f.message.statusCode))N.info(`A ${f.message.statusCode} response code has been received while attempting to download an artifact`),d(n),P.isThrottledStatusCode(f.message.statusCode)?yield l(P.tryGetRetryAfterValueTimeInMilliseconds(f.message.headers)):yield l();else return P.displayHttpDiagnostics(f),Promise.reject(new Error(`Unexpected http ${f.message.statusCode} during download for ${r}`))}})}pipeResponseToFile(t,r,n){return z(this,void 0,void 0,function*(){yield new Promise((i,s)=>{if(n){let o=bu.createGunzip();t.message.on("error",a=>{N.error("An error occurred while attempting to read the response stream"),o.close(),r.close(),s(a)}).pipe(o).on("error",a=>{N.error("An error occurred while attempting to decompress the response stream"),r.close(),s(a)}).pipe(r).on("close",()=>{i()}).on("error",a=>{N.error(`An error occurred while writing a downloaded file to ${r.path}`),s(a)})}else t.message.on("error",o=>{N.error("An error occurred while attempting to read the response stream"),r.close(),s(o)}).pipe(r).on("close",()=>{i()}).on("error",o=>{N.error(`An error occurred while writing a downloaded file to ${r.path}`),s(o)})})})}};be.DownloadHttpClient=gs});var ms=y(Ze=>{"use strict";var Ou=Ze&&Ze.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(Ze,"__esModule",{value:!0});var It=Ou(require("path"));function Cu(e,t,r,n){let i=new Set,s={rootDownloadLocation:n?It.join(r,e):r,directoryStructure:[],emptyFilesToCreate:[],filesToDownload:[]};for(let o of t)if(o.path.startsWith(`${e}/`)||o.path.startsWith(`${e}\\`)){let a=It.normalize(o.path),c=It.join(r,n?a:a.replace(e,""));o.itemType==="file"&&(i.add(It.dirname(c)),o.fileLength===0?s.emptyFilesToCreate.push(c):s.filesToDownload.push({sourceLocation:o.contentLocation,targetPath:c}))}return s.directoryStructure=Array.from(i),s}Ze.getDownloadSpecification=Cu});var Ss=y(Ee=>{"use strict";var $r=Ee&&Ee.__awaiter||function(e,t,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(l){try{u(n.next(l))}catch(h){o(h)}}function c(l){try{u(n.throw(l))}catch(h){o(h)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((n=n.apply(e,t||[])).next())})},Tu=Ee&&Ee.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(Ee,"__esModule",{value:!0});var le=Tu(F()),ku=Nn(),qu=fs(),et=ve(),ys=vs(),ws=ms(),_s=ke(),Nt=require("path"),Dt=class{static create(){return new Dt}uploadArtifact(t,r,n,i){return $r(this,void 0,void 0,function*(){et.checkArtifactName(t);let s=ku.getUploadSpecification(t,n,r),o={artifactName:t,artifactItems:[],size:0,failedItems:[]},a=new qu.UploadHttpClient;if(s.length===0)le.warning("No files found that can be uploaded");else{let c=yield a.createArtifactInFileContainer(t,i);if(!c.fileContainerResourceUrl)throw le.debug(c.toString()),new Error("No URL provided by the Artifact Service to upload an artifact to");le.debug(`Upload Resource URL: ${c.fileContainerResourceUrl}`);let u=yield a.uploadArtifactToFileContainer(c.fileContainerResourceUrl,s,i);yield a.patchArtifactSize(u.totalSize,t),le.info(`Finished uploading artifact ${t}. Reported size is ${u.uploadSize} bytes. There were ${u.failedItems.length} items that failed to upload`),o.artifactItems=s.map(l=>l.absoluteFilePath),o.size=u.uploadSize,o.failedItems=u.failedItems}return o})}downloadArtifact(t,r,n){return $r(this,void 0,void 0,function*(){let i=new ys.DownloadHttpClient,s=yield i.listArtifacts();if(s.count===0)throw new Error("Unable to find any artifacts for the associated workflow");let o=s.value.find(u=>u.name===t);if(!o)throw new Error(`Unable to find an artifact with the name: ${t}`);let a=yield i.getContainerItems(o.name,o.fileContainerResourceUrl);r||(r=_s.getWorkSpaceDirectory()),r=Nt.normalize(r),r=Nt.resolve(r);let c=ws.getDownloadSpecification(t,a.value,r,(n==null?void 0:n.createArtifactFolder)||!1);return c.filesToDownload.length===0?le.info(`No downloadable files were found for the artifact: ${o.name}`):(yield et.createDirectoriesForArtifact(c.directoryStructure),le.info("Directory structure has been setup for the artifact"),yield et.createEmptyFilesForArtifact(c.emptyFilesToCreate),yield i.downloadSingleArtifact(c.filesToDownload)),{artifactName:t,downloadPath:c.rootDownloadLocation}})}downloadAllArtifacts(t){return $r(this,void 0,void 0,function*(){let r=new ys.DownloadHttpClient,n=[],i=yield r.listArtifacts();if(i.count===0)return le.info("Unable to find any artifacts for the associated workflow"),n;t||(t=_s.getWorkSpaceDirectory()),t=Nt.normalize(t),t=Nt.resolve(t);let s=0;for(;s<i.count;){let o=i.value[s];s+=1;let a=yield r.getContainerItems(o.name,o.fileContainerResourceUrl),c=ws.getDownloadSpecification(o.name,a.value,t,!0);c.filesToDownload.length===0?le.info(`No downloadable files were found for any artifact ${o.name}`):(yield et.createDirectoriesForArtifact(c.directoryStructure),yield et.createEmptyFilesForArtifact(c.emptyFilesToCreate),yield r.downloadSingleArtifact(c.filesToDownload)),n.push({artifactName:o.name,downloadPath:c.rootDownloadLocation})}return n})}};Ee.DefaultArtifactClient=Dt});var bs=y(Ur=>{"use strict";Object.defineProperty(Ur,"__esModule",{value:!0});var Iu=Ss();function Nu(){return Iu.DefaultArtifactClient.create()}Ur.create=Nu});var Ts=y((Bl,Cs)=>{var Es=require("path"),Du=require("fs"),Pu=bs(),G=F(),{getServices:Fu,isLocalRode:Rs}=at(),As=ut(),Os="rode-dev-env.service.logs",Mu=async({logsDir:e,logPaths:t})=>{if(!process.env.GITHUB_ACTIONS){G.warning("Appear to be running locally, skipping artifact upload");return}G.info(`Uploading logs as ${Os}`),await Pu.create().uploadArtifact(Os,t,e,{continueOnError:!0,retentionDays:7}),G.info("Successfully uploaded logs")},$u=()=>{let e=G.getState("logsDir");if(!e){G.warning("Expected to find logs directory in action state. Skipping log upload");return}G.info("Gathering service logs");let t=Fu(),r=[];for(let n=0;n<t.length;n++){let i=t[n],s=As.logs(i);G.info(`Writing logs for ${i}`);let o=Es.join(e,`${i}.log`);r.push(o),Du.writeFileSync(o,s,"utf-8")}return Rs()&&r.push(Es.join(e,"rode.log")),Mu({logsDir:e,logPaths:r})},Uu=()=>{if(!Rs())return;let e=parseInt(G.getState("localRodePid"),10);if(!e){G.warning("Expected to find a PID in action state");return}G.info(`Stopping local Rode instance (pid: ${e})`),process.kill(e,"SIGTERM")};Cs.exports=async()=>{G.info("Running rode-dev-env post"),Uu(),await $u(),G.info("Stopping services"),As.down()}});var ks=require("fs"),ju=require("path"),fe=F(),Lu=ut(),xu=An(),Gu=Ts(),qs="rode-dev-env",jr="v0.1.3",Is=`/home/runner/work/_actions/rode/${qs}`,Bu=()=>{if(!process.env.GITHUB_ACTIONS){fe.info("Appear to be running locally");return}if(ju.basename(process.cwd())===qs&&ks.existsSync("./docker-compose.yaml")){fe.info("Running in CI and in the rode-dev-env repository");return}if(!jr)throw new Error("Unable to determine action version");fe.info(`Appear to be running GitHub Actions with version ${jr}`);let t=`${Is}/${jr}/docker-compose.yaml`;if(fe.info(`Checking if docker compose config is at this path: ${t}`),!ks.existsSync(t))throw new Error(`Expected to find action repository at ${Is}, but wasn't present`);fe.info("Found docker compose config"),Lu.configure(t)},Hu=()=>{let e=fe.getState("post");return e||fe.saveState("post",!0),e};(async()=>{try{Bu(),await(Hu()?Gu:xu)()}catch(e){fe.setFailed(`Error running rode-dev-env: ${e.stack}`),process.exit(1)}})();
/*!
 * Tmp
 *
 * Copyright (c) 2011-2017 KARASZI Istvan <github@spam.raszi.hu>
 *
 * MIT Licensed
 */
