var Ds=Object.defineProperty,Ps=Object.defineProperties;var Fs=Object.getOwnPropertyDescriptors;var Br=Object.getOwnPropertySymbols;var Ms=Object.prototype.hasOwnProperty,$s=Object.prototype.propertyIsEnumerable;var Hr=(e,t,r)=>t in e?Ds(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,he=(e,t)=>{for(var r in t||(t={}))Ms.call(t,r)&&Hr(e,r,t[r]);if(Br)for(var r of Br(t))$s.call(t,r)&&Hr(e,r,t[r]);return e},nt=(e,t)=>Ps(e,Fs(t));var xu=typeof require!="undefined"?require:e=>{throw new Error('Dynamic require of "'+e+'" is not supported')};var y=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var it=y(Re=>{"use strict";Object.defineProperty(Re,"__esModule",{value:!0});Re.toCommandProperties=Re.toCommandValue=void 0;function Us(e){return e==null?"":typeof e=="string"||e instanceof String?e:JSON.stringify(e)}Re.toCommandValue=Us;function js(e){return Object.keys(e).length?{title:e.title,line:e.startLine,endLine:e.endLine,col:e.startColumn,endColumn:e.endColumn}:{}}Re.toCommandProperties=js});var Kr=y(j=>{"use strict";var Ls=j&&j.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),xs=j&&j.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Gs=j&&j.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.hasOwnProperty.call(e,r)&&Ls(t,e,r);return xs(t,e),t};Object.defineProperty(j,"__esModule",{value:!0});j.issue=j.issueCommand=void 0;var Bs=Gs(require("os")),zr=it();function Wr(e,t,r){let n=new Jr(e,t,r);process.stdout.write(n.toString()+Bs.EOL)}j.issueCommand=Wr;function Hs(e,t=""){Wr(e,{},t)}j.issue=Hs;var Vr="::",Jr=class{constructor(t,r,n){t||(t="missing.command"),this.command=t,this.properties=r,this.message=n}toString(){let t=Vr+this.command;if(this.properties&&Object.keys(this.properties).length>0){t+=" ";let r=!0;for(let n in this.properties)if(this.properties.hasOwnProperty(n)){let i=this.properties[n];i&&(r?r=!1:t+=",",t+=`${n}=${Ws(i)}`)}}return t+=`${Vr}${zs(this.message)}`,t}};function zs(e){return zr.toCommandValue(e).replace(/%/g,"%25").replace(/\r/g,"%0D").replace(/\n/g,"%0A")}function Ws(e){return zr.toCommandValue(e).replace(/%/g,"%25").replace(/\r/g,"%0D").replace(/\n/g,"%0A").replace(/:/g,"%3A").replace(/,/g,"%2C")}});var Zr=y(W=>{"use strict";var Vs=W&&W.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),Js=W&&W.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Xr=W&&W.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.hasOwnProperty.call(e,r)&&Vs(t,e,r);return Js(t,e),t};Object.defineProperty(W,"__esModule",{value:!0});W.issueCommand=void 0;var Yr=Xr(require("fs")),Ks=Xr(require("os")),Xs=it();function Ys(e,t){let r=process.env[`GITHUB_${e}`];if(!r)throw new Error(`Unable to find environment variable for file command ${e}`);if(!Yr.existsSync(r))throw new Error(`Missing file at path: ${r}`);Yr.appendFileSync(r,`${Xs.toCommandValue(t)}${Ks.EOL}`,{encoding:"utf8"})}W.issueCommand=Ys});var F=y(v=>{"use strict";var Zs=v&&v.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),Qs=v&&v.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Qr=v&&v.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.hasOwnProperty.call(e,r)&&Zs(t,e,r);return Qs(t,e),t},eo=v&&v.__awaiter||function(e,t,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(l){try{u(n.next(l))}catch(h){o(h)}}function c(l){try{u(n.throw(l))}catch(h){o(h)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((n=n.apply(e,t||[])).next())})};Object.defineProperty(v,"__esModule",{value:!0});v.getState=v.saveState=v.group=v.endGroup=v.startGroup=v.info=v.notice=v.warning=v.error=v.debug=v.isDebug=v.setFailed=v.setCommandEcho=v.setOutput=v.getBooleanInput=v.getMultilineInput=v.getInput=v.addPath=v.setSecret=v.exportVariable=v.ExitCode=void 0;var L=Kr(),en=Zr(),st=it(),ot=Qr(require("os")),to=Qr(require("path")),tn;(function(e){e[e.Success=0]="Success",e[e.Failure=1]="Failure"})(tn=v.ExitCode||(v.ExitCode={}));function ro(e,t){let r=st.toCommandValue(t);if(process.env[e]=r,process.env.GITHUB_ENV||""){let i="_GitHubActionsFileCommandDelimeter_",s=`${e}<<${i}${ot.EOL}${r}${ot.EOL}${i}`;en.issueCommand("ENV",s)}else L.issueCommand("set-env",{name:e},r)}v.exportVariable=ro;function no(e){L.issueCommand("add-mask",{},e)}v.setSecret=no;function io(e){process.env.GITHUB_PATH||""?en.issueCommand("PATH",e):L.issueCommand("add-path",{},e),process.env.PATH=`${e}${to.delimiter}${process.env.PATH}`}v.addPath=io;function $t(e,t){let r=process.env[`INPUT_${e.replace(/ /g,"_").toUpperCase()}`]||"";if(t&&t.required&&!r)throw new Error(`Input required and not supplied: ${e}`);return t&&t.trimWhitespace===!1?r:r.trim()}v.getInput=$t;function so(e,t){return $t(e,t).split(`
`).filter(n=>n!=="")}v.getMultilineInput=so;function oo(e,t){let r=["true","True","TRUE"],n=["false","False","FALSE"],i=$t(e,t);if(r.includes(i))return!0;if(n.includes(i))return!1;throw new TypeError(`Input does not meet YAML 1.2 "Core Schema" specification: ${e}
Support boolean input list: \`true | True | TRUE | false | False | FALSE\``)}v.getBooleanInput=oo;function ao(e,t){process.stdout.write(ot.EOL),L.issueCommand("set-output",{name:e},t)}v.setOutput=ao;function co(e){L.issue("echo",e?"on":"off")}v.setCommandEcho=co;function uo(e){process.exitCode=tn.Failure,rn(e)}v.setFailed=uo;function lo(){return process.env.RUNNER_DEBUG==="1"}v.isDebug=lo;function fo(e){L.issueCommand("debug",{},e)}v.debug=fo;function rn(e,t={}){L.issueCommand("error",st.toCommandProperties(t),e instanceof Error?e.toString():e)}v.error=rn;function ho(e,t={}){L.issueCommand("warning",st.toCommandProperties(t),e instanceof Error?e.toString():e)}v.warning=ho;function po(e,t={}){L.issueCommand("notice",st.toCommandProperties(t),e instanceof Error?e.toString():e)}v.notice=po;function go(e){process.stdout.write(e+ot.EOL)}v.info=go;function nn(e){L.issue("group",e)}v.startGroup=nn;function sn(){L.issue("endgroup")}v.endGroup=sn;function vo(e,t){return eo(this,void 0,void 0,function*(){nn(e);let r;try{r=yield t()}finally{sn()}return r})}v.group=vo;function mo(e,t){L.issueCommand("save-state",{name:e},t)}v.saveState=mo;function yo(e){return process.env[`STATE_${e}`]||""}v.getState=yo});var ct=y((Vu,an)=>{var de=F(),{execFileSync:wo}=require("child_process"),Ut,_o=e=>{Ut=e},So=e=>at({cmd:"up",args:["--detach",...e],extraEnv:on()}),bo=()=>at({cmd:"down",extraEnv:on()}),Eo=()=>at({cmd:"ps"}),Ao=e=>at({cmd:"logs",log:!1,args:["--no-color","--no-log-prefix",e]}),on=()=>({RODE_VERSION:`v${de.getInput("rodeVersion")}`,ELASTICSEARCH_VERSION:de.getInput("elasticsearchVersion"),GRAFEAS_VERSION:`v${de.getInput("grafeasVersion")}`,OPA_VERSION:de.getInput("opaVersion")}),at=({cmd:e,args:t=[],extraEnv:r,log:n=!0})=>{let i={shell:!1},s=[];Ut&&s.push("-f",Ut),s.push(e,...t),r&&(i.env=he(he({},process.env),r));try{let o=wo("docker-compose",s,i);return n&&(de.startGroup(`docker-compose ${e}`),de.info(o)),o}finally{n&&de.endGroup()}};an.exports={configure:_o,up:So,down:bo,ps:Eo,logs:Ao}});var un=y(ut=>{"use strict";Object.defineProperty(ut,"__esModule",{value:!0});function Ro(e){let t=e.protocol==="https:",r;if(cn(e))return r;let n;return t?n=process.env.https_proxy||process.env.HTTPS_PROXY:n=process.env.http_proxy||process.env.HTTP_PROXY,n&&(r=new URL(n)),r}ut.getProxyUrl=Ro;function cn(e){if(!e.hostname)return!1;let t=process.env.no_proxy||process.env.NO_PROXY||"";if(!t)return!1;let r;e.port?r=Number(e.port):e.protocol==="http:"?r=80:e.protocol==="https:"&&(r=443);let n=[e.hostname.toUpperCase()];typeof r=="number"&&n.push(`${n[0]}:${r}`);for(let i of t.split(",").map(s=>s.trim().toUpperCase()).filter(s=>s))if(n.some(s=>s===i))return!0;return!1}ut.checkBypass=cn});var dn=y(Oe=>{"use strict";var Ku=require("net"),Oo=require("tls"),jt=require("http"),ln=require("https"),Co=require("events"),Xu=require("assert"),To=require("util");Oe.httpOverHttp=ko;Oe.httpsOverHttp=qo;Oe.httpOverHttps=Io;Oe.httpsOverHttps=No;function ko(e){var t=new Y(e);return t.request=jt.request,t}function qo(e){var t=new Y(e);return t.request=jt.request,t.createSocket=fn,t.defaultPort=443,t}function Io(e){var t=new Y(e);return t.request=ln.request,t}function No(e){var t=new Y(e);return t.request=ln.request,t.createSocket=fn,t.defaultPort=443,t}function Y(e){var t=this;t.options=e||{},t.proxyOptions=t.options.proxy||{},t.maxSockets=t.options.maxSockets||jt.Agent.defaultMaxSockets,t.requests=[],t.sockets=[],t.on("free",function(n,i,s,o){for(var a=hn(i,s,o),c=0,u=t.requests.length;c<u;++c){var l=t.requests[c];if(l.host===a.host&&l.port===a.port){t.requests.splice(c,1),l.request.onSocket(n);return}}n.destroy(),t.removeSocket(n)})}To.inherits(Y,Co.EventEmitter);Y.prototype.addRequest=function(t,r,n,i){var s=this,o=Lt({request:t},s.options,hn(r,n,i));if(s.sockets.length>=this.maxSockets){s.requests.push(o);return}s.createSocket(o,function(a){a.on("free",c),a.on("close",u),a.on("agentRemove",u),t.onSocket(a);function c(){s.emit("free",a,o)}function u(l){s.removeSocket(a),a.removeListener("free",c),a.removeListener("close",u),a.removeListener("agentRemove",u)}})};Y.prototype.createSocket=function(t,r){var n=this,i={};n.sockets.push(i);var s=Lt({},n.proxyOptions,{method:"CONNECT",path:t.host+":"+t.port,agent:!1,headers:{host:t.host+":"+t.port}});t.localAddress&&(s.localAddress=t.localAddress),s.proxyAuth&&(s.headers=s.headers||{},s.headers["Proxy-Authorization"]="Basic "+new Buffer(s.proxyAuth).toString("base64")),ee("making CONNECT request");var o=n.request(s);o.useChunkedEncodingByDefault=!1,o.once("response",a),o.once("upgrade",c),o.once("connect",u),o.once("error",l),o.end();function a(h){h.upgrade=!0}function c(h,d,f){process.nextTick(function(){u(h,d,f)})}function u(h,d,f){if(o.removeAllListeners(),d.removeAllListeners(),h.statusCode!==200){ee("tunneling socket could not be established, statusCode=%d",h.statusCode),d.destroy();var p=new Error("tunneling socket could not be established, statusCode="+h.statusCode);p.code="ECONNRESET",t.request.emit("error",p),n.removeSocket(i);return}if(f.length>0){ee("got illegal response body from proxy"),d.destroy();var p=new Error("got illegal response body from proxy");p.code="ECONNRESET",t.request.emit("error",p),n.removeSocket(i);return}return ee("tunneling connection has established"),n.sockets[n.sockets.indexOf(i)]=d,r(d)}function l(h){o.removeAllListeners(),ee(`tunneling socket could not be established, cause=%s
`,h.message,h.stack);var d=new Error("tunneling socket could not be established, cause="+h.message);d.code="ECONNRESET",t.request.emit("error",d),n.removeSocket(i)}};Y.prototype.removeSocket=function(t){var r=this.sockets.indexOf(t);if(r!==-1){this.sockets.splice(r,1);var n=this.requests.shift();n&&this.createSocket(n,function(i){n.request.onSocket(i)})}};function fn(e,t){var r=this;Y.prototype.createSocket.call(r,e,function(n){var i=e.request.getHeader("host"),s=Lt({},r.options,{socket:n,servername:i?i.replace(/:.*$/,""):e.host}),o=Oo.connect(0,s);r.sockets[r.sockets.indexOf(n)]=o,t(o)})}function hn(e,t,r){return typeof e=="string"?{host:e,port:t,localAddress:r}:e}function Lt(e){for(var t=1,r=arguments.length;t<r;++t){var n=arguments[t];if(typeof n=="object")for(var i=Object.keys(n),s=0,o=i.length;s<o;++s){var a=i[s];n[a]!==void 0&&(e[a]=n[a])}}return e}var ee;process.env.NODE_DEBUG&&/\btunnel\b/.test(process.env.NODE_DEBUG)?ee=function(){var e=Array.prototype.slice.call(arguments);typeof e[0]=="string"?e[0]="TUNNEL: "+e[0]:e.unshift("TUNNEL:"),console.error.apply(console,e)}:ee=function(){};Oe.debug=ee});var gn=y((Zu,pn)=>{pn.exports=dn()});var ht=y(M=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0});var lt=require("http"),xt=require("https"),vn=un(),Ce,H;(function(e){e[e.OK=200]="OK",e[e.MultipleChoices=300]="MultipleChoices",e[e.MovedPermanently=301]="MovedPermanently",e[e.ResourceMoved=302]="ResourceMoved",e[e.SeeOther=303]="SeeOther",e[e.NotModified=304]="NotModified",e[e.UseProxy=305]="UseProxy",e[e.SwitchProxy=306]="SwitchProxy",e[e.TemporaryRedirect=307]="TemporaryRedirect",e[e.PermanentRedirect=308]="PermanentRedirect",e[e.BadRequest=400]="BadRequest",e[e.Unauthorized=401]="Unauthorized",e[e.PaymentRequired=402]="PaymentRequired",e[e.Forbidden=403]="Forbidden",e[e.NotFound=404]="NotFound",e[e.MethodNotAllowed=405]="MethodNotAllowed",e[e.NotAcceptable=406]="NotAcceptable",e[e.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",e[e.RequestTimeout=408]="RequestTimeout",e[e.Conflict=409]="Conflict",e[e.Gone=410]="Gone",e[e.TooManyRequests=429]="TooManyRequests",e[e.InternalServerError=500]="InternalServerError",e[e.NotImplemented=501]="NotImplemented",e[e.BadGateway=502]="BadGateway",e[e.ServiceUnavailable=503]="ServiceUnavailable",e[e.GatewayTimeout=504]="GatewayTimeout"})(H=M.HttpCodes||(M.HttpCodes={}));var N;(function(e){e.Accept="accept",e.ContentType="content-type"})(N=M.Headers||(M.Headers={}));var te;(function(e){e.ApplicationJson="application/json"})(te=M.MediaTypes||(M.MediaTypes={}));function Do(e){let t=vn.getProxyUrl(new URL(e));return t?t.href:""}M.getProxyUrl=Do;var Po=[H.MovedPermanently,H.ResourceMoved,H.SeeOther,H.TemporaryRedirect,H.PermanentRedirect],Fo=[H.BadGateway,H.ServiceUnavailable,H.GatewayTimeout],Mo=["OPTIONS","GET","DELETE","HEAD"],$o=10,Uo=5,Ue=class extends Error{constructor(t,r){super(t);this.name="HttpClientError",this.statusCode=r,Object.setPrototypeOf(this,Ue.prototype)}};M.HttpClientError=Ue;var Gt=class{constructor(t){this.message=t}readBody(){return new Promise(async(t,r)=>{let n=Buffer.alloc(0);this.message.on("data",i=>{n=Buffer.concat([n,i])}),this.message.on("end",()=>{t(n.toString())})})}};M.HttpClientResponse=Gt;function jo(e){return new URL(e).protocol==="https:"}M.isHttps=jo;var ft=class{constructor(t,r,n){this._ignoreSslError=!1,this._allowRedirects=!0,this._allowRedirectDowngrade=!1,this._maxRedirects=50,this._allowRetries=!1,this._maxRetries=1,this._keepAlive=!1,this._disposed=!1,this.userAgent=t,this.handlers=r||[],this.requestOptions=n,n&&(n.ignoreSslError!=null&&(this._ignoreSslError=n.ignoreSslError),this._socketTimeout=n.socketTimeout,n.allowRedirects!=null&&(this._allowRedirects=n.allowRedirects),n.allowRedirectDowngrade!=null&&(this._allowRedirectDowngrade=n.allowRedirectDowngrade),n.maxRedirects!=null&&(this._maxRedirects=Math.max(n.maxRedirects,0)),n.keepAlive!=null&&(this._keepAlive=n.keepAlive),n.allowRetries!=null&&(this._allowRetries=n.allowRetries),n.maxRetries!=null&&(this._maxRetries=n.maxRetries))}options(t,r){return this.request("OPTIONS",t,null,r||{})}get(t,r){return this.request("GET",t,null,r||{})}del(t,r){return this.request("DELETE",t,null,r||{})}post(t,r,n){return this.request("POST",t,r,n||{})}patch(t,r,n){return this.request("PATCH",t,r,n||{})}put(t,r,n){return this.request("PUT",t,r,n||{})}head(t,r){return this.request("HEAD",t,null,r||{})}sendStream(t,r,n,i){return this.request(t,r,n,i)}async getJson(t,r={}){r[N.Accept]=this._getExistingOrDefaultHeader(r,N.Accept,te.ApplicationJson);let n=await this.get(t,r);return this._processResponse(n,this.requestOptions)}async postJson(t,r,n={}){let i=JSON.stringify(r,null,2);n[N.Accept]=this._getExistingOrDefaultHeader(n,N.Accept,te.ApplicationJson),n[N.ContentType]=this._getExistingOrDefaultHeader(n,N.ContentType,te.ApplicationJson);let s=await this.post(t,i,n);return this._processResponse(s,this.requestOptions)}async putJson(t,r,n={}){let i=JSON.stringify(r,null,2);n[N.Accept]=this._getExistingOrDefaultHeader(n,N.Accept,te.ApplicationJson),n[N.ContentType]=this._getExistingOrDefaultHeader(n,N.ContentType,te.ApplicationJson);let s=await this.put(t,i,n);return this._processResponse(s,this.requestOptions)}async patchJson(t,r,n={}){let i=JSON.stringify(r,null,2);n[N.Accept]=this._getExistingOrDefaultHeader(n,N.Accept,te.ApplicationJson),n[N.ContentType]=this._getExistingOrDefaultHeader(n,N.ContentType,te.ApplicationJson);let s=await this.patch(t,i,n);return this._processResponse(s,this.requestOptions)}async request(t,r,n,i){if(this._disposed)throw new Error("Client has already been disposed.");let s=new URL(r),o=this._prepareRequest(t,s,i),a=this._allowRetries&&Mo.indexOf(t)!=-1?this._maxRetries+1:1,c=0,u;for(;c<a;){if(u=await this.requestRaw(o,n),u&&u.message&&u.message.statusCode===H.Unauthorized){let h;for(let d=0;d<this.handlers.length;d++)if(this.handlers[d].canHandleAuthentication(u)){h=this.handlers[d];break}return h?h.handleAuthentication(this,o,n):u}let l=this._maxRedirects;for(;Po.indexOf(u.message.statusCode)!=-1&&this._allowRedirects&&l>0;){let h=u.message.headers.location;if(!h)break;let d=new URL(h);if(s.protocol=="https:"&&s.protocol!=d.protocol&&!this._allowRedirectDowngrade)throw new Error("Redirect from HTTPS to HTTP protocol. This downgrade is not allowed for security reasons. If you want to allow this behavior, set the allowRedirectDowngrade option to true.");if(await u.readBody(),d.hostname!==s.hostname)for(let f in i)f.toLowerCase()==="authorization"&&delete i[f];o=this._prepareRequest(t,d,i),u=await this.requestRaw(o,n),l--}if(Fo.indexOf(u.message.statusCode)==-1)return u;c+=1,c<a&&(await u.readBody(),await this._performExponentialBackoff(c))}return u}dispose(){this._agent&&this._agent.destroy(),this._disposed=!0}requestRaw(t,r){return new Promise((n,i)=>{let s=function(o,a){o&&i(o),n(a)};this.requestRawWithCallback(t,r,s)})}requestRawWithCallback(t,r,n){let i;typeof r=="string"&&(t.options.headers["Content-Length"]=Buffer.byteLength(r,"utf8"));let s=!1,o=(c,u)=>{s||(s=!0,n(c,u))},a=t.httpModule.request(t.options,c=>{let u=new Gt(c);o(null,u)});a.on("socket",c=>{i=c}),a.setTimeout(this._socketTimeout||3*6e4,()=>{i&&i.end(),o(new Error("Request timeout: "+t.options.path),null)}),a.on("error",function(c){o(c,null)}),r&&typeof r=="string"&&a.write(r,"utf8"),r&&typeof r!="string"?(r.on("close",function(){a.end()}),r.pipe(a)):a.end()}getAgent(t){let r=new URL(t);return this._getAgent(r)}_prepareRequest(t,r,n){let i={};i.parsedUrl=r;let s=i.parsedUrl.protocol==="https:";i.httpModule=s?xt:lt;let o=s?443:80;return i.options={},i.options.host=i.parsedUrl.hostname,i.options.port=i.parsedUrl.port?parseInt(i.parsedUrl.port):o,i.options.path=(i.parsedUrl.pathname||"")+(i.parsedUrl.search||""),i.options.method=t,i.options.headers=this._mergeHeaders(n),this.userAgent!=null&&(i.options.headers["user-agent"]=this.userAgent),i.options.agent=this._getAgent(i.parsedUrl),this.handlers&&this.handlers.forEach(a=>{a.prepareRequest(i.options)}),i}_mergeHeaders(t){let r=n=>Object.keys(n).reduce((i,s)=>(i[s.toLowerCase()]=n[s],i),{});return this.requestOptions&&this.requestOptions.headers?Object.assign({},r(this.requestOptions.headers),r(t)):r(t||{})}_getExistingOrDefaultHeader(t,r,n){let i=o=>Object.keys(o).reduce((a,c)=>(a[c.toLowerCase()]=o[c],a),{}),s;return this.requestOptions&&this.requestOptions.headers&&(s=i(this.requestOptions.headers)[r]),t[r]||s||n}_getAgent(t){let r,n=vn.getProxyUrl(t),i=n&&n.hostname;if(this._keepAlive&&i&&(r=this._proxyAgent),this._keepAlive&&!i&&(r=this._agent),r)return r;let s=t.protocol==="https:",o=100;if(this.requestOptions&&(o=this.requestOptions.maxSockets||lt.globalAgent.maxSockets),i){Ce||(Ce=gn());let a={maxSockets:o,keepAlive:this._keepAlive,proxy:nt(he({},(n.username||n.password)&&{proxyAuth:`${n.username}:${n.password}`}),{host:n.hostname,port:n.port})},c,u=n.protocol==="https:";s?c=u?Ce.httpsOverHttps:Ce.httpsOverHttp:c=u?Ce.httpOverHttps:Ce.httpOverHttp,r=c(a),this._proxyAgent=r}if(this._keepAlive&&!r){let a={keepAlive:this._keepAlive,maxSockets:o};r=s?new xt.Agent(a):new lt.Agent(a),this._agent=r}return r||(r=s?xt.globalAgent:lt.globalAgent),s&&this._ignoreSslError&&(r.options=Object.assign(r.options||{},{rejectUnauthorized:!1})),r}_performExponentialBackoff(t){t=Math.min($o,t);let r=Uo*Math.pow(2,t);return new Promise(n=>setTimeout(()=>n(),r))}static dateTimeDeserializer(t,r){if(typeof r=="string"){let n=new Date(r);if(!isNaN(n.valueOf()))return n}return r}async _processResponse(t,r){return new Promise(async(n,i)=>{let s=t.message.statusCode,o={statusCode:s,result:null,headers:{}};s==H.NotFound&&n(o);let a,c;try{c=await t.readBody(),c&&c.length>0&&(r&&r.deserializeDates?a=JSON.parse(c,ft.dateTimeDeserializer):a=JSON.parse(c),o.result=a),o.headers=t.message.headers}catch(u){}if(s>299){let u;a&&a.message?u=a.message:c&&c.length>0?u=c:u="Failed request: ("+s+")";let l=new Ue(u,s);l.result=o.result,i(l)}else n(o)})}};M.HttpClient=ft});var Bt=y((el,yn)=>{var Lo=F(),xo=["grafeas","elasticsearch","opa"],Go=()=>{let e=[...xo];return mn()||e.push("rode"),e},mn=()=>Lo.getInput("rodeVersion")==="local";yn.exports={getServices:Go,isLocalRode:mn}});var En=y((tl,bn)=>{var wn=require("fs"),Ht=require("path"),Bo=require("os"),Ho=ht(),{spawn:zo}=require("child_process"),D=F(),_n=ct(),{getServices:Wo,isLocalRode:Vo}=Bt(),Sn=5,Jo=5e3,je={rodeHost:"localhost:50051",opaUrl:"http://localhost:8181",elasticsearchUrl:"http://localhost:9200",grafeasHost:"localhost:8080"},Ko=()=>{Object.entries(je).forEach(([e,t])=>{D.setOutput(e,t)})},Xo=async e=>{if(!Vo())return Promise.resolve();D.info("Starting local Rode");let t=Ht.join(e,"rode.log"),r=wn.createWriteStream(t,{flags:"a"});return new Promise(n=>{r.once("open",()=>{let i=process.env.GITHUB_WORKSPACE||".";D.info(`Spawning Rode process, sending logs to ${t}`);let s=zo(Ht.join(i,"rode"),{detached:!0,cwd:i,env:nt(he({},process.env),{GRAFEAS_HOST:je.grafeasHost,ELASTICSEARCH_HOST:je.elasticsearchUrl,OPA_HOST:je.opaUrl}),stdio:["ignore",r,r]});D.saveState("localRodePid",s.pid),D.info(`Spawned rode with pid ${s.pid}`),s.unref(),n()})})},Yo=e=>new Promise(t=>setTimeout(t,e)),Zo=async()=>{let e=new Ho.HttpClient;D.info("Waiting for Rode to start");for(let t=0;t<Sn;t++){try{if(D.info("Checking if Rode is ready..."),(await e.get(`http://${je.rodeHost}/v1alpha1/policy-groups`)).message.statusCode===200){D.info("Rode has started");return}}catch(r){D.info(`Error waiting for Rode to start (attempt ${t+1}/${Sn}): ${r.stack}`)}await Yo(Jo)}throw new Error("Timed out waiting for Rode to start")},Qo=()=>{D.info("Creating logs directory");let e=wn.mkdtempSync(Ht.join(Bo.tmpdir(),"rode-dev-env-services-"));return D.info(`Logs will be sent to ${e}`),D.saveState("logsDir",e),e};bn.exports=async()=>{D.info("Running rode-dev-env main");let e=Qo(),t=Wo();D.info("Starting services"),_n.up(t),_n.ps(),await Xo(e),await Zo(),D.info("Setting outputs"),Ko()}});var Cn=y(Le=>{"use strict";Object.defineProperty(Le,"__esModule",{value:!0});var An=class{constructor(t,r){this.username=t,this.password=r}prepareRequest(t){t.headers.Authorization="Basic "+Buffer.from(this.username+":"+this.password).toString("base64")}canHandleAuthentication(t){return!1}handleAuthentication(t,r,n){return null}};Le.BasicCredentialHandler=An;var Rn=class{constructor(t){this.token=t}prepareRequest(t){t.headers.Authorization="Bearer "+this.token}canHandleAuthentication(t){return!1}handleAuthentication(t,r,n){return null}};Le.BearerCredentialHandler=Rn;var On=class{constructor(t){this.token=t}prepareRequest(t){t.headers.Authorization="Basic "+Buffer.from("PAT:"+this.token).toString("base64")}canHandleAuthentication(t){return!1}handleAuthentication(t,r,n){return null}};Le.PersonalAccessTokenCredentialHandler=On});var Te=y($=>{"use strict";Object.defineProperty($,"__esModule",{value:!0});function ea(){return 2}$.getUploadFileConcurrency=ea;function ta(){return 8*1024*1024}$.getUploadChunkSize=ta;function ra(){return 5}$.getRetryLimit=ra;function na(){return 1.5}$.getRetryMultiplier=na;function ia(){return 3e3}$.getInitialRetryIntervalInMilliseconds=ia;function sa(){return 2}$.getDownloadFileConcurrency=sa;function oa(){let e=process.env.ACTIONS_RUNTIME_TOKEN;if(!e)throw new Error("Unable to get ACTIONS_RUNTIME_TOKEN env variable");return e}$.getRuntimeToken=oa;function aa(){let e=process.env.ACTIONS_RUNTIME_URL;if(!e)throw new Error("Unable to get ACTIONS_RUNTIME_URL env variable");return e}$.getRuntimeUrl=aa;function ca(){let e=process.env.GITHUB_RUN_ID;if(!e)throw new Error("Unable to get GITHUB_RUN_ID env variable");return e}$.getWorkFlowRunId=ca;function ua(){let e=process.env.GITHUB_WORKSPACE;if(!e)throw new Error("Unable to get GITHUB_WORKSPACE env variable");return e}$.getWorkSpaceDirectory=ua;function la(){return process.env.GITHUB_RETENTION_DAYS}$.getRetentionDays=la});var ve=y(E=>{"use strict";var xe=E&&E.__awaiter||function(e,t,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(l){try{u(n.next(l))}catch(h){o(h)}}function c(l){try{u(n.throw(l))}catch(h){o(h)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((n=n.apply(e,t||[])).next())})};Object.defineProperty(E,"__esModule",{value:!0});var pe=F(),dt=require("fs"),re=ht(),fa=Cn(),ge=Te();function ha(e){if(e<0)throw new Error("RetryCount should not be negative");if(e===0)return ge.getInitialRetryIntervalInMilliseconds();let t=ge.getInitialRetryIntervalInMilliseconds()*ge.getRetryMultiplier()*e,r=t*ge.getRetryMultiplier();return Math.random()*(r-t)+t}E.getExponentialRetryTimeInMilliseconds=ha;function da(e){let t=Number(process.env[e]);if(!(Number.isNaN(t)||t<0))return t}E.parseEnvNumber=da;function Ge(){return"6.0-preview"}E.getApiVersion=Ge;function pa(e){return e?e>=200&&e<300:!1}E.isSuccessStatusCode=pa;function ga(e){return e?e===re.HttpCodes.Forbidden:!1}E.isForbiddenStatusCode=ga;function va(e){return e?[re.HttpCodes.BadGateway,re.HttpCodes.GatewayTimeout,re.HttpCodes.InternalServerError,re.HttpCodes.ServiceUnavailable,re.HttpCodes.TooManyRequests,413].includes(e):!1}E.isRetryableStatusCode=va;function ma(e){return e?e===re.HttpCodes.TooManyRequests:!1}E.isThrottledStatusCode=ma;function ya(e){if(e["retry-after"]){let t=Number(e["retry-after"]);if(!isNaN(t))return pe.info(`Retry-After header is present with a value of ${t}`),t*1e3;pe.info(`Returned retry-after header value: ${t} is non-numeric and cannot be used`);return}pe.info("No retry-after header was found. Dumping all headers for diagnostic purposes"),console.log(e)}E.tryGetRetryAfterValueTimeInMilliseconds=ya;function wa(e,t,r){return`bytes ${e}-${t}/${r}`}E.getContentRange=wa;function _a(e,t,r){let n={};return e&&(n["Content-Type"]=e),t&&(n.Connection="Keep-Alive",n["Keep-Alive"]="10"),r?(n["Accept-Encoding"]="gzip",n.Accept=`application/octet-stream;api-version=${Ge()}`):n.Accept=`application/json;api-version=${Ge()}`,n}E.getDownloadHeaders=_a;function Sa(e,t,r,n,i,s){let o={};return o.Accept=`application/json;api-version=${Ge()}`,e&&(o["Content-Type"]=e),t&&(o.Connection="Keep-Alive",o["Keep-Alive"]="10"),r&&(o["Content-Encoding"]="gzip",o["x-tfs-filelength"]=n),i&&(o["Content-Length"]=i),s&&(o["Content-Range"]=s),o}E.getUploadHeaders=Sa;function ba(e){return new re.HttpClient(e,[new fa.BearerCredentialHandler(ge.getRuntimeToken())])}E.createHttpClient=ba;function Ea(){let e=`${ge.getRuntimeUrl()}_apis/pipelines/workflows/${ge.getWorkFlowRunId()}/artifacts?api-version=${Ge()}`;return pe.debug(`Artifact Url: ${e}`),e}E.getArtifactUrl=Ea;function Aa(e){pe.info(`##### Begin Diagnostic HTTP information #####
Status Code: ${e.message.statusCode}
Status Message: ${e.message.statusMessage}
Header Information: ${JSON.stringify(e.message.headers,void 0,2)}
###### End Diagnostic HTTP information ######`)}E.displayHttpDiagnostics=Aa;var zt=['"',":","<",">","|","*","?"],Tn=[...zt,"\\","/"];function Ra(e){if(!e)throw new Error(`Artifact name: ${e}, is incorrectly provided`);for(let t of Tn)if(e.includes(t))throw new Error(`Artifact name is not valid: ${e}. Contains character: "${t}". Invalid artifact name characters include: ${Tn.toString()}.`)}E.checkArtifactName=Ra;function Oa(e){if(!e)throw new Error(`Artifact path: ${e}, is incorrectly provided`);for(let t of zt)if(e.includes(t))throw new Error(`Artifact path is not valid: ${e}. Contains character: "${t}". Invalid characters include: ${zt.toString()}.`)}E.checkArtifactFilePath=Oa;function Ca(e){return xe(this,void 0,void 0,function*(){for(let t of e)yield dt.promises.mkdir(t,{recursive:!0})})}E.createDirectoriesForArtifact=Ca;function Ta(e){return xe(this,void 0,void 0,function*(){for(let t of e)yield(yield dt.promises.open(t,"w")).close()})}E.createEmptyFilesForArtifact=Ta;function ka(e){return xe(this,void 0,void 0,function*(){let t=yield dt.promises.stat(e);return pe.debug(`${e} size:(${t.size}) blksize:(${t.blksize}) blocks:(${t.blocks})`),t.size})}E.getFileSize=ka;function qa(e){return xe(this,void 0,void 0,function*(){yield dt.promises.unlink(e)})}E.rmFile=qa;function Ia(e,t){if(e<0)throw new Error("Invalid retention, minimum value is 1.");let r=e;if(t){let n=parseInt(t);!isNaN(n)&&n<r&&(pe.warning(`Retention days is greater than the max value allowed by the repository setting, reduce retention to ${n} days`),r=n)}return r}E.getProperRetention=Ia;function Na(e){return xe(this,void 0,void 0,function*(){return new Promise(t=>setTimeout(t,e))})}E.sleep=Na});var qn=y(He=>{"use strict";var Da=He&&He.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(He,"__esModule",{value:!0});var pt=Da(require("fs")),Pa=F(),Be=require("path"),kn=ve();function Fa(e,t,r){kn.checkArtifactName(e);let n=[];if(!pt.existsSync(t))throw new Error(`Provided rootDirectory ${t} does not exist`);if(!pt.lstatSync(t).isDirectory())throw new Error(`Provided rootDirectory ${t} is not a valid directory`);t=Be.normalize(t),t=Be.resolve(t);for(let i of r){if(!pt.existsSync(i))throw new Error(`File ${i} does not exist`);if(pt.lstatSync(i).isDirectory())Pa.debug(`Removing ${i} from rawSearchResults because it is a directory`);else{if(i=Be.normalize(i),i=Be.resolve(i),!i.startsWith(t))throw new Error(`The rootDirectory: ${t} is not a parent directory of the file: ${i}`);let s=i.replace(t,"");kn.checkArtifactFilePath(s),n.push({absoluteFilePath:i,uploadFilePath:Be.join(e,s)})}}return n}He.getUploadSpecification=Fa});var In=y(Wt=>{var me=require("path"),ne=process.platform==="win32",ie=require("fs"),Ma=process.env.NODE_DEBUG&&/fs/.test(process.env.NODE_DEBUG);function $a(){var e;if(Ma){var t=new Error;e=r}else e=n;return e;function r(i){i&&(t.message=i.message,i=t,n(i))}function n(i){if(i){if(process.throwDeprecation)throw i;if(!process.noDeprecation){var s="fs: missing callback "+(i.stack||i.message);process.traceDeprecation?console.trace(s):console.error(s)}}}}function Ua(e){return typeof e=="function"?e:$a()}var ol=me.normalize;ne?Z=/(.*?)(?:[\/\\]+|$)/g:Z=/(.*?)(?:[\/]+|$)/g;var Z;ne?ze=/^(?:[a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/][^\\\/]+)?[\\\/]*/:ze=/^[\/]*/;var ze;Wt.realpathSync=function(t,r){if(t=me.resolve(t),r&&Object.prototype.hasOwnProperty.call(r,t))return r[t];var n=t,i={},s={},o,a,c,u;l();function l(){var m=ze.exec(t);o=m[0].length,a=m[0],c=m[0],u="",ne&&!s[c]&&(ie.lstatSync(c),s[c]=!0)}for(;o<t.length;){Z.lastIndex=o;var h=Z.exec(t);if(u=a,a+=h[0],c=u+h[1],o=Z.lastIndex,!(s[c]||r&&r[c]===c)){var d;if(r&&Object.prototype.hasOwnProperty.call(r,c))d=r[c];else{var f=ie.lstatSync(c);if(!f.isSymbolicLink()){s[c]=!0,r&&(r[c]=c);continue}var p=null;if(!ne){var g=f.dev.toString(32)+":"+f.ino.toString(32);i.hasOwnProperty(g)&&(p=i[g])}p===null&&(ie.statSync(c),p=ie.readlinkSync(c)),d=me.resolve(u,p),r&&(r[c]=d),ne||(i[g]=p)}t=me.resolve(d,t.slice(o)),l()}}return r&&(r[n]=t),t};Wt.realpath=function(t,r,n){if(typeof n!="function"&&(n=Ua(r),r=null),t=me.resolve(t),r&&Object.prototype.hasOwnProperty.call(r,t))return process.nextTick(n.bind(null,null,r[t]));var i=t,s={},o={},a,c,u,l;h();function h(){var m=ze.exec(t);a=m[0].length,c=m[0],u=m[0],l="",ne&&!o[u]?ie.lstat(u,function(w){if(w)return n(w);o[u]=!0,d()}):process.nextTick(d)}function d(){if(a>=t.length)return r&&(r[i]=t),n(null,t);Z.lastIndex=a;var m=Z.exec(t);return l=c,c+=m[0],u=l+m[1],a=Z.lastIndex,o[u]||r&&r[u]===u?process.nextTick(d):r&&Object.prototype.hasOwnProperty.call(r,u)?g(r[u]):ie.lstat(u,f)}function f(m,w){if(m)return n(m);if(!w.isSymbolicLink())return o[u]=!0,r&&(r[u]=u),process.nextTick(d);if(!ne){var b=w.dev.toString(32)+":"+w.ino.toString(32);if(s.hasOwnProperty(b))return p(null,s[b],u)}ie.stat(u,function(T){if(T)return n(T);ie.readlink(u,function(O,B){ne||(s[b]=B),p(O,B)})})}function p(m,w,b){if(m)return n(m);var T=me.resolve(l,w);r&&(r[b]=T),g(T)}function g(m){t=me.resolve(m,t.slice(a)),h()}}});var Xt=y((cl,Fn)=>{Fn.exports=se;se.realpath=se;se.sync=Kt;se.realpathSync=Kt;se.monkeypatch=La;se.unmonkeypatch=xa;var ke=require("fs"),Vt=ke.realpath,Jt=ke.realpathSync,ja=process.version,Nn=/^v[0-5]\./.test(ja),Dn=In();function Pn(e){return e&&e.syscall==="realpath"&&(e.code==="ELOOP"||e.code==="ENOMEM"||e.code==="ENAMETOOLONG")}function se(e,t,r){if(Nn)return Vt(e,t,r);typeof t=="function"&&(r=t,t=null),Vt(e,t,function(n,i){Pn(n)?Dn.realpath(e,t,r):r(n,i)})}function Kt(e,t){if(Nn)return Jt(e,t);try{return Jt(e,t)}catch(r){if(Pn(r))return Dn.realpathSync(e,t);throw r}}function La(){ke.realpath=se,ke.realpathSync=Kt}function xa(){ke.realpath=Vt,ke.realpathSync=Jt}});var $n=y((ul,Mn)=>{Mn.exports=function(e,t){for(var r=[],n=0;n<e.length;n++){var i=t(e[n],n);Ga(i)?r.push.apply(r,i):r.push(i)}return r};var Ga=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"}});var Gn=y((ll,xn)=>{"use strict";xn.exports=Un;function Un(e,t,r){e instanceof RegExp&&(e=jn(e,r)),t instanceof RegExp&&(t=jn(t,r));var n=Ln(e,t,r);return n&&{start:n[0],end:n[1],pre:r.slice(0,n[0]),body:r.slice(n[0]+e.length,n[1]),post:r.slice(n[1]+t.length)}}function jn(e,t){var r=t.match(e);return r?r[0]:null}Un.range=Ln;function Ln(e,t,r){var n,i,s,o,a,c=r.indexOf(e),u=r.indexOf(t,c+1),l=c;if(c>=0&&u>0){if(e===t)return[c,u];for(n=[],s=r.length;l>=0&&!a;)l==c?(n.push(l),c=r.indexOf(e,l+1)):n.length==1?a=[n.pop(),u]:(i=n.pop(),i<s&&(s=i,o=u),u=r.indexOf(t,l+1)),l=c<u&&c>=0?c:u;n.length&&(a=[s,o])}return a}});var Xn=y((fl,Kn)=>{var Ba=$n(),Bn=Gn();Kn.exports=Wa;var Hn="\0SLASH"+Math.random()+"\0",zn="\0OPEN"+Math.random()+"\0",Yt="\0CLOSE"+Math.random()+"\0",Wn="\0COMMA"+Math.random()+"\0",Vn="\0PERIOD"+Math.random()+"\0";function Zt(e){return parseInt(e,10)==e?parseInt(e,10):e.charCodeAt(0)}function Ha(e){return e.split("\\\\").join(Hn).split("\\{").join(zn).split("\\}").join(Yt).split("\\,").join(Wn).split("\\.").join(Vn)}function za(e){return e.split(Hn).join("\\").split(zn).join("{").split(Yt).join("}").split(Wn).join(",").split(Vn).join(".")}function Jn(e){if(!e)return[""];var t=[],r=Bn("{","}",e);if(!r)return e.split(",");var n=r.pre,i=r.body,s=r.post,o=n.split(",");o[o.length-1]+="{"+i+"}";var a=Jn(s);return s.length&&(o[o.length-1]+=a.shift(),o.push.apply(o,a)),t.push.apply(t,o),t}function Wa(e){return e?(e.substr(0,2)==="{}"&&(e="\\{\\}"+e.substr(2)),qe(Ha(e),!0).map(za)):[]}function Va(e){return"{"+e+"}"}function Ja(e){return/^-?0\d/.test(e)}function Ka(e,t){return e<=t}function Xa(e,t){return e>=t}function qe(e,t){var r=[],n=Bn("{","}",e);if(!n||/\$$/.test(n.pre))return[e];var i=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(n.body),s=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(n.body),o=i||s,a=n.body.indexOf(",")>=0;if(!o&&!a)return n.post.match(/,.*\}/)?(e=n.pre+"{"+n.body+Yt+n.post,qe(e)):[e];var c;if(o)c=n.body.split(/\.\./);else if(c=Jn(n.body),c.length===1&&(c=qe(c[0],!1).map(Va),c.length===1)){var l=n.post.length?qe(n.post,!1):[""];return l.map(function(Dt){return n.pre+c[0]+Dt})}var u=n.pre,l=n.post.length?qe(n.post,!1):[""],h;if(o){var d=Zt(c[0]),f=Zt(c[1]),p=Math.max(c[0].length,c[1].length),g=c.length==3?Math.abs(Zt(c[2])):1,m=Ka,w=f<d;w&&(g*=-1,m=Xa);var b=c.some(Ja);h=[];for(var T=d;m(T,f);T+=g){var O;if(s)O=String.fromCharCode(T),O==="\\"&&(O="");else if(O=String(T),b){var B=p-O.length;if(B>0){var tt=new Array(B+1).join("0");T<0?O="-"+tt+O.slice(1):O=tt+O}}h.push(O)}}else h=Ba(c,function(rt){return qe(rt,!1)});for(var Ae=0;Ae<h.length;Ae++)for(var fe=0;fe<l.length;fe++){var X=u+h[Ae]+l[fe];(!t||o||X)&&r.push(X)}return r}});var vt=y((hl,ri)=>{ri.exports=x;x.Minimatch=C;var We={sep:"/"};try{We=require("path")}catch(e){}var Qt=x.GLOBSTAR=C.GLOBSTAR={},Ya=Xn(),Yn={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}},er="[^/]",tr=er+"*?",Za="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",Qa="(?:(?!(?:\\/|^)\\.).)*?",Zn=ec("().*{}+?[]^$\\!");function ec(e){return e.split("").reduce(function(t,r){return t[r]=!0,t},{})}var Qn=/\/+/;x.filter=tc;function tc(e,t){return t=t||{},function(r,n,i){return x(r,e,t)}}function ei(e,t){e=e||{},t=t||{};var r={};return Object.keys(t).forEach(function(n){r[n]=t[n]}),Object.keys(e).forEach(function(n){r[n]=e[n]}),r}x.defaults=function(e){if(!e||!Object.keys(e).length)return x;var t=x,r=function(i,s,o){return t.minimatch(i,s,ei(e,o))};return r.Minimatch=function(i,s){return new t.Minimatch(i,ei(e,s))},r};C.defaults=function(e){return!e||!Object.keys(e).length?C:x.defaults(e).Minimatch};function x(e,t,r){if(typeof t!="string")throw new TypeError("glob pattern string required");return r||(r={}),!r.nocomment&&t.charAt(0)==="#"?!1:t.trim()===""?e==="":new C(t,r).match(e)}function C(e,t){if(!(this instanceof C))return new C(e,t);if(typeof e!="string")throw new TypeError("glob pattern string required");t||(t={}),e=e.trim(),We.sep!=="/"&&(e=e.split(We.sep).join("/")),this.options=t,this.set=[],this.pattern=e,this.regexp=null,this.negate=!1,this.comment=!1,this.empty=!1,this.make()}C.prototype.debug=function(){};C.prototype.make=rc;function rc(){if(!this._made){var e=this.pattern,t=this.options;if(!t.nocomment&&e.charAt(0)==="#"){this.comment=!0;return}if(!e){this.empty=!0;return}this.parseNegate();var r=this.globSet=this.braceExpand();t.debug&&(this.debug=console.error),this.debug(this.pattern,r),r=this.globParts=r.map(function(n){return n.split(Qn)}),this.debug(this.pattern,r),r=r.map(function(n,i,s){return n.map(this.parse,this)},this),this.debug(this.pattern,r),r=r.filter(function(n){return n.indexOf(!1)===-1}),this.debug(this.pattern,r),this.set=r}}C.prototype.parseNegate=nc;function nc(){var e=this.pattern,t=!1,r=this.options,n=0;if(!r.nonegate){for(var i=0,s=e.length;i<s&&e.charAt(i)==="!";i++)t=!t,n++;n&&(this.pattern=e.substr(n)),this.negate=t}}x.braceExpand=function(e,t){return ti(e,t)};C.prototype.braceExpand=ti;function ti(e,t){if(t||(this instanceof C?t=this.options:t={}),e=typeof e=="undefined"?this.pattern:e,typeof e=="undefined")throw new TypeError("undefined pattern");return t.nobrace||!e.match(/\{.*\}/)?[e]:Ya(e)}C.prototype.parse=ic;var gt={};function ic(e,t){if(e.length>1024*64)throw new TypeError("pattern is too long");var r=this.options;if(!r.noglobstar&&e==="**")return Qt;if(e==="")return"";var n="",i=!!r.nocase,s=!1,o=[],a=[],c,u=!1,l=-1,h=-1,d=e.charAt(0)==="."?"":r.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",f=this;function p(){if(c){switch(c){case"*":n+=tr,i=!0;break;case"?":n+=er,i=!0;break;default:n+="\\"+c;break}f.debug("clearStateChar %j %j",c,n),c=!1}}for(var g=0,m=e.length,w;g<m&&(w=e.charAt(g));g++){if(this.debug("%s	%s %s %j",e,g,n,w),s&&Zn[w]){n+="\\"+w,s=!1;continue}switch(w){case"/":return!1;case"\\":p(),s=!0;continue;case"?":case"*":case"+":case"@":case"!":if(this.debug("%s	%s %s %j <-- stateChar",e,g,n,w),u){this.debug("  in class"),w==="!"&&g===h+1&&(w="^"),n+=w;continue}f.debug("call clearStateChar %j",c),p(),c=w,r.noext&&p();continue;case"(":if(u){n+="(";continue}if(!c){n+="\\(";continue}o.push({type:c,start:g-1,reStart:n.length,open:Yn[c].open,close:Yn[c].close}),n+=c==="!"?"(?:(?!(?:":"(?:",this.debug("plType %j %j",c,n),c=!1;continue;case")":if(u||!o.length){n+="\\)";continue}p(),i=!0;var b=o.pop();n+=b.close,b.type==="!"&&a.push(b),b.reEnd=n.length;continue;case"|":if(u||!o.length||s){n+="\\|",s=!1;continue}p(),n+="|";continue;case"[":if(p(),u){n+="\\"+w;continue}u=!0,h=g,l=n.length,n+=w;continue;case"]":if(g===h+1||!u){n+="\\"+w,s=!1;continue}if(u){var T=e.substring(h+1,g);try{RegExp("["+T+"]")}catch(xr){var O=this.parse(T,gt);n=n.substr(0,l)+"\\["+O[0]+"\\]",i=i||O[1],u=!1;continue}}i=!0,u=!1,n+=w;continue;default:p(),s?s=!1:Zn[w]&&!(w==="^"&&u)&&(n+="\\"),n+=w}}for(u&&(T=e.substr(h+1),O=this.parse(T,gt),n=n.substr(0,l)+"\\["+O[0],i=i||O[1]),b=o.pop();b;b=o.pop()){var B=n.slice(b.reStart+b.open.length);this.debug("setting tail",n,b),B=B.replace(/((?:\\{2}){0,64})(\\?)\|/g,function(xr,Gr,Mt){return Mt||(Mt="\\"),Gr+Gr+Mt+"|"}),this.debug(`tail=%j
   %s`,B,B,b,n);var tt=b.type==="*"?tr:b.type==="?"?er:"\\"+b.type;i=!0,n=n.slice(0,b.reStart)+tt+"\\("+B}p(),s&&(n+="\\\\");var Ae=!1;switch(n.charAt(0)){case".":case"[":case"(":Ae=!0}for(var fe=a.length-1;fe>-1;fe--){var X=a[fe],rt=n.slice(0,X.reStart),Dt=n.slice(X.reStart,X.reEnd-8),jr=n.slice(X.reEnd-8,X.reEnd),$e=n.slice(X.reEnd);jr+=$e;var qs=rt.split("(").length-1,Pt=$e;for(g=0;g<qs;g++)Pt=Pt.replace(/\)[+*?]?/,"");$e=Pt;var Lr="";$e===""&&t!==gt&&(Lr="$");var Is=rt+Dt+$e+Lr+jr;n=Is}if(n!==""&&i&&(n="(?=.)"+n),Ae&&(n=d+n),t===gt)return[n,i];if(!i)return ac(e);var Ns=r.nocase?"i":"";try{var Ft=new RegExp("^"+n+"$",Ns)}catch(xr){return new RegExp("$.")}return Ft._glob=e,Ft._src=n,Ft}x.makeRe=function(e,t){return new C(e,t||{}).makeRe()};C.prototype.makeRe=sc;function sc(){if(this.regexp||this.regexp===!1)return this.regexp;var e=this.set;if(!e.length)return this.regexp=!1,this.regexp;var t=this.options,r=t.noglobstar?tr:t.dot?Za:Qa,n=t.nocase?"i":"",i=e.map(function(s){return s.map(function(o){return o===Qt?r:typeof o=="string"?cc(o):o._src}).join("\\/")}).join("|");i="^(?:"+i+")$",this.negate&&(i="^(?!"+i+").*$");try{this.regexp=new RegExp(i,n)}catch(s){this.regexp=!1}return this.regexp}x.match=function(e,t,r){r=r||{};var n=new C(t,r);return e=e.filter(function(i){return n.match(i)}),n.options.nonull&&!e.length&&e.push(t),e};C.prototype.match=oc;function oc(e,t){if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return e==="";if(e==="/"&&t)return!0;var r=this.options;We.sep!=="/"&&(e=e.split(We.sep).join("/")),e=e.split(Qn),this.debug(this.pattern,"split",e);var n=this.set;this.debug(this.pattern,"set",n);var i,s;for(s=e.length-1;s>=0&&(i=e[s],!i);s--);for(s=0;s<n.length;s++){var o=n[s],a=e;r.matchBase&&o.length===1&&(a=[i]);var c=this.matchOne(a,o,t);if(c)return r.flipNegate?!0:!this.negate}return r.flipNegate?!1:this.negate}C.prototype.matchOne=function(e,t,r){var n=this.options;this.debug("matchOne",{this:this,file:e,pattern:t}),this.debug("matchOne",e.length,t.length);for(var i=0,s=0,o=e.length,a=t.length;i<o&&s<a;i++,s++){this.debug("matchOne loop");var c=t[s],u=e[i];if(this.debug(t,c,u),c===!1)return!1;if(c===Qt){this.debug("GLOBSTAR",[t,c,u]);var l=i,h=s+1;if(h===a){for(this.debug("** at the end");i<o;i++)if(e[i]==="."||e[i]===".."||!n.dot&&e[i].charAt(0)===".")return!1;return!0}for(;l<o;){var d=e[l];if(this.debug(`
globstar while`,e,l,t,h,d),this.matchOne(e.slice(l),t.slice(h),r))return this.debug("globstar found match!",l,o,d),!0;if(d==="."||d===".."||!n.dot&&d.charAt(0)==="."){this.debug("dot detected!",e,l,t,h);break}this.debug("globstar swallow a segment, and continue"),l++}return!!(r&&(this.debug(`
>>> no match, partial?`,e,l,t,h),l===o))}var f;if(typeof c=="string"?(n.nocase?f=u.toLowerCase()===c.toLowerCase():f=u===c,this.debug("string match",c,u,f)):(f=u.match(c),this.debug("pattern match",c,u,f)),!f)return!1}if(i===o&&s===a)return!0;if(i===o)return r;if(s===a){var p=i===o-1&&e[i]==="";return p}throw new Error("wtf?")};function ac(e){return e.replace(/\\(.)/g,"$1")}function cc(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}});var ni=y((dl,rr)=>{typeof Object.create=="function"?rr.exports=function(t,r){r&&(t.super_=r,t.prototype=Object.create(r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:rr.exports=function(t,r){if(r){t.super_=r;var n=function(){};n.prototype=r.prototype,t.prototype=new n,t.prototype.constructor=t}}});var ii=y((pl,ir)=>{try{if(nr=require("util"),typeof nr.inherits!="function")throw"";ir.exports=nr.inherits}catch(e){ir.exports=ni()}var nr});var yt=y((gl,mt)=>{"use strict";function si(e){return e.charAt(0)==="/"}function oi(e){var t=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/,r=t.exec(e),n=r[1]||"",i=Boolean(n&&n.charAt(1)!==":");return Boolean(r[2]||i)}mt.exports=process.platform==="win32"?oi:si;mt.exports.posix=si;mt.exports.win32=oi});var or=y(oe=>{oe.setopts=pc;oe.ownProp=ai;oe.makeAbs=Ve;oe.finish=gc;oe.mark=vc;oe.isIgnored=ui;oe.childrenIgnored=mc;function ai(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var uc=require("fs"),Ie=require("path"),lc=vt(),ci=yt(),sr=lc.Minimatch;function fc(e,t){return e.localeCompare(t,"en")}function hc(e,t){e.ignore=t.ignore||[],Array.isArray(e.ignore)||(e.ignore=[e.ignore]),e.ignore.length&&(e.ignore=e.ignore.map(dc))}function dc(e){var t=null;if(e.slice(-3)==="/**"){var r=e.replace(/(\/\*\*)+$/,"");t=new sr(r,{dot:!0})}return{matcher:new sr(e,{dot:!0}),gmatcher:t}}function pc(e,t,r){if(r||(r={}),r.matchBase&&t.indexOf("/")===-1){if(r.noglobstar)throw new Error("base matching requires globstar");t="**/"+t}e.silent=!!r.silent,e.pattern=t,e.strict=r.strict!==!1,e.realpath=!!r.realpath,e.realpathCache=r.realpathCache||Object.create(null),e.follow=!!r.follow,e.dot=!!r.dot,e.mark=!!r.mark,e.nodir=!!r.nodir,e.nodir&&(e.mark=!0),e.sync=!!r.sync,e.nounique=!!r.nounique,e.nonull=!!r.nonull,e.nosort=!!r.nosort,e.nocase=!!r.nocase,e.stat=!!r.stat,e.noprocess=!!r.noprocess,e.absolute=!!r.absolute,e.fs=r.fs||uc,e.maxLength=r.maxLength||1/0,e.cache=r.cache||Object.create(null),e.statCache=r.statCache||Object.create(null),e.symlinks=r.symlinks||Object.create(null),hc(e,r),e.changedCwd=!1;var n=process.cwd();ai(r,"cwd")?(e.cwd=Ie.resolve(r.cwd),e.changedCwd=e.cwd!==n):e.cwd=n,e.root=r.root||Ie.resolve(e.cwd,"/"),e.root=Ie.resolve(e.root),process.platform==="win32"&&(e.root=e.root.replace(/\\/g,"/")),e.cwdAbs=ci(e.cwd)?e.cwd:Ve(e,e.cwd),process.platform==="win32"&&(e.cwdAbs=e.cwdAbs.replace(/\\/g,"/")),e.nomount=!!r.nomount,r.nonegate=!0,r.nocomment=!0,e.minimatch=new sr(t,r),e.options=e.minimatch.options}function gc(e){for(var t=e.nounique,r=t?[]:Object.create(null),n=0,i=e.matches.length;n<i;n++){var s=e.matches[n];if(!s||Object.keys(s).length===0){if(e.nonull){var o=e.minimatch.globSet[n];t?r.push(o):r[o]=!0}}else{var a=Object.keys(s);t?r.push.apply(r,a):a.forEach(function(c){r[c]=!0})}}if(t||(r=Object.keys(r)),e.nosort||(r=r.sort(fc)),e.mark){for(var n=0;n<r.length;n++)r[n]=e._mark(r[n]);e.nodir&&(r=r.filter(function(c){var u=!/\/$/.test(c),l=e.cache[c]||e.cache[Ve(e,c)];return u&&l&&(u=l!=="DIR"&&!Array.isArray(l)),u}))}e.ignore.length&&(r=r.filter(function(c){return!ui(e,c)})),e.found=r}function vc(e,t){var r=Ve(e,t),n=e.cache[r],i=t;if(n){var s=n==="DIR"||Array.isArray(n),o=t.slice(-1)==="/";if(s&&!o?i+="/":!s&&o&&(i=i.slice(0,-1)),i!==t){var a=Ve(e,i);e.statCache[a]=e.statCache[r],e.cache[a]=e.cache[r]}}return i}function Ve(e,t){var r=t;return t.charAt(0)==="/"?r=Ie.join(e.root,t):ci(t)||t===""?r=t:e.changedCwd?r=Ie.resolve(e.cwd,t):r=Ie.resolve(t),process.platform==="win32"&&(r=r.replace(/\\/g,"/")),r}function ui(e,t){return e.ignore.length?e.ignore.some(function(r){return r.matcher.match(t)||!!(r.gmatcher&&r.gmatcher.match(t))}):!1}function mc(e,t){return e.ignore.length?e.ignore.some(function(r){return!!(r.gmatcher&&r.gmatcher.match(t))}):!1}});var pi=y((_l,di)=>{di.exports=hi;hi.GlobSync=R;var yc=Xt(),li=vt(),ml=li.Minimatch,yl=ur().Glob,wl=require("util"),ar=require("path"),fi=require("assert"),wt=yt(),ye=or(),wc=ye.setopts,cr=ye.ownProp,_c=ye.childrenIgnored,Sc=ye.isIgnored;function hi(e,t){if(typeof t=="function"||arguments.length===3)throw new TypeError(`callback provided to sync glob
See: https://github.com/isaacs/node-glob/issues/167`);return new R(e,t).found}function R(e,t){if(!e)throw new Error("must provide pattern");if(typeof t=="function"||arguments.length===3)throw new TypeError(`callback provided to sync glob
See: https://github.com/isaacs/node-glob/issues/167`);if(!(this instanceof R))return new R(e,t);if(wc(this,e,t),this.noprocess)return this;var r=this.minimatch.set.length;this.matches=new Array(r);for(var n=0;n<r;n++)this._process(this.minimatch.set[n],n,!1);this._finish()}R.prototype._finish=function(){if(fi(this instanceof R),this.realpath){var e=this;this.matches.forEach(function(t,r){var n=e.matches[r]=Object.create(null);for(var i in t)try{i=e._makeAbs(i);var s=yc.realpathSync(i,e.realpathCache);n[s]=!0}catch(o){if(o.syscall==="stat")n[e._makeAbs(i)]=!0;else throw o}})}ye.finish(this)};R.prototype._process=function(e,t,r){fi(this instanceof R);for(var n=0;typeof e[n]=="string";)n++;var i;switch(n){case e.length:this._processSimple(e.join("/"),t);return;case 0:i=null;break;default:i=e.slice(0,n).join("/");break}var s=e.slice(n),o;i===null?o=".":((wt(i)||wt(e.join("/")))&&(!i||!wt(i))&&(i="/"+i),o=i);var a=this._makeAbs(o);if(!_c(this,o)){var c=s[0]===li.GLOBSTAR;c?this._processGlobStar(i,o,a,s,t,r):this._processReaddir(i,o,a,s,t,r)}};R.prototype._processReaddir=function(e,t,r,n,i,s){var o=this._readdir(r,s);if(!!o){for(var a=n[0],c=!!this.minimatch.negate,u=a._glob,l=this.dot||u.charAt(0)===".",h=[],d=0;d<o.length;d++){var f=o[d];if(f.charAt(0)!=="."||l){var p;c&&!e?p=!f.match(a):p=f.match(a),p&&h.push(f)}}var g=h.length;if(g!==0){if(n.length===1&&!this.mark&&!this.stat){this.matches[i]||(this.matches[i]=Object.create(null));for(var d=0;d<g;d++){var f=h[d];e&&(e.slice(-1)!=="/"?f=e+"/"+f:f=e+f),f.charAt(0)==="/"&&!this.nomount&&(f=ar.join(this.root,f)),this._emitMatch(i,f)}return}n.shift();for(var d=0;d<g;d++){var f=h[d],m;e?m=[e,f]:m=[f],this._process(m.concat(n),i,s)}}}};R.prototype._emitMatch=function(e,t){if(!Sc(this,t)){var r=this._makeAbs(t);if(this.mark&&(t=this._mark(t)),this.absolute&&(t=r),!this.matches[e][t]){if(this.nodir){var n=this.cache[r];if(n==="DIR"||Array.isArray(n))return}this.matches[e][t]=!0,this.stat&&this._stat(t)}}};R.prototype._readdirInGlobStar=function(e){if(this.follow)return this._readdir(e,!1);var t,r,n;try{r=this.fs.lstatSync(e)}catch(s){if(s.code==="ENOENT")return null}var i=r&&r.isSymbolicLink();return this.symlinks[e]=i,!i&&r&&!r.isDirectory()?this.cache[e]="FILE":t=this._readdir(e,!1),t};R.prototype._readdir=function(e,t){var r;if(t&&!cr(this.symlinks,e))return this._readdirInGlobStar(e);if(cr(this.cache,e)){var n=this.cache[e];if(!n||n==="FILE")return null;if(Array.isArray(n))return n}try{return this._readdirEntries(e,this.fs.readdirSync(e))}catch(i){return this._readdirError(e,i),null}};R.prototype._readdirEntries=function(e,t){if(!this.mark&&!this.stat)for(var r=0;r<t.length;r++){var n=t[r];e==="/"?n=e+n:n=e+"/"+n,this.cache[n]=!0}return this.cache[e]=t,t};R.prototype._readdirError=function(e,t){switch(t.code){case"ENOTSUP":case"ENOTDIR":var r=this._makeAbs(e);if(this.cache[r]="FILE",r===this.cwdAbs){var n=new Error(t.code+" invalid cwd "+this.cwd);throw n.path=this.cwd,n.code=t.code,n}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(e)]=!1;break;default:if(this.cache[this._makeAbs(e)]=!1,this.strict)throw t;this.silent||console.error("glob error",t);break}};R.prototype._processGlobStar=function(e,t,r,n,i,s){var o=this._readdir(r,s);if(!!o){var a=n.slice(1),c=e?[e]:[],u=c.concat(a);this._process(u,i,!1);var l=o.length,h=this.symlinks[r];if(!(h&&s))for(var d=0;d<l;d++){var f=o[d];if(!(f.charAt(0)==="."&&!this.dot)){var p=c.concat(o[d],a);this._process(p,i,!0);var g=c.concat(o[d],n);this._process(g,i,!0)}}}};R.prototype._processSimple=function(e,t){var r=this._stat(e);if(this.matches[t]||(this.matches[t]=Object.create(null)),!!r){if(e&&wt(e)&&!this.nomount){var n=/[\/\\]$/.test(e);e.charAt(0)==="/"?e=ar.join(this.root,e):(e=ar.resolve(this.root,e),n&&(e+="/"))}process.platform==="win32"&&(e=e.replace(/\\/g,"/")),this._emitMatch(t,e)}};R.prototype._stat=function(e){var t=this._makeAbs(e),r=e.slice(-1)==="/";if(e.length>this.maxLength)return!1;if(!this.stat&&cr(this.cache,t)){var o=this.cache[t];if(Array.isArray(o)&&(o="DIR"),!r||o==="DIR")return o;if(r&&o==="FILE")return!1}var n,i=this.statCache[t];if(!i){var s;try{s=this.fs.lstatSync(t)}catch(a){if(a&&(a.code==="ENOENT"||a.code==="ENOTDIR"))return this.statCache[t]=!1,!1}if(s&&s.isSymbolicLink())try{i=this.fs.statSync(t)}catch(a){i=s}else i=s}this.statCache[t]=i;var o=!0;return i&&(o=i.isDirectory()?"DIR":"FILE"),this.cache[t]=this.cache[t]||o,r&&o==="FILE"?!1:o};R.prototype._mark=function(e){return ye.mark(this,e)};R.prototype._makeAbs=function(e){return ye.makeAbs(this,e)}});var lr=y((Sl,vi)=>{vi.exports=gi;function gi(e,t){if(e&&t)return gi(e)(t);if(typeof e!="function")throw new TypeError("need wrapper function");return Object.keys(e).forEach(function(n){r[n]=e[n]}),r;function r(){for(var n=new Array(arguments.length),i=0;i<n.length;i++)n[i]=arguments[i];var s=e.apply(this,n),o=n[n.length-1];return typeof s=="function"&&s!==o&&Object.keys(o).forEach(function(a){s[a]=o[a]}),s}}});var hr=y((bl,fr)=>{var mi=lr();fr.exports=mi(_t);fr.exports.strict=mi(yi);_t.proto=_t(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return _t(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return yi(this)},configurable:!0})});function _t(e){var t=function(){return t.called?t.value:(t.called=!0,t.value=e.apply(this,arguments))};return t.called=!1,t}function yi(e){var t=function(){if(t.called)throw new Error(t.onceError);return t.called=!0,t.value=e.apply(this,arguments)},r=e.name||"Function wrapped with `once`";return t.onceError=r+" shouldn't be called more than once",t.called=!1,t}});var _i=y((El,wi)=>{var bc=lr(),Je=Object.create(null),Ec=hr();wi.exports=bc(Ac);function Ac(e,t){return Je[e]?(Je[e].push(t),null):(Je[e]=[t],Rc(e))}function Rc(e){return Ec(function t(){var r=Je[e],n=r.length,i=Oc(arguments);try{for(var s=0;s<n;s++)r[s].apply(null,i)}finally{r.length>n?(r.splice(0,n),process.nextTick(function(){t.apply(null,i)})):delete Je[e]}})}function Oc(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n]=e[n];return r}});var ur=y((Ol,bi)=>{bi.exports=_e;var Cc=Xt(),Si=vt(),Al=Si.Minimatch,Tc=ii(),kc=require("events").EventEmitter,dr=require("path"),pr=require("assert"),Ke=yt(),gr=pi(),we=or(),qc=we.setopts,vr=we.ownProp,mr=_i(),Rl=require("util"),Ic=we.childrenIgnored,Nc=we.isIgnored,Dc=hr();function _e(e,t,r){if(typeof t=="function"&&(r=t,t={}),t||(t={}),t.sync){if(r)throw new TypeError("callback provided to sync glob");return gr(e,t)}return new S(e,t,r)}_e.sync=gr;var Pc=_e.GlobSync=gr.GlobSync;_e.glob=_e;function Fc(e,t){if(t===null||typeof t!="object")return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}_e.hasMagic=function(e,t){var r=Fc({},t);r.noprocess=!0;var n=new S(e,r),i=n.minimatch.set;if(!e)return!1;if(i.length>1)return!0;for(var s=0;s<i[0].length;s++)if(typeof i[0][s]!="string")return!0;return!1};_e.Glob=S;Tc(S,kc);function S(e,t,r){if(typeof t=="function"&&(r=t,t=null),t&&t.sync){if(r)throw new TypeError("callback provided to sync glob");return new Pc(e,t)}if(!(this instanceof S))return new S(e,t,r);qc(this,e,t),this._didRealPath=!1;var n=this.minimatch.set.length;this.matches=new Array(n),typeof r=="function"&&(r=Dc(r),this.on("error",r),this.on("end",function(c){r(null,c)}));var i=this;if(this._processing=0,this._emitQueue=[],this._processQueue=[],this.paused=!1,this.noprocess)return this;if(n===0)return a();for(var s=!0,o=0;o<n;o++)this._process(this.minimatch.set[o],o,!1,a);s=!1;function a(){--i._processing,i._processing<=0&&(s?process.nextTick(function(){i._finish()}):i._finish())}}S.prototype._finish=function(){if(pr(this instanceof S),!this.aborted){if(this.realpath&&!this._didRealpath)return this._realpath();we.finish(this),this.emit("end",this.found)}};S.prototype._realpath=function(){if(this._didRealpath)return;this._didRealpath=!0;var e=this.matches.length;if(e===0)return this._finish();for(var t=this,r=0;r<this.matches.length;r++)this._realpathSet(r,n);function n(){--e==0&&t._finish()}};S.prototype._realpathSet=function(e,t){var r=this.matches[e];if(!r)return t();var n=Object.keys(r),i=this,s=n.length;if(s===0)return t();var o=this.matches[e]=Object.create(null);n.forEach(function(a,c){a=i._makeAbs(a),Cc.realpath(a,i.realpathCache,function(u,l){u?u.syscall==="stat"?o[a]=!0:i.emit("error",u):o[l]=!0,--s==0&&(i.matches[e]=o,t())})})};S.prototype._mark=function(e){return we.mark(this,e)};S.prototype._makeAbs=function(e){return we.makeAbs(this,e)};S.prototype.abort=function(){this.aborted=!0,this.emit("abort")};S.prototype.pause=function(){this.paused||(this.paused=!0,this.emit("pause"))};S.prototype.resume=function(){if(this.paused){if(this.emit("resume"),this.paused=!1,this._emitQueue.length){var e=this._emitQueue.slice(0);this._emitQueue.length=0;for(var t=0;t<e.length;t++){var r=e[t];this._emitMatch(r[0],r[1])}}if(this._processQueue.length){var n=this._processQueue.slice(0);this._processQueue.length=0;for(var t=0;t<n.length;t++){var i=n[t];this._processing--,this._process(i[0],i[1],i[2],i[3])}}}};S.prototype._process=function(e,t,r,n){if(pr(this instanceof S),pr(typeof n=="function"),!this.aborted){if(this._processing++,this.paused){this._processQueue.push([e,t,r,n]);return}for(var i=0;typeof e[i]=="string";)i++;var s;switch(i){case e.length:this._processSimple(e.join("/"),t,n);return;case 0:s=null;break;default:s=e.slice(0,i).join("/");break}var o=e.slice(i),a;s===null?a=".":((Ke(s)||Ke(e.join("/")))&&(!s||!Ke(s))&&(s="/"+s),a=s);var c=this._makeAbs(a);if(Ic(this,a))return n();var u=o[0]===Si.GLOBSTAR;u?this._processGlobStar(s,a,c,o,t,r,n):this._processReaddir(s,a,c,o,t,r,n)}};S.prototype._processReaddir=function(e,t,r,n,i,s,o){var a=this;this._readdir(r,s,function(c,u){return a._processReaddir2(e,t,r,n,i,s,u,o)})};S.prototype._processReaddir2=function(e,t,r,n,i,s,o,a){if(!o)return a();for(var c=n[0],u=!!this.minimatch.negate,l=c._glob,h=this.dot||l.charAt(0)===".",d=[],f=0;f<o.length;f++){var p=o[f];if(p.charAt(0)!=="."||h){var g;u&&!e?g=!p.match(c):g=p.match(c),g&&d.push(p)}}var m=d.length;if(m===0)return a();if(n.length===1&&!this.mark&&!this.stat){this.matches[i]||(this.matches[i]=Object.create(null));for(var f=0;f<m;f++){var p=d[f];e&&(e!=="/"?p=e+"/"+p:p=e+p),p.charAt(0)==="/"&&!this.nomount&&(p=dr.join(this.root,p)),this._emitMatch(i,p)}return a()}n.shift();for(var f=0;f<m;f++){var p=d[f],w;e&&(e!=="/"?p=e+"/"+p:p=e+p),this._process([p].concat(n),i,s,a)}a()};S.prototype._emitMatch=function(e,t){if(!this.aborted&&!Nc(this,t)){if(this.paused){this._emitQueue.push([e,t]);return}var r=Ke(t)?t:this._makeAbs(t);if(this.mark&&(t=this._mark(t)),this.absolute&&(t=r),!this.matches[e][t]){if(this.nodir){var n=this.cache[r];if(n==="DIR"||Array.isArray(n))return}this.matches[e][t]=!0;var i=this.statCache[r];i&&this.emit("stat",t,i),this.emit("match",t)}}};S.prototype._readdirInGlobStar=function(e,t){if(this.aborted)return;if(this.follow)return this._readdir(e,!1,t);var r="lstat\0"+e,n=this,i=mr(r,s);i&&n.fs.lstat(e,i);function s(o,a){if(o&&o.code==="ENOENT")return t();var c=a&&a.isSymbolicLink();n.symlinks[e]=c,!c&&a&&!a.isDirectory()?(n.cache[e]="FILE",t()):n._readdir(e,!1,t)}};S.prototype._readdir=function(e,t,r){if(!this.aborted&&(r=mr("readdir\0"+e+"\0"+t,r),!!r)){if(t&&!vr(this.symlinks,e))return this._readdirInGlobStar(e,r);if(vr(this.cache,e)){var n=this.cache[e];if(!n||n==="FILE")return r();if(Array.isArray(n))return r(null,n)}var i=this;i.fs.readdir(e,Mc(this,e,r))}};function Mc(e,t,r){return function(n,i){n?e._readdirError(t,n,r):e._readdirEntries(t,i,r)}}S.prototype._readdirEntries=function(e,t,r){if(!this.aborted){if(!this.mark&&!this.stat)for(var n=0;n<t.length;n++){var i=t[n];e==="/"?i=e+i:i=e+"/"+i,this.cache[i]=!0}return this.cache[e]=t,r(null,t)}};S.prototype._readdirError=function(e,t,r){if(!this.aborted){switch(t.code){case"ENOTSUP":case"ENOTDIR":var n=this._makeAbs(e);if(this.cache[n]="FILE",n===this.cwdAbs){var i=new Error(t.code+" invalid cwd "+this.cwd);i.path=this.cwd,i.code=t.code,this.emit("error",i),this.abort()}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(e)]=!1;break;default:this.cache[this._makeAbs(e)]=!1,this.strict&&(this.emit("error",t),this.abort()),this.silent||console.error("glob error",t);break}return r()}};S.prototype._processGlobStar=function(e,t,r,n,i,s,o){var a=this;this._readdir(r,s,function(c,u){a._processGlobStar2(e,t,r,n,i,s,u,o)})};S.prototype._processGlobStar2=function(e,t,r,n,i,s,o,a){if(!o)return a();var c=n.slice(1),u=e?[e]:[],l=u.concat(c);this._process(l,i,!1,a);var h=this.symlinks[r],d=o.length;if(h&&s)return a();for(var f=0;f<d;f++){var p=o[f];if(!(p.charAt(0)==="."&&!this.dot)){var g=u.concat(o[f],c);this._process(g,i,!0,a);var m=u.concat(o[f],n);this._process(m,i,!0,a)}}a()};S.prototype._processSimple=function(e,t,r){var n=this;this._stat(e,function(i,s){n._processSimple2(e,t,i,s,r)})};S.prototype._processSimple2=function(e,t,r,n,i){if(this.matches[t]||(this.matches[t]=Object.create(null)),!n)return i();if(e&&Ke(e)&&!this.nomount){var s=/[\/\\]$/.test(e);e.charAt(0)==="/"?e=dr.join(this.root,e):(e=dr.resolve(this.root,e),s&&(e+="/"))}process.platform==="win32"&&(e=e.replace(/\\/g,"/")),this._emitMatch(t,e),i()};S.prototype._stat=function(e,t){var r=this._makeAbs(e),n=e.slice(-1)==="/";if(e.length>this.maxLength)return t();if(!this.stat&&vr(this.cache,r)){var i=this.cache[r];if(Array.isArray(i)&&(i="DIR"),!n||i==="DIR")return t(null,i);if(n&&i==="FILE")return t()}var s,o=this.statCache[r];if(o!==void 0){if(o===!1)return t(null,o);var a=o.isDirectory()?"DIR":"FILE";return n&&a==="FILE"?t():t(null,a,o)}var c=this,u=mr("stat\0"+r,l);u&&c.fs.lstat(r,u);function l(h,d){if(d&&d.isSymbolicLink())return c.fs.stat(r,function(f,p){f?c._stat2(e,r,null,d,t):c._stat2(e,r,f,p,t)});c._stat2(e,r,h,d,t)}};S.prototype._stat2=function(e,t,r,n,i){if(r&&(r.code==="ENOENT"||r.code==="ENOTDIR"))return this.statCache[t]=!1,i();var s=e.slice(-1)==="/";if(this.statCache[t]=n,t.slice(-1)==="/"&&n&&!n.isDirectory())return i(null,!1,n);var o=!0;return n&&(o=n.isDirectory()?"DIR":"FILE"),this.cache[t]=this.cache[t]||o,s&&o==="FILE"?i():i(null,o,n)}});var Ii=y((Cl,qi)=>{qi.exports=wr;wr.sync=ki;var _=require("assert"),Ei=require("path"),Ai=require("fs"),Ne=void 0;try{Ne=ur()}catch(e){}var Ri=parseInt("666",8),$c={nosort:!0,silent:!0},yr=0,Xe=process.platform==="win32";function Oi(e){var t=["unlink","chmod","stat","lstat","rmdir","readdir"];if(t.forEach(function(r){e[r]=e[r]||Ai[r],r=r+"Sync",e[r]=e[r]||Ai[r]}),e.maxBusyTries=e.maxBusyTries||3,e.emfileWait=e.emfileWait||1e3,e.glob===!1&&(e.disableGlob=!0),e.disableGlob!==!0&&Ne===void 0)throw Error("glob dependency not found, set `options.disableGlob = true` if intentional");e.disableGlob=e.disableGlob||!1,e.glob=e.glob||$c}function wr(e,t,r){typeof t=="function"&&(r=t,t={}),_(e,"rimraf: missing path"),_.equal(typeof e,"string","rimraf: path should be a string"),_.equal(typeof r,"function","rimraf: callback function required"),_(t,"rimraf: invalid options argument provided"),_.equal(typeof t,"object","rimraf: options should be object"),Oi(t);var n=0,i=null,s=0;if(t.disableGlob||!Ne.hasMagic(e))return a(null,[e]);t.lstat(e,function(c,u){if(!c)return a(null,[e]);Ne(e,t.glob,a)});function o(c){i=i||c,--s==0&&r(i)}function a(c,u){if(c)return r(c);if(s=u.length,s===0)return r();u.forEach(function(l){_r(l,t,function h(d){if(d){if((d.code==="EBUSY"||d.code==="ENOTEMPTY"||d.code==="EPERM")&&n<t.maxBusyTries){n++;var f=n*100;return setTimeout(function(){_r(l,t,h)},f)}if(d.code==="EMFILE"&&yr<t.emfileWait)return setTimeout(function(){_r(l,t,h)},yr++);d.code==="ENOENT"&&(d=null)}yr=0,o(d)})})}}function _r(e,t,r){_(e),_(t),_(typeof r=="function"),t.lstat(e,function(n,i){if(n&&n.code==="ENOENT")return r(null);if(n&&n.code==="EPERM"&&Xe&&Ci(e,t,n,r),i&&i.isDirectory())return St(e,t,n,r);t.unlink(e,function(s){if(s){if(s.code==="ENOENT")return r(null);if(s.code==="EPERM")return Xe?Ci(e,t,s,r):St(e,t,s,r);if(s.code==="EISDIR")return St(e,t,s,r)}return r(s)})})}function Ci(e,t,r,n){_(e),_(t),_(typeof n=="function"),r&&_(r instanceof Error),t.chmod(e,Ri,function(i){i?n(i.code==="ENOENT"?null:r):t.stat(e,function(s,o){s?n(s.code==="ENOENT"?null:r):o.isDirectory()?St(e,t,r,n):t.unlink(e,n)})})}function Ti(e,t,r){_(e),_(t),r&&_(r instanceof Error);try{t.chmodSync(e,Ri)}catch(i){if(i.code==="ENOENT")return;throw r}try{var n=t.statSync(e)}catch(i){if(i.code==="ENOENT")return;throw r}n.isDirectory()?bt(e,t,r):t.unlinkSync(e)}function St(e,t,r,n){_(e),_(t),r&&_(r instanceof Error),_(typeof n=="function"),t.rmdir(e,function(i){i&&(i.code==="ENOTEMPTY"||i.code==="EEXIST"||i.code==="EPERM")?Uc(e,t,n):i&&i.code==="ENOTDIR"?n(r):n(i)})}function Uc(e,t,r){_(e),_(t),_(typeof r=="function"),t.readdir(e,function(n,i){if(n)return r(n);var s=i.length;if(s===0)return t.rmdir(e,r);var o;i.forEach(function(a){wr(Ei.join(e,a),t,function(c){if(!o){if(c)return r(o=c);--s==0&&t.rmdir(e,r)}})})})}function ki(e,t){t=t||{},Oi(t),_(e,"rimraf: missing path"),_.equal(typeof e,"string","rimraf: path should be a string"),_(t,"rimraf: missing options"),_.equal(typeof t,"object","rimraf: options should be object");var r;if(t.disableGlob||!Ne.hasMagic(e))r=[e];else try{t.lstatSync(e),r=[e]}catch(s){r=Ne.sync(e,t.glob)}if(!!r.length)for(var n=0;n<r.length;n++){var e=r[n];try{var i=t.lstatSync(e)}catch(o){if(o.code==="ENOENT")return;o.code==="EPERM"&&Xe&&Ti(e,t,o)}try{i&&i.isDirectory()?bt(e,t,null):t.unlinkSync(e)}catch(o){if(o.code==="ENOENT")return;if(o.code==="EPERM")return Xe?Ti(e,t,o):bt(e,t,o);if(o.code!=="EISDIR")throw o;bt(e,t,o)}}}function bt(e,t,r){_(e),_(t),r&&_(r instanceof Error);try{t.rmdirSync(e)}catch(n){if(n.code==="ENOENT")return;if(n.code==="ENOTDIR")throw r;(n.code==="ENOTEMPTY"||n.code==="EEXIST"||n.code==="EPERM")&&jc(e,t)}}function jc(e,t){_(e),_(t),t.readdirSync(e).forEach(function(o){ki(Ei.join(e,o),t)});var r=Xe?100:1,n=0;do{var i=!0;try{var s=t.rmdirSync(e,t);return i=!1,s}finally{if(++n<r&&i)continue}}while(!0)}});var Wi=y((Tl,Q)=>{var A=require("fs"),Sr=require("os"),Et=require("path"),Ni=require("crypto"),V=A.constants&&Sr.constants?{fs:A.constants,os:Sr.constants}:process.binding("constants"),Di=Ii(),Pi="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",br=/XXXXXX/,Fi=3,Mi=(V.O_CREAT||V.fs.O_CREAT)|(V.O_EXCL||V.fs.O_EXCL)|(V.O_RDWR||V.fs.O_RDWR),Lc=V.EBADF||V.os.errno.EBADF,xc=V.ENOENT||V.os.errno.ENOENT,$i=448,Ui=384,Er="exit",Ar="SIGINT",De=[],ji=!1;function Li(e){var t=[],r=null;try{r=Ni.randomBytes(e)}catch(i){r=Ni.pseudoRandomBytes(e)}for(var n=0;n<e;n++)t.push(Pi[r[n]%Pi.length]);return t.join("")}function Gc(e){return typeof e=="undefined"}function Pe(e,t){return typeof e=="function"?[{},e]:Gc(e)?[{},t]:[e,t]}function xi(e){let t=zi();if(Fe(e.dir)&&Fe(t))throw new Error("No tmp dir specified");if(!Fe(e.name))return Et.join(e.dir||t,e.name);if(e.template){var r=e.template;return Et.basename(r)===r&&(r=Et.join(e.dir||t,r)),r.replace(br,Li(6))}let n=[Fe(e.prefix)?"tmp-":e.prefix,process.pid,Li(12),e.postfix?e.postfix:""].join("");return Et.join(e.dir||t,n)}function Rr(e,t){var r=Pe(e,t),n=r[0],i=r[1],s=Fe(n.name)?n.tries||Fi:1;if(isNaN(s)||s<0)return i(new Error("Invalid tries"));if(n.template&&!n.template.match(br))return i(new Error("Invalid template provided"));(function o(){try{let a=xi(n);A.stat(a,function(c){if(!c)return s-- >0?o():i(new Error("Could not get a unique tmp filename, max tries reached "+a));i(null,a)})}catch(a){i(a)}})()}function Or(e){var t=Pe(e),r=t[0],n=Fe(r.name)?r.tries||Fi:1;if(isNaN(n)||n<0)throw new Error("Invalid tries");if(r.template&&!r.template.match(br))throw new Error("Invalid template provided");do{let i=xi(r);try{A.statSync(i)}catch(s){return i}}while(n-- >0);throw new Error("Could not get a unique tmp filename, max tries reached")}function Bc(e,t){var r=Pe(e,t),n=r[0],i=r[1];Rr(n,function(o,a){if(o)return i(o);A.open(a,Mi,n.mode||Ui,function(u,l){if(u)return i(u);if(n.discardDescriptor)return A.close(l,function(d){if(d){try{A.unlinkSync(a)}catch(f){Ot(f)||(d=f)}return i(d)}i(null,a,void 0,At(a,-1,n))});if(n.detachDescriptor)return i(null,a,l,At(a,-1,n));i(null,a,l,At(a,l,n))})})}function Hc(e){var t=Pe(e),r=t[0];let n=r.discardDescriptor||r.detachDescriptor,i=Or(r);var s=A.openSync(i,Mi,r.mode||Ui);return r.discardDescriptor&&(A.closeSync(s),s=void 0),{name:i,fd:s,removeCallback:At(i,n?-1:s,r)}}function zc(e,t){var r=Pe(e,t),n=r[0],i=r[1];Rr(n,function(o,a){if(o)return i(o);A.mkdir(a,n.mode||$i,function(u){if(u)return i(u);i(null,a,Gi(a,n))})})}function Wc(e){var t=Pe(e),r=t[0];let n=Or(r);return A.mkdirSync(n,r.mode||$i),{name:n,removeCallback:Gi(n,r)}}function Vc(e,t){let r=function(n){if(n&&!Ot(n))return t(n);t()};0<=e[0]?A.close(e[0],function(n){A.unlink(e[1],r)}):A.unlink(e[1],r)}function Jc(e){try{0<=e[0]&&A.closeSync(e[0])}catch(t){if(!Yc(t)&&!Ot(t))throw t}finally{try{A.unlinkSync(e[1])}catch(t){if(!Ot(t))throw t}}}function At(e,t,r){let n=Rt(Jc,[t,e]),i=Rt(Vc,[t,e],n);return r.keep||De.unshift(n),i}function Kc(e,t){Di(e,t)}function Xc(e,t){try{return t(null,Di.sync(e))}catch(r){return t(r)}}function Gi(e,t){let r=t.unsafeCleanup?Kc:A.rmdir.bind(A),n=t.unsafeCleanup?Xc:A.rmdirSync.bind(A),i=Rt(n,e),s=Rt(r,e,i);return t.keep||De.unshift(i),s}function Rt(e,t,r){var n=!1;return function i(s){if(s=s||function(){},n)return s(new Error("cleanup callback has already been called"));{let o=r||i,a=De.indexOf(o);if(a>=0&&De.splice(a,1),n=!0,e.length===1)try{return e(t),s(null)}catch(c){return s(c)}else return e(t,s)}}}function Bi(){if(!!ji)for(;De.length;)try{De[0]()}catch(e){}}function Yc(e){return Hi(e,-Lc,"EBADF")}function Ot(e){return Hi(e,-xc,"ENOENT")}function Hi(e,t,r){return e.code===t||e.code===r}function Fe(e){return e==null||!e.trim()}function Zc(){ji=!0}function zi(){return Sr.tmpdir()}function Qc(e){return(e.name==="_exit"||e.name==="_uncaughtExceptionThrown")&&e.toString().indexOf("_garbageCollector();")>-1}function eu(){let e=process.listeners(Ar),t=[];for(let r=0,n=e.length;r<n;r++){let i=e[r];i.name==="_tmp$sigint_listener"&&(t.push(i),process.removeListener(Ar,i))}process.on(Ar,function(n){for(let i=0,s=t.length;i<s;i++)try{t[i](!1)}catch(o){}try{Bi()}finally{n&&process.exit(0)}})}function tu(){let e=process.listeners(Er),t=[];for(let r=0,n=e.length;r<n;r++){let i=e[r];(i.name==="_tmp$safe_listener"||Qc(i))&&(i.name!=="_uncaughtExceptionThrown"&&t.push(i),process.removeListener(Er,i))}process.addListener(Er,function(n){for(let i=0,s=t.length;i<s;i++)try{t[i](n)}catch(o){}Bi()})}tu();eu();Object.defineProperty(Q.exports,"tmpdir",{enumerable:!0,configurable:!1,get:function(){return zi()}});Q.exports.dir=zc;Q.exports.dirSync=Wc;Q.exports.file=Bc;Q.exports.fileSync=Hc;Q.exports.tmpName=Rr;Q.exports.tmpNameSync=Or;Q.exports.setGracefulCleanup=Zc});var Vi=y((kl,U)=>{var{promisify:Ye}=require("util"),ae=Wi();U.exports.fileSync=ae.fileSync;var ru=Ye((e,t)=>ae.file(e,(r,n,i,s)=>r?t(r):t(void 0,{path:n,fd:i,cleanup:Ye(s)})));U.exports.file=async e=>ru(e);U.exports.withFile=async function(t,r){let{path:n,fd:i,cleanup:s}=await U.exports.file(r);try{return await t({path:n,fd:i})}finally{await s()}};U.exports.dirSync=ae.dirSync;var nu=Ye((e,t)=>ae.dir(e,(r,n,i)=>r?t(r):t(void 0,{path:n,cleanup:Ye(i)})));U.exports.dir=async e=>nu(e);U.exports.withDir=async function(t,r){let{path:n,cleanup:i}=await U.exports.dir(r);try{return await t({path:n})}finally{await i()}};U.exports.tmpNameSync=ae.tmpNameSync;U.exports.tmpName=Ye(ae.tmpName);U.exports.tmpdir=ae.tmpdir;U.exports.setGracefulCleanup=ae.setGracefulCleanup});var Tr=y(Cr=>{"use strict";Object.defineProperty(Cr,"__esModule",{value:!0});var Ji=F(),Ki=class{constructor(t){this.totalNumberOfFilesToProcess=0,this.processedCount=0,this.largeFiles=new Map,this.totalFileStatus=void 0,this.largeFileStatus=void 0,this.displayFrequencyInMilliseconds=t}setTotalNumberOfFilesToProcess(t){this.totalNumberOfFilesToProcess=t}start(){this.totalFileStatus=setInterval(()=>{let t=this.formatPercentage(this.processedCount,this.totalNumberOfFilesToProcess);Ji.info(`Total file count: ${this.totalNumberOfFilesToProcess} ---- Processed file #${this.processedCount} (${t.slice(0,t.indexOf(".")+2)}%)`)},this.displayFrequencyInMilliseconds),this.largeFileStatus=setInterval(()=>{for(let t of Array.from(this.largeFiles.values()))Ji.info(t);this.largeFiles.clear()},1e3)}updateLargeFileStatus(t,r,n){let i=this.formatPercentage(r,n),s=`Uploading ${t} (${i.slice(0,i.indexOf(".")+2)}%)`;this.largeFiles.set(t,s)}stop(){this.totalFileStatus&&clearInterval(this.totalFileStatus),this.largeFileStatus&&clearInterval(this.largeFileStatus)}incrementProcessedCount(){this.processedCount++}formatPercentage(t,r){return(t/r*100).toFixed(4).toString()}};Cr.StatusReporter=Ki});var qr=y(kr=>{"use strict";Object.defineProperty(kr,"__esModule",{value:!0});var Xi=ve(),Yi=class{constructor(t,r){if(t<1)throw new Error("There must be at least one client");this.userAgent=r,this.clients=new Array(t).fill(Xi.createHttpClient(r))}getClient(t){return this.clients[t]}disposeAndReplaceClient(t){this.clients[t].dispose(),this.clients[t]=Xi.createHttpClient(this.userAgent)}disposeAndReplaceAllClients(){for(let[t]of this.clients.entries())this.disposeAndReplaceClient(t)}};kr.HttpManager=Yi});var es=y(J=>{"use strict";var Ct=J&&J.__awaiter||function(e,t,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(l){try{u(n.next(l))}catch(h){o(h)}}function c(l){try{u(n.throw(l))}catch(h){o(h)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((n=n.apply(e,t||[])).next())})},iu=J&&J.__asyncValues||function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof __values=="function"?__values(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(s){r[s]=e[s]&&function(o){return new Promise(function(a,c){o=e[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(u){s({value:u,done:a})},o)}},Zi=J&&J.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(J,"__esModule",{value:!0});var Tt=Zi(require("fs")),Qi=Zi(require("zlib")),su=require("util"),ou=su.promisify(Tt.stat);function au(e,t){return Ct(this,void 0,void 0,function*(){return new Promise((r,n)=>{let i=Tt.createReadStream(e),s=Qi.createGzip(),o=Tt.createWriteStream(t);i.pipe(s).pipe(o),o.on("finish",()=>Ct(this,void 0,void 0,function*(){let a=(yield ou(t)).size;r(a)})),o.on("error",a=>{console.log(a)})})})}J.createGZipFileOnDisk=au;function cu(e){return Ct(this,void 0,void 0,function*(){return new Promise(t=>Ct(this,void 0,void 0,function*(){var r,n;let i=Tt.createReadStream(e),s=Qi.createGzip();i.pipe(s);let o=[];try{for(var a=iu(s),c;c=yield a.next(),!c.done;){let u=c.value;o.push(u)}}catch(u){r={error:u}}finally{try{c&&!c.done&&(n=a.return)&&(yield n.call(a))}finally{if(r)throw r.error}}t(Buffer.concat(o))}))})}J.createGZipFileInBuffer=cu});var Ir=y(ce=>{"use strict";var ts=ce&&ce.__awaiter||function(e,t,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(l){try{u(n.next(l))}catch(h){o(h)}}function c(l){try{u(n.throw(l))}catch(h){o(h)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((n=n.apply(e,t||[])).next())})},uu=ce&&ce.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(ce,"__esModule",{value:!0});var Me=ve(),rs=uu(F()),lu=Te();function ns(e,t,r,n){return ts(this,void 0,void 0,function*(){let i,s,o=!1,a="",c,u=1;for(;u<=n;){try{if(i=yield t(),s=i.message.statusCode,Me.isSuccessStatusCode(s))return i;s&&(c=r.get(s)),o=Me.isRetryableStatusCode(s),a=`Artifact service responded with ${s}`}catch(l){o=!0,a=l.message}if(!o){rs.info(`${e} - Error is not retryable`),i&&Me.displayHttpDiagnostics(i);break}rs.info(`${e} - Attempt ${u} of ${n} failed with error: ${a}`),yield Me.sleep(Me.getExponentialRetryTimeInMilliseconds(u)),u++}throw i&&Me.displayHttpDiagnostics(i),Error(c?`${e} failed: ${c}`:`${e} failed: ${a}`)})}ce.retry=ns;function fu(e,t,r=new Map,n=lu.getRetryLimit()){return ts(this,void 0,void 0,function*(){return yield ns(e,t,r,n)})}ce.retryHttpClientRequest=fu});var us=y(Se=>{"use strict";var K=Se&&Se.__awaiter||function(e,t,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(l){try{u(n.next(l))}catch(h){o(h)}}function c(l){try{u(n.throw(l))}catch(h){o(h)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((n=n.apply(e,t||[])).next())})},kt=Se&&Se.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(Se,"__esModule",{value:!0});var Nr=kt(require("fs")),k=kt(F()),hu=kt(Vi()),du=kt(require("stream")),q=ve(),Ze=Te(),pu=require("util"),is=require("url"),ss=require("perf_hooks"),gu=Tr(),Dr=ht(),vu=qr(),os=es(),as=Ir(),mu=pu.promisify(Nr.stat),cs=class{constructor(){this.uploadHttpManager=new vu.HttpManager(Ze.getUploadFileConcurrency(),"@actions/artifact-upload"),this.statusReporter=new gu.StatusReporter(1e4)}createArtifactInFileContainer(t,r){return K(this,void 0,void 0,function*(){let n={Type:"actions_storage",Name:t};if(r&&r.retentionDays){let h=Ze.getRetentionDays();n.RetentionDays=q.getProperRetention(r.retentionDays,h)}let i=JSON.stringify(n,null,2),s=q.getArtifactUrl(),o=this.uploadHttpManager.getClient(0),a=q.getUploadHeaders("application/json",!1),c=new Map([[Dr.HttpCodes.Forbidden,"Artifact storage quota has been hit. Unable to upload any new artifacts"],[Dr.HttpCodes.BadRequest,`The artifact name ${t} is not valid. Request URL ${s}`]]),l=yield(yield as.retryHttpClientRequest("Create Artifact Container",()=>K(this,void 0,void 0,function*(){return o.post(s,i,a)}),c)).readBody();return JSON.parse(l)})}uploadArtifactToFileContainer(t,r,n){return K(this,void 0,void 0,function*(){let i=Ze.getUploadFileConcurrency(),s=Ze.getUploadChunkSize();k.debug(`File Concurrency: ${i}, and Chunk Size: ${s}`);let o=[],a=!0;n&&n.continueOnError===!1&&(a=!1);for(let g of r){let m=new is.URL(t);m.searchParams.append("itemPath",g.uploadFilePath),o.push({file:g.absoluteFilePath,resourceUrl:m.toString(),maxChunkSize:s,continueOnError:a})}let c=[...new Array(i).keys()],u=[],l=0,h=0,d=0,f=0,p=!1;return this.statusReporter.setTotalNumberOfFilesToProcess(r.length),this.statusReporter.start(),yield Promise.all(c.map(g=>K(this,void 0,void 0,function*(){for(;l<r.length;){let m=o[l];if(l+=1,p){u.push(m.file);continue}let w=ss.performance.now(),b=yield this.uploadFileAsync(g,m);k.isDebug()&&k.debug(`File: ${++h}/${r.length}. ${m.file} took ${(ss.performance.now()-w).toFixed(3)} milliseconds to finish upload`),d+=b.successfulUploadSize,f+=b.totalSize,b.isSuccess===!1&&(u.push(m.file),a||(k.error("aborting artifact upload"),p=!0)),this.statusReporter.incrementProcessedCount()}}))),this.statusReporter.stop(),this.uploadHttpManager.disposeAndReplaceAllClients(),k.info(`Total size of all the files uploaded is ${d} bytes`),{uploadSize:d,totalSize:f,failedItems:u}})}uploadFileAsync(t,r){return K(this,void 0,void 0,function*(){let n=(yield mu(r.file)).size,i=0,s=!0,o=0,a=0,c=!0;if(n<65536){let u=yield os.createGZipFileInBuffer(r.file),l;return n<u.byteLength?(l=()=>Nr.createReadStream(r.file),c=!1,a=n):(l=()=>{let d=new du.PassThrough;return d.end(u),d},a=u.byteLength),(yield this.uploadChunk(t,r.resourceUrl,l,0,a-1,a,c,n))||(s=!1,o+=a,k.warning(`Aborting upload for ${r.file} due to failure`)),{isSuccess:s,successfulUploadSize:a-o,totalSize:n}}else{let u=yield hu.file();a=yield os.createGZipFileOnDisk(r.file,u.path);let l=u.path;n<a&&(a=n,l=r.file,c=!1);let h=!1;for(;i<a;){let d=Math.min(a-i,r.maxChunkSize);a>104857600&&this.statusReporter.updateLargeFileStatus(r.file,i,a);let f=i,p=i+d-1;if(i+=r.maxChunkSize,h){o+=d;continue}(yield this.uploadChunk(t,r.resourceUrl,()=>Nr.createReadStream(l,{start:f,end:p,autoClose:!1}),f,p,a,c,n))||(s=!1,o+=d,k.warning(`Aborting upload for ${r.file} due to failure`),h=!0)}return yield u.cleanup(),{isSuccess:s,successfulUploadSize:a-o,totalSize:n}}})}uploadChunk(t,r,n,i,s,o,a,c){return K(this,void 0,void 0,function*(){let u=q.getUploadHeaders("application/octet-stream",!0,a,c,s-i+1,q.getContentRange(i,s,o)),l=()=>K(this,void 0,void 0,function*(){return yield this.uploadHttpManager.getClient(t).sendStream("PUT",r,n(),u)}),h=0,d=Ze.getRetryLimit(),f=g=>(h++,h>d?(g&&q.displayHttpDiagnostics(g),k.info(`Retry limit has been reached for chunk at offset ${i} to ${r}`),!0):!1),p=g=>K(this,void 0,void 0,function*(){if(this.uploadHttpManager.disposeAndReplaceClient(t),g)k.info(`Backoff due to too many requests, retry #${h}. Waiting for ${g} milliseconds before continuing the upload`),yield q.sleep(g);else{let m=q.getExponentialRetryTimeInMilliseconds(h);k.info(`Exponential backoff for retry #${h}. Waiting for ${m} milliseconds before continuing the upload at offset ${i}`),yield q.sleep(m)}k.info(`Finished backoff for retry #${h}, continuing with upload`)});for(;h<=d;){let g;try{g=yield l()}catch(m){if(k.info(`An error has been caught http-client index ${t}, retrying the upload`),console.log(m),f())return!1;yield p();continue}if(yield g.readBody(),q.isSuccessStatusCode(g.message.statusCode))return!0;if(q.isRetryableStatusCode(g.message.statusCode)){if(k.info(`A ${g.message.statusCode} status code has been received, will attempt to retry the upload`),f(g))return!1;q.isThrottledStatusCode(g.message.statusCode)?yield p(q.tryGetRetryAfterValueTimeInMilliseconds(g.message.headers)):yield p()}else return k.error(`Unexpected response. Unable to upload chunk to ${r}`),q.displayHttpDiagnostics(g),!1}return!1})}patchArtifactSize(t,r){return K(this,void 0,void 0,function*(){let n=new is.URL(q.getArtifactUrl());n.searchParams.append("artifactName",r);let i={Size:t},s=JSON.stringify(i,null,2);k.debug(`URL is ${n.toString()}`);let o=this.uploadHttpManager.getClient(0),a=q.getUploadHeaders("application/json",!1),c=new Map([[Dr.HttpCodes.NotFound,`An Artifact with the name ${r} was not found`]]);yield(yield as.retryHttpClientRequest("Finalize artifact upload",()=>K(this,void 0,void 0,function*(){return o.patch(n.toString(),s,a)}),c)).readBody(),k.debug(`Artifact ${r} has been successfully uploaded, total size in bytes: ${t}`)})}};Se.UploadHttpClient=cs});var ps=y(be=>{"use strict";var z=be&&be.__awaiter||function(e,t,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(l){try{u(n.next(l))}catch(h){o(h)}}function c(l){try{u(n.throw(l))}catch(h){o(h)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((n=n.apply(e,t||[])).next())})},Pr=be&&be.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(be,"__esModule",{value:!0});var ls=Pr(require("fs")),I=Pr(F()),yu=Pr(require("zlib")),P=ve(),wu=require("url"),_u=Tr(),fs=require("perf_hooks"),Su=qr(),Fr=Te(),hs=Ir(),ds=class{constructor(){this.downloadHttpManager=new Su.HttpManager(Fr.getDownloadFileConcurrency(),"@actions/artifact-download"),this.statusReporter=new _u.StatusReporter(1e3)}listArtifacts(){return z(this,void 0,void 0,function*(){let t=P.getArtifactUrl(),r=this.downloadHttpManager.getClient(0),n=P.getDownloadHeaders("application/json"),s=yield(yield hs.retryHttpClientRequest("List Artifacts",()=>z(this,void 0,void 0,function*(){return r.get(t,n)}))).readBody();return JSON.parse(s)})}getContainerItems(t,r){return z(this,void 0,void 0,function*(){let n=new wu.URL(r);n.searchParams.append("itemPath",t);let i=this.downloadHttpManager.getClient(0),s=P.getDownloadHeaders("application/json"),a=yield(yield hs.retryHttpClientRequest("Get Container Items",()=>z(this,void 0,void 0,function*(){return i.get(n.toString(),s)}))).readBody();return JSON.parse(a)})}downloadSingleArtifact(t){return z(this,void 0,void 0,function*(){let r=Fr.getDownloadFileConcurrency();I.debug(`Download file concurrency is set to ${r}`);let n=[...new Array(r).keys()],i=0,s=0;I.info(`Total number of files that will be downloaded: ${t.length}`),this.statusReporter.setTotalNumberOfFilesToProcess(t.length),this.statusReporter.start(),yield Promise.all(n.map(o=>z(this,void 0,void 0,function*(){for(;i<t.length;){let a=t[i];i+=1;let c=fs.performance.now();yield this.downloadIndividualFile(o,a.sourceLocation,a.targetPath),I.isDebug()&&I.debug(`File: ${++s}/${t.length}. ${a.targetPath} took ${(fs.performance.now()-c).toFixed(3)} milliseconds to finish downloading`),this.statusReporter.incrementProcessedCount()}}))).catch(o=>{throw new Error(`Unable to download the artifact: ${o}`)}).finally(()=>{this.statusReporter.stop(),this.downloadHttpManager.disposeAndReplaceAllClients()})})}downloadIndividualFile(t,r,n){return z(this,void 0,void 0,function*(){let i=0,s=Fr.getRetryLimit(),o=ls.createWriteStream(n),a=P.getDownloadHeaders("application/json",!0,!0),c=()=>z(this,void 0,void 0,function*(){return yield this.downloadHttpManager.getClient(t).get(r,a)}),u=f=>"content-encoding"in f&&f["content-encoding"]==="gzip",l=f=>z(this,void 0,void 0,function*(){if(i++,i>s)return Promise.reject(new Error(`Retry limit has been reached. Unable to download ${r}`));if(this.downloadHttpManager.disposeAndReplaceClient(t),f)I.info(`Backoff due to too many requests, retry #${i}. Waiting for ${f} milliseconds before continuing the download`),yield P.sleep(f);else{let p=P.getExponentialRetryTimeInMilliseconds(i);I.info(`Exponential backoff for retry #${i}. Waiting for ${p} milliseconds before continuing the download`),yield P.sleep(p)}I.info(`Finished backoff for retry #${i}, continuing with download`)}),h=(f,p)=>!f||!p||process.env.ACTIONS_ARTIFACT_SKIP_DOWNLOAD_VALIDATION?(I.info("Skipping download validation."),!0):parseInt(f)===p,d=f=>z(this,void 0,void 0,function*(){o.close(),yield P.rmFile(f),o=ls.createWriteStream(f)});for(;i<=s;){let f;try{f=yield c(),I.isDebug()&&P.displayHttpDiagnostics(f)}catch(g){I.info("An error occurred while attempting to download a file"),console.log(g),yield l();continue}let p=!1;if(P.isSuccessStatusCode(f.message.statusCode))try{let g=u(f.message.headers);if(yield this.pipeResponseToFile(f,o,g),g||h(f.message.headers["content-length"],yield P.getFileSize(n)))return;p=!0}catch(g){p=!0}if(p||P.isRetryableStatusCode(f.message.statusCode))I.info(`A ${f.message.statusCode} response code has been received while attempting to download an artifact`),d(n),P.isThrottledStatusCode(f.message.statusCode)?yield l(P.tryGetRetryAfterValueTimeInMilliseconds(f.message.headers)):yield l();else return P.displayHttpDiagnostics(f),Promise.reject(new Error(`Unexpected http ${f.message.statusCode} during download for ${r}`))}})}pipeResponseToFile(t,r,n){return z(this,void 0,void 0,function*(){yield new Promise((i,s)=>{if(n){let o=yu.createGunzip();t.message.on("error",a=>{I.error("An error occurred while attempting to read the response stream"),o.close(),r.close(),s(a)}).pipe(o).on("error",a=>{I.error("An error occurred while attempting to decompress the response stream"),r.close(),s(a)}).pipe(r).on("close",()=>{i()}).on("error",a=>{I.error(`An error occurred while writing a downloaded file to ${r.path}`),s(a)})}else t.message.on("error",o=>{I.error("An error occurred while attempting to read the response stream"),r.close(),s(o)}).pipe(r).on("close",()=>{i()}).on("error",o=>{I.error(`An error occurred while writing a downloaded file to ${r.path}`),s(o)})})})}};be.DownloadHttpClient=ds});var gs=y(Qe=>{"use strict";var bu=Qe&&Qe.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(Qe,"__esModule",{value:!0});var qt=bu(require("path"));function Eu(e,t,r,n){let i=new Set,s={rootDownloadLocation:n?qt.join(r,e):r,directoryStructure:[],emptyFilesToCreate:[],filesToDownload:[]};for(let o of t)if(o.path.startsWith(`${e}/`)||o.path.startsWith(`${e}\\`)){let a=qt.normalize(o.path),c=qt.join(r,n?a:a.replace(e,""));o.itemType==="file"&&(i.add(qt.dirname(c)),o.fileLength===0?s.emptyFilesToCreate.push(c):s.filesToDownload.push({sourceLocation:o.contentLocation,targetPath:c}))}return s.directoryStructure=Array.from(i),s}Qe.getDownloadSpecification=Eu});var ws=y(Ee=>{"use strict";var Mr=Ee&&Ee.__awaiter||function(e,t,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(l){try{u(n.next(l))}catch(h){o(h)}}function c(l){try{u(n.throw(l))}catch(h){o(h)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((n=n.apply(e,t||[])).next())})},Au=Ee&&Ee.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(Ee,"__esModule",{value:!0});var ue=Au(F()),Ru=qn(),Ou=us(),et=ve(),vs=ps(),ms=gs(),ys=Te(),It=require("path"),Nt=class{static create(){return new Nt}uploadArtifact(t,r,n,i){return Mr(this,void 0,void 0,function*(){et.checkArtifactName(t);let s=Ru.getUploadSpecification(t,n,r),o={artifactName:t,artifactItems:[],size:0,failedItems:[]},a=new Ou.UploadHttpClient;if(s.length===0)ue.warning("No files found that can be uploaded");else{let c=yield a.createArtifactInFileContainer(t,i);if(!c.fileContainerResourceUrl)throw ue.debug(c.toString()),new Error("No URL provided by the Artifact Service to upload an artifact to");ue.debug(`Upload Resource URL: ${c.fileContainerResourceUrl}`);let u=yield a.uploadArtifactToFileContainer(c.fileContainerResourceUrl,s,i);yield a.patchArtifactSize(u.totalSize,t),ue.info(`Finished uploading artifact ${t}. Reported size is ${u.uploadSize} bytes. There were ${u.failedItems.length} items that failed to upload`),o.artifactItems=s.map(l=>l.absoluteFilePath),o.size=u.uploadSize,o.failedItems=u.failedItems}return o})}downloadArtifact(t,r,n){return Mr(this,void 0,void 0,function*(){let i=new vs.DownloadHttpClient,s=yield i.listArtifacts();if(s.count===0)throw new Error("Unable to find any artifacts for the associated workflow");let o=s.value.find(u=>u.name===t);if(!o)throw new Error(`Unable to find an artifact with the name: ${t}`);let a=yield i.getContainerItems(o.name,o.fileContainerResourceUrl);r||(r=ys.getWorkSpaceDirectory()),r=It.normalize(r),r=It.resolve(r);let c=ms.getDownloadSpecification(t,a.value,r,(n==null?void 0:n.createArtifactFolder)||!1);return c.filesToDownload.length===0?ue.info(`No downloadable files were found for the artifact: ${o.name}`):(yield et.createDirectoriesForArtifact(c.directoryStructure),ue.info("Directory structure has been setup for the artifact"),yield et.createEmptyFilesForArtifact(c.emptyFilesToCreate),yield i.downloadSingleArtifact(c.filesToDownload)),{artifactName:t,downloadPath:c.rootDownloadLocation}})}downloadAllArtifacts(t){return Mr(this,void 0,void 0,function*(){let r=new vs.DownloadHttpClient,n=[],i=yield r.listArtifacts();if(i.count===0)return ue.info("Unable to find any artifacts for the associated workflow"),n;t||(t=ys.getWorkSpaceDirectory()),t=It.normalize(t),t=It.resolve(t);let s=0;for(;s<i.count;){let o=i.value[s];s+=1;let a=yield r.getContainerItems(o.name,o.fileContainerResourceUrl),c=ms.getDownloadSpecification(o.name,a.value,t,!0);c.filesToDownload.length===0?ue.info(`No downloadable files were found for any artifact ${o.name}`):(yield et.createDirectoriesForArtifact(c.directoryStructure),yield et.createEmptyFilesForArtifact(c.emptyFilesToCreate),yield r.downloadSingleArtifact(c.filesToDownload)),n.push({artifactName:o.name,downloadPath:c.rootDownloadLocation})}return n})}};Ee.DefaultArtifactClient=Nt});var _s=y($r=>{"use strict";Object.defineProperty($r,"__esModule",{value:!0});var Cu=ws();function Tu(){return Cu.DefaultArtifactClient.create()}$r.create=Tu});var Os=y((jl,Rs)=>{var Ss=require("path"),ku=require("fs"),qu=_s(),G=F(),{getServices:Iu,isLocalRode:bs}=Bt(),Es=ct(),As="rode-dev-env.service.logs",Nu=async({logsDir:e,logPaths:t})=>{if(!process.env.GITHUB_ACTIONS){G.warning("Appear to be running locally, skipping artifact upload");return}G.info(`Uploading logs as ${As}`),await qu.create().uploadArtifact(As,t,e,{continueOnError:!0,retentionDays:7}),G.info("Successfully uploaded logs")},Du=()=>{let e=G.getState("logsDir");if(!e){G.warning("Expected to find logs directory in action state. Skipping log upload");return}G.info("Gathering service logs");let t=Iu(),r=[];for(let n=0;n<t.length;n++){let i=t[n],s=Es.logs(i);G.info(`Writing logs for ${i}`);let o=Ss.join(e,`${i}.log`);r.push(o),ku.writeFileSync(o,s,"utf-8")}return bs()&&r.push(Ss.join(e,"rode.log")),Nu({logsDir:e,logPaths:r})},Pu=()=>{if(!bs())return;let e=parseInt(G.getState("localRodePid"),10);if(!e){G.warning("Expected to find a PID in action state");return}G.info(`Stopping local Rode instance (pid: ${e})`),process.kill(e,"SIGTERM")};Rs.exports=async()=>{G.info("Running rode-dev-env post"),Pu(),await Du(),G.info("Stopping services"),Es.down()}});var Cs=require("fs"),Fu=require("path"),le=F(),Mu=ct(),$u=En(),Uu=Os(),Ts="rode-dev-env",Ur="v0.1.2",ks=`/home/runner/work/_actions/rode/${Ts}`,ju=()=>{if(!process.env.GITHUB_ACTIONS){le.info("Appear to be running locally");return}if(Fu.basename(process.cwd())===Ts&&Cs.existsSync("./docker-compose.yaml")){le.info("Running in CI and in the rode-dev-env repository");return}if(!Ur)throw new Error("Unable to determine action version");le.info(`Appear to be running GitHub Actions with version ${Ur}`);let t=`${ks}/${Ur}/docker-compose.yaml`;if(le.info(`Checking if docker compose config is at this path: ${t}`),!Cs.existsSync(t))throw new Error(`Expected to find action repository at ${ks}, but wasn't present`);le.info("Found docker compose config"),Mu.configure(t)},Lu=()=>{let e=le.getState("post");return e||le.saveState("post",!0),e};(async()=>{try{ju(),await(Lu()?Uu:$u)()}catch(e){le.setFailed(`Error running rode-dev-env: ${e.stack}`),process.exit(1)}})();
/*!
 * Tmp
 *
 * Copyright (c) 2011-2017 KARASZI Istvan <github@spam.raszi.hu>
 *
 * MIT Licensed
 */
